!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){i(2),i(3),i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11),t.exports=i(12)},function(t,e){!function(t){"use strict";var e=function(){for(var t in this.draggable=!0,this.isSelected=!1,e.model)this[t]=e.model[t]};e.model={draggable:!0,isSelected:!1},t.VertexAttr=e}(window)},function(t,e){!function(t){"use strict";var e=function(){this.drag=[],this.dragStart=[],this.dragEnd=[]};e.prototype.addDragListener=function(t){this.drag.push(t)},e.prototype.addDragStartListener=function(t){this.dragStart.push(t)},e.prototype.addDragEndListener=function(t){this.dragEnd.push(t)},e.prototype.fireDragEvent=function(t){i(this.drag,t)},e.prototype.fireDragStartEvent=function(t){i(this.dragStart,t)},e.prototype.fireDragEndEvent=function(t){i(this.dragEnd,t)};var i=function(t,e){for(var i in t)t[i](e)};t.VertexListeners=e}(window)},function(t,e){!function(e){var i=(window?window:t.exports).Vertex=function(t,e){"object"==typeof t&&"number"==typeof t.x&&"number"==typeof t.y?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this.attr=new VertexAttr,this.listeners=new VertexListeners};i.prototype.set=function(t,e){return"object"==typeof t&&"number"==typeof t.x&&"number"==typeof t.y?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.addXY=function(t,e){return this.x+=t,this.y+=e,this},i.prototype.equals=function(t){var e=Math.abs(this.x-t.x)<1e-6,i=Math.abs(this.y-t.y)<1e-6;return e&&i},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.distance=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))},i.prototype.scale=function(t,e){return e&&void 0!==e||(e=new i(0,0)),this.x=e.x+(this.x-e.x)*t,this.y=e.y+(this.y-e.y)*t,this},i.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},i.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},i.prototype.toString=function(){return"("+this.x+","+this.y+")"}}()},function(t,e){!function(t){"use strict";var e=function(t,e,i,n){Object.call(this),this.startPoint=t,this.startControlPoint=i,this.endPoint=e,this.endControlPoint=n,this.curveIntervals=30,this.segmentCache=[],this.segmentLengths=[],this.arcLength=null,this.updateArcLengths()};e.START_POINT=0,e.START_CONTROL_POINT=1,e.END_CONTROL_POINT=2,e.END_POINT=3,(e.prototype=new Object).constructor=e,e.prototype.START_POINT=0,e.prototype.START_CONTROL_POINT=1,e.prototype.END_CONTROL_POINT=2,e.prototype.END_POINT=3,e.prototype.moveCurvePoint=function(t,e,i,n){t==this.START_POINT?(this.getStartPoint().add(e),i&&this.getStartControlPoint().add(e)):t==this.START_CONTROL_POINT?this.getStartControlPoint().add(e):t==this.END_CONTROL_POINT?this.getEndControlPoint().add(e):t==this.END_POINT?(this.getEndPoint().add(e),i&&this.getEndControlPoint().add(e)):console.log("[IKRS.CubicBezierCurve.moveCurvePoint] pointID '"+t+"' invalid."),n&&this.updateArcLengths()},e.prototype.translate=function(t){this.startPoint.add(t),this.startControlPoint.add(t),this.endControlPoint.add(t),this.endPoint.add(t)},e._scalePoint=function(t,e,i){t.sub(e),t.setX(t.x*i.x),t.setY(t.y*i.y),t.add(e)},e.prototype.getLength=function(){return this.arcLength},e.prototype.computeVerticalAreaSize=function(t,e,i){if(0==e)throw"Cannot compute bezier curve's vertical area size with delta=0.";if(this.segmentCache.length<=1)return 0;for(var n=0,r=0;r+1<this.segmentCache.length;r++)n+=this._computeVerticalAreaSizeForSegment(t,e,i,r);return n},e.prototype._computeVerticalAreaSizeForSegment=function(t,e,i,n){if(n+1>=this.segmentCache.length)return 0;var r=this.segmentCache[n],s=this.segmentCache[n+1],o=s.y-r.y,a=t-r.x,h=t-s.x,u=h+(a-h)/2;return i?Math.abs(o*u):o*u},e.prototype.computeVerticalRevolutionVolumeSize=function(t,e){if(this.segmentCache.length<=1)return 0;for(var i=0,n=0;n+1<this.segmentCache.length;n++)i+=this._computeVerticalRevolutionVolumeSizeForSegment(t,e,n);return i},e.prototype._computeVerticalRevolutionVolumeSizeForSegment=function(t,e,i){if(i+1>=this.segmentCache.length)return 0;var n=this.segmentCache[i],r=this.segmentCache[i+1],s=r.y-n.y,o=(t-n.x+(t-r.x))/2,a=Math.PI*Math.pow(o,2)*s;return e?Math.abs(a):a},e.prototype.updateArcLengths=function(){var t=new Vertex(this.startPoint.x,this.startPoint.y),e=new Vertex(0,0),i=1/this.curveIntervals;this.segmentCache=[],this.segmentCache.push(this.startPoint),this.segmentLengths=[],this.arcLength=0;for(var n=0;n<this.curveIntervals;n++){e=this.getPoint((n+1)*i),this.segmentCache.push(e);var r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));this.segmentLengths.push(r),this.arcLength+=r,t=e,i}},e.prototype.getStartPoint=function(){return this.startPoint},e.prototype.getEndPoint=function(){return this.endPoint},e.prototype.getStartControlPoint=function(){return this.startControlPoint},e.prototype.getEndControlPoint=function(){return this.endControlPoint},e.prototype.getPointByID=function(t){if(t==this.START_POINT)return this.startPoint;if(t==this.END_POINT)return this.endPoint;if(t==this.START_CONTROL_POINT)return this.startControlPoint;if(t==this.END_CONTROL_POINT)return this.endControlPoint;throw"Invalid point ID '"+t+"'."},e.prototype.getPoint=function(t){var e=this.startPoint.x*Math.pow(1-t,3)+3*this.startControlPoint.x*t*Math.pow(1-t,2)+3*this.endControlPoint.x*Math.pow(t,2)*(1-t)+this.endPoint.x*Math.pow(t,3),i=this.startPoint.y*Math.pow(1-t,3)+3*this.startControlPoint.y*t*Math.pow(1-t,2)+3*this.endControlPoint.y*Math.pow(t,2)*(1-t)+this.endPoint.y*Math.pow(t,3);return new Vertex(e,i)},e.prototype.getPointAt=function(t){return this.getPoint(t/this.arcLength)},e.prototype.getTangent=function(t){var e=this.getStartPoint(),i=this.getStartControlPoint(),n=this.getEndControlPoint(),r=this.getEndPoint(),s=t*t,o=1-2*t+s,a=-3*e.x*o+i.x*(3*o-6*(t-s))+n.x*(6*(t-s)-3*s)+3*r.x*s,h=-3*e.y*o+i.y*(3*o-6*(t-s))+n.y*(6*(t-s)-3*s)+3*r.y*s;return new Vertex(a,h)},e.prototype.convertU2T=function(t){return Math.max(0,Math.min(1,t/this.arcLength))},e.prototype.getTangentAt=function(t){return this.getTangent(this.convertU2T(t))},e.prototype.getPerpendicularAt=function(t){return this.getPerpendicular(this.convertU2T(t))},e.prototype.getPerpendicular=function(t){var e=this.getTangent(t);return new Vertex(e.y,-e.x)},e.prototype.computeBoundingBox=function(){return BoundingBox2.computeFromPoints(this.segmentCache)},e.prototype.clone=function(){return new e(this.getStartPoint().clone(),this.getEndPoint().clone(),this.getStartControlPoint().clone(),this.getEndControlPoint().clone())},e.prototype.equals=function(t){return!!t&&(!!(t.startPoint&&t.endPoint&&t.startControlPoint&&t.endControlPoint)&&(this.startPoint.equals(t.startPoint)&&this.endPoint.equals(t.endPoint)&&this.startControlPoint.equals(t.startControlPoint)&&this.endControlPoint.equals(t.endControlPoint)))},e.prototype.toJSON=function(t){return"{ "+(t?"\n\t":"")+'"startPoint" : ['+this.getStartPoint().x+","+this.getStartPoint().y+"], "+(t?"\n\t":"")+'"endPoint" : ['+this.getEndPoint().x+","+this.getEndPoint().y+"], "+(t?"\n\t":"")+'"startControlPoint": ['+this.getStartControlPoint().x+","+this.getStartControlPoint().y+"], "+(t?"\n\t":"")+'"endControlPoint" : ['+this.getEndControlPoint().x+","+this.getEndControlPoint().y+"]"+(t?"\n\t":"")+" }"},e.fromJSON=function(t){var i=JSON.parse(t);return e.fromObject(i)},e.fromObject=function(t){if("object"!=typeof t)throw"[IKRS.CubicBezierCurve.fromObject] Can only build from object.";if(!t.startPoint)throw'[IKRS.CubicBezierCurve.fromObject] Object member "startPoint" missing.';if(!t.endPoint)throw'[IKRS.CubicBezierCurve.fromObject] Object member "endPoint" missing.';if(!t.startControlPoint)throw'[IKRS.CubicBezierCurve.fromObject] Object member "startControlPoint" missing.';if(!t.endControlPoint)throw'[IKRS.CubicBezierCurve.fromObject] Object member "endControlPoint" missing.';return new e(new Vertex(t.startPoint[0],t.startPoint[1]),new Vertex(t.endPoint[0],t.endPoint[1]),new Vertex(t.startControlPoint[0],t.startControlPoint[1]),new Vertex(t.endControlPoint[0],t.endControlPoint[1]))},e.fromArray=function(t){if(!Array.isArray(t))throw"[IKRS.CubicBezierCurve.fromArray] Can only build from object.";if(4!=t.length)throw"[IKRS.CubicBezierCurve.fromArray] Can only build from array with four elements.";return new e(t[0],t[1],t[2],t[3])},t.CubicBezierCurve=e}(window)},function(t,e){!function(t){"use strict";var e=function(t){Object.call(this),t||(t=[]),this.totalArcLength=0,this.adjustCircular=!1,this.bezierCurves=[];for(var e=1;e<t.length;e++){var i=new THREE.Box2(t[e].x-t[e-1].x,t[e].y-t[e-1].y),n=new CubicBezierCurve(t[e-1],t[e],new Vertex(t[e-1].x,t[e-1].y-i.min/2),new Vertex(t[e].x+i.max/2,t[e].y));this.bezierCurves.push(n),this.totalArcLength+=n.getLength(),this.bezierCurves.length>=2&&this.adjustSuccessorControlPoint(this.bezierCurves.length-2,!0,!0)}};e.prototype.constructor=e,e.START_POINT=0,e.START_CONTROL_POINT=1,e.END_CONTROL_POINT=2,e.END_POINT=3,e.prototype.START_POINT=0,e.prototype.START_CONTROL_POINT=1,e.prototype.END_CONTROL_POINT=2,e.prototype.END_POINT=3,e.prototype.addCurve=function(t){if(null==t||void 0===t)throw"Cannot add null curve to bézier path.";this.bezierCurves.push(t),this.bezierCurves.length>1?(t.startPoint=this.bezierCurves[this.bezierCurves.length-2].endPoint,this.adjustSuccessorControlPoint(this.bezierCurves.length-2,!0,!0)):this.totalArcLength+=t.getLength()},e.prototype.getLength=function(){return this.totalArcLength},e.prototype.computeVerticalAreaSize=function(t,e){for(var i=this.computeBoundingBox().xMax,n=0,r=0;r<this.bezierCurves.length;r++)n+=this.bezierCurves[r].computeVerticalAreaSize(i,t,e);return n},e.prototype.computeVerticalRevolutionVolumeSize=function(t){for(var e=this.computeBoundingBox().xMax,i=0,n=0;n<this.bezierCurves.length;n++)i+=this.bezierCurves[n].computeVerticalRevolutionVolumeSize(e,t);return i},e.prototype.updateArcLengths=function(){this.totalArcLength=0;for(var t=0;t<this.bezierCurves.length;t++)this.bezierCurves[t].updateArcLengths(),this.totalArcLength+=this.bezierCurves[t].getLength()},e.prototype.getCurveCount=function(){return this.bezierCurves.length},e.prototype.getCurveAt=function(t){return this.bezierCurves[t]},e.prototype.removeEndPoint=function(){if(this.bezierCurves.length<=1)return!1;for(var t=[this.bezierCurves.length-1],e=0;e<this.bezierCurves.length-1;e++)t[e]=this.bezierCurves[e];return this.totalArcLength-=this.bezierCurves[this.bezierCurves.length-1].getLength(),this.bezierCurves=t,!0},e.prototype.removeStartPoint=function(){if(this.bezierCurves.length<=1)return!1;for(var t=[this.bezierCurves.length-1],e=1;e<this.bezierCurves.length;e++)t[e-1]=this.bezierCurves[e];return this.totalArcLength-=this.bezierCurves[0].getLength(),this.bezierCurves=t,!0},e.prototype.joinAt=function(t){if(t<0||t>=this.bezierCurves.length)return!1;var e=this.bezierCurves[t-1],i=this.bezierCurves[t],n=e.getStartControlPoint().clone();n.sub(e.getStartPoint()),n.multiplyScalar(2),n.add(e.getStartPoint());var r=i.getEndControlPoint().clone();r.sub(i.getEndPoint()),r.multiplyScalar(2),r.add(i.getEndPoint());for(var s=new IKRS.CubicBezierCurve(e.getStartPoint(),i.getEndPoint(),n,r),o=[this.bezierCurves.length-1],a=0;a<t-1;a++)o[a]=this.bezierCurves[a];o[t-1]=s;for(a=t;a+1<this.bezierCurves.length;a++)o[a]=this.bezierCurves[a+1];return this.bezierCurves=o,this.updateArcLengths(),!0},e.prototype.splitAt=function(t,e){if(t<0||t>=this.bezierCurves.length)return!1;var i=this.bezierCurves[t];if(e<1||e-1>=i.segmentCache.length)return!1;for(var n=this.bezierCurves.length;n>t;n--)this.bezierCurves[n]=this.bezierCurves[n-1];for(var r=0,s=0;s<e;s++)r+=i.segmentLengths[s];var o=i.getTangentAt(r);o=o.multiplyScalar(.25);var a=i.segmentCache[e].clone();a.sub(o);var h=i.segmentCache[e].clone();h.add(o);var u=i.getStartControlPoint().clone();u.sub(i.getStartPoint()),u.multiplyScalar(.25),u.add(i.getStartPoint());var l=i.getEndControlPoint().clone();l.sub(i.getEndPoint()),l.multiplyScalar(.25),l.add(i.getEndPoint());var c=new CubicBezierCurve(i.getStartPoint(),i.segmentCache[e],u,a),d=new CubicBezierCurve(i.segmentCache[e],i.getEndPoint(),h,l);return this.bezierCurves[t]=c,this.bezierCurves[t+1]=d,this.totalArcLength-=i.getLength(),this.totalArcLength+=c.getLength(),this.totalArcLength+=d.getLength(),!0},e.prototype.translate=function(t){for(var e=0;e<this.bezierCurves.length;e++){(i=this.bezierCurves[e]).getStartPoint().add(t),i.getStartControlPoint().add(t),i.getEndControlPoint().add(t)}var i;(i=this.bezierCurves[this.bezierCurves.length-1]).getEndPoint().add(t),this.updateArcLengths()},e.prototype.scale=function(t,i){for(var n=0;n<this.bezierCurves.length;n++){var r=this.bezierCurves[n];e._scalePoint(r.getStartPoint(),t,i),e._scalePoint(r.getStartControlPoint(),t,i),e._scalePoint(r.getEndControlPoint(),t,i)}this.bezierCurves.length>0&&e._scalePoint(this.bezierCurves[this.bezierCurves.length-1].getEndPoint(),t,i),this.updateArcLengths()},e._scalePoint=function(t,e,i){t.sub(e),t.setX(t.x*i.x),t.setY(t.y*i.y),t.add(e)},e.prototype.getPointAt=function(t){if(t<0||t>this.totalArcLength)return console.log("[IKRS.BezierPath.getPointAt(u)] u is out of bounds: "+t+"."),null;for(var e=0,i=0;e<this.bezierCurves.length&&i+this.bezierCurves[e].getLength()<t;)i+=this.bezierCurves[e].getLength(),e++;if(e>=this.bezierCurves.length)return this.bezierCurves[this.bezierCurves.length-1].getEndPoint().clone();var n=t-i;return this.bezierCurves[e].getPointAt(n)},e.prototype.getPoint=function(t){return this.getPointAt(t*this.totalArcLength)},e.prototype.getTangent=function(t){return this.getTangentAt(t*this.totalArcLength)},e.prototype.getTangentAt=function(t){if(t<0||t>this.totalArcLength)return console.warn("[BezierPath.getTangentAt(u)] u is out of bounds: "+t+"."),null;for(var e=0,i=0;e<this.bezierCurves.length&&i+this.bezierCurves[e].getLength()<t;)i+=this.bezierCurves[e].getLength(),e++;var n=t-i;return this.bezierCurves[e].getTangentAt(n)},e.prototype.getPerpendicular=function(t){return this.getPerpendicularAt(t*this.totalArcLength)},e.prototype.getPerpendicularAt=function(t){if(t<0||t>this.totalArcLength)return console.log("[IKRS.BezierPath.getPerpendicularAt(u)] u is out of bounds: "+t+"."),null;for(var e=0,i=0;e<this.bezierCurves.length&&i+this.bezierCurves[e].getLength()<t;)i+=this.bezierCurves[e].getLength(),e++;var n=t-i;return this.bezierCurves[e].getPerpendicularAt(n)},e.prototype.computeBoundingBox=function(){if(0==this.bezierCurves.length)return new BoundingBox(0,0,0,0);for(var t=this.bezierCurves[0].computeBoundingBox(),e=1;e<this.bezierCurves.length;e++){var i=this.bezierCurves[e].computeBoundingBox();t.xMin=Math.min(t.xMin,i.xMin),t.xMax=Math.max(t.xMax,i.xMax),t.yMin=Math.min(t.yMin,i.yMin),t.yMax=Math.max(t.yMax,i.yMax)}return t},e.prototype.moveCurvePoint=function(t,e,i){if(this.getCurveAt(t).moveCurvePoint(e,i,!0,!0),e==this.START_POINT&&(t>0||this.adjustCircular))this.getCurveAt(t-1<0?this.bezierCurves.length+(t-1):t-1).moveCurvePoint(this.END_CONTROL_POINT,i,!0,!1);else if(e==this.END_POINT&&(t+1<this.bezierCurves.length||this.adjustCircular)){this.getCurveAt((t+1)%this.bezierCurves.length).moveCurvePoint(this.START_CONTROL_POINT,i,!0,!1)}else e==this.START_CONTROL_POINT&&t>0?this.adjustPredecessorControlPoint(t,!0,!1):e==this.END_CONTROL_POINT&&t+1<this.getCurveCount()&&this.adjustSuccessorControlPoint(t,!0,!1);this.updateArcLengths()},e.prototype.adjustPredecessorControlPoint=function(t,e,i){if(!this.adjustCircular&&t<=0)return!1;var n=this.getCurveAt(t),r=this.getCurveAt(t-1<0?this.getCurveCount()+(t-1):t-1);return this.adjustNeighbourControlPoint(n,r,n.getStartPoint(),n.getStartControlPoint(),r.getEndPoint(),r.getEndControlPoint(),e,i)},e.prototype.adjustSuccessorControlPoint=function(t,e,i){if(!this.adjustCirculat&&t+1>this.getCurveCount())return!1;var n=this.getCurveAt(t),r=this.getCurveAt((t+1)%this.getCurveCount());return this.adjustNeighbourControlPoint(n,r,n.getEndPoint(),n.getEndControlPoint(),r.getStartPoint(),r.getStartControlPoint(),e,i)},e.prototype.adjustNeighbourControlPoint=function(t,e,i,n,r,s,o,a){var h=new Vertex(n.x-i.x,n.y-i.y),u=new Vertex(s.x-r.x,s.y-r.y),l=Math.sqrt(Math.pow(h.x,2)+Math.pow(h.y,2)),c=Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2));l<=.1||(s.set(r.x-h.x*(c/l),r.y-h.y*(c/l)),e.updateArcLengths())},e.prototype.clone=function(){for(var t=new e(null),i=0;i<this.bezierCurves.length;i++)t.bezierCurves.push(this.bezierCurves[i].clone()),i>0&&(t.bezierCurves[i-1].endPoint=t.bezierCurves[i].startPoint);return t.updateArcLengths(),t},e.prototype.equals=function(t){if(!t)return!1;if(!t.bezierCurves)return!1;if(void 0===t.bezierCurves.length)return!1;if(t.bezierCurves.length!=this.bezierCurves.length)return!1;for(var e=0;e<this.bezierCurves.length;e++)if(!this.bezierCurves[e].equals(t.bezierCurves[e]))return!1;return!0},e.prototype.toJSON=function(t){var e=[];e.push("[");for(var i=0;i<this.bezierCurves.length;i++)i>0&&e.push(","),t?e.push("\n\t"):e.push(" "),e.push(this.bezierCurves[i].toJSON(t));return 0!=this.bezierCurves.length&&e.push(" "),e.push("]"),e.join("")},e.fromJSON=function(t){var e=JSON.parse(t);return IKRS.BezierPath.fromArray(e)},e.fromArray=function(t){if(!Array.isArray(t))throw"[IKRS.BezierPath.fromArray] Passed object must be an array.";if(t.length<1)throw"[IKRS.BezierPath.fromArray] Passed array must contain at least one bezier curve (has "+t.length+").";for(var i=new e(null),n=null,r=0;r<t.length;r++){var s=null;s=0 in t[r]&&1 in t[r]&&2 in t[r]&&3 in t[r]?CubicBezierCurve.fromArray(t[r]):CubicBezierCurve.fromObject(t[r]),n&&(s.startPoint=n.endPoint),i.bezierCurves.push(s),i.totalArcLength+=s.getLength(),n=s}return i},e.prototype.toReducedListRepresentation=function(t){void 0===t&&(t=1);var i=[];i.push("[");for(var n=0;n<this.bezierCurves.length;n++){var r=this.bezierCurves[n];i.push(e._roundToDigits(r.getStartPoint().x,t,!1)),i.push(","),i.push(e._roundToDigits(r.getStartPoint().y,t,!1)),i.push(","),i.push(e._roundToDigits(r.getStartControlPoint().x,t,!1)),i.push(","),i.push(IKRS.BezierPath._roundToDigits(r.getStartControlPoint().y,t,!1)),i.push(","),i.push(e._roundToDigits(r.getEndControlPoint().x,t,!1)),i.push(","),i.push(e._roundToDigits(r.getEndControlPoint().y,t,!1)),i.push(",")}if(0!=this.bezierCurves.length){r=this.bezierCurves[this.bezierCurves.length-1];i.push(e._roundToDigits(r.getEndPoint().x,t,!1)),i.push(","),i.push(e._roundToDigits(r.getEndPoint().y,t,!1))}return i.push("]"),i.join("")},e.fromReducedListRepresentation=function(t){var i=JSON.parse(t);if(!i.length)throw console.log("Cannot parse bezier path from non-array object nor from empty point list."),"Cannot parse bezier path from non-array object nor from empty point list.";if(i.length<8)throw console.log("Cannot build bezier path. The passed array must contain at least 8 elements (numbers)."),"Cannot build bezier path. The passed array must contain at least 8 elements (numbers).";var n=new e(null),r=null,s=null,o=null,a=null,h=0;do{0==h&&(r=new Vertex(i[h],i[h+1])),s=new Vertex(i[h+2],i[h+3]),o=new Vertex(i[h+4],i[h+5]),a=new Vertex(i[h+6],i[h+7]);var u=new CubicBezierCurve(r,a,s,o);n.bezierCurves.push(u),r=a,h+=6}while(h+2<i.length);return n.updateArcLengths(),n},e._roundToDigits=function(t,e,i){if(e<=0)return Math.round(t);var n=Math.pow(10,e),r=""+(t=Math.round(t*n))/n,s=r.lastIndexOf(".");if(-1==s&&(s=r.length),i)for(var o=i-(r.length-s-1);o-- >0;)r+="&nbsp;";return r},t.BezierPath=e}(window)},function(t,e,i){(function(t){!function(t){t.Polygon=function(t,e){void 0===t&&(t=[]),this.vertices=t,this.isOpen=e},t.Polygon.prototype.containsVert=function(t){for(var e=!1,i=0,n=this.vertices.length-1;i<this.vertices.length;n=i++){var r=this.vertices[i].x,s=this.vertices[i].y,o=this.vertices[n].x,a=this.vertices[n].y;s>t.y!=a>t.y&&t.x<(o-r)*(t.y-s)/(a-s)+r&&(e=!e)}return e},t.Polygon.prototype.toQuadraticBezierData=function(){if(this.vertices.length<3)return[];var t=[],e=this.vertices[0],i=this.vertices[1],n=new Vertex(e.x+(i.x-e.x)/2,e.y+(i.y-e.y)/2);t.push(n);for(var r=this.isOpen?this.vertices.length:this.vertices.length+1,s=1;s<r;s++){e=this.vertices[s%this.vertices.length],i=this.vertices[(s+1)%this.vertices.length];n=new Vertex(e.x+(i.x-e.x)/2,e.y+(i.y-e.y)/2);t.push(e),t.push(n),e=i}return t},t.Polygon.prototype.toQuadraticBezierSVGString=function(){var t=this.toQuadraticBezierData();if(0==t.length)return"";for(var e=["M "+t[0].x+" "+t[0].y],i=1;i<t.length;i+=2)e.push("Q "+t[i].x+" "+t[i].y+", "+t[i+1].x+" "+t[i+1].y);return e.join(" ")},t.Polygon.prototype.toCubicBezierData=function(t){if(void 0===t&&(t=1),this.vertices.length<3)return[];var e=[],i=this.vertices[0],n=this.vertices[1],r=new Vertex(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2);e.push(r);for(var s=this.isOpen?this.vertices.length-1:this.vertices.length,o=0;o<s;o++){i=this.vertices[o%this.vertices.length],n=this.vertices[(o+1)%this.vertices.length];var a=this.vertices[(o+2)%this.vertices.length],h=new Vertex(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2),u=new Vertex(n.x+(a.x-n.x)/2,n.y+(a.y-n.y)/2),l=new Vertex(h.x+(n.x-h.x)*t,h.y+(n.y-h.y)*t),c=new Vertex(u.x+(n.x-u.x)*t,u.y+(n.y-u.y)*t);e.push(l),e.push(c),e.push(u)}return e},t.Polygon.prototype.toCubicBezierSVGString=function(t){var e=this.toCubicBezierData(t);if(0==e.length)return"";for(var i=["M "+e[0].x+" "+e[0].y],n=1;n<e.length;n+=3)i.push("C "+e[n].x+" "+e[n].y+", "+e[n+1].x+" "+e[n+1].y+", "+e[n+2].x+" "+e[n+2].y);return i.join(" ")}}(window||t.export)}).call(this,i(0)(t))},function(t,e){!function(t){window.MouseHandler=function(t){var e=null,i=null,n=-1,r={},s={},o={};function a(t){return{x:t.pageX-t.target.offsetLeft,y:t.pageY-t.target.offsetTop}}function h(r,s){var o=a(r);return r.params={element:t,name:s,pos:o,button:n,leftButton:0==n,middleButton:1==n,rightButton:2==n,mouseDownPos:e,draggedFrom:i,wasDragged:null!=e&&(e.x!=o.x||e.y!=o.y),dragAmount:null!=e?{x:o.x-i.x,y:o.y-i.y}:{x:0,y:0}},r}function u(e){s[e]||(t.addEventListener(e,o[e]),s[e]=!0)}function l(e){s[e]&&(t.removeEventListener(e,o[e]),delete s[e])}o.mousemove=function(t){r.mousemove&&r.mousemove(h(t,"mousemove")),i&&r.drag&&r.drag(h(t,"drag")),e&&(i=a(t))},o.mouseup=function(t){r.mouseup&&r.mouseup(h(t,"mouseup")),i=null,e=null,n=-1},o.mousedown=function(t){i=a(t),e=a(t),n=t.button,r.mousedown&&r.mousedown(h(t,"mousedown"))},o.click=function(t){r.click&&r.click(h(t,"mousedown"))},this.drag=function(t){if(r.drag)throw"This MouseHandler already has a 'drag' callback.";return r.drag=t,u("mousedown"),u("mousemove"),u("mouseup"),r.drag=t,this},this.move=function(t){if(r.mousemove)throw"This MouseHandler already has a 'mousemove' callback. To keep the code simple there is only room for one.";return u("mousemove"),r.mousemove=t,this},this.up=function(t){if(r.mouseup)throw"This MouseHandler already has a 'mouseup' callback. To keep the code simple there is only room for one.";return u("mouseup"),r.mouseup=t,this},this.down=function(t){if(r.mousedown)throw"This MouseHandler already has a 'mousedown' callback. To keep the code simple there is only room for one.";return u("mousedown"),r.mousedown=t,this},this.click=function(t){if(r.click)throw"This MouseHandler already has a 'click' callback. To keep the code simple there is only room for one.";return u("click"),r.click=t,this},this.destroy=function(){console.log("destroy"),l("mousedown"),l("mousemove"),l("moseup"),l("click")}}}()},function(t,e){!function(t){"use strict";var e=function(t){t=t||{},this.element=t.element?t.element:window,this.downListeners=[],this.pressListeners=[],this.upListeners=[],this.keyStates=[],this.trackAllKeys=t.trackAll||!1,this._keyDownListener=null,this._keyPressListener=null,this._keyUpListener=null,this.installListeners()},i=function(t,e){var i=!1;for(var n in e){var r=e[n];r.keyCode==t.keyCode&&(r.listener(t),i=!0)}return i},n=function(t){if("number"==typeof t)return t;if("string"!=typeof t)throw"Unknown key name or key type (should be a string or integer): "+t;if(e.KEY_CODES[t])return e.KEY_CODES[t];throw"Unknown key (cannot resolve key code): "+t};e.KEY_CODES={break:3,backspace:8,delete:8,tab:9,clear:12,enter:13,shift:16,ctrl:17,alt:18,pause:19,break:19,capslock:20,hangul:21,hanja:25,escape:27,conversion:28,"non-conversion":29,spacebar:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,select:41,print:42,execute:43,printscreen:44,insert:45,delete:46,help:47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,"semicolon (firefox)":59,equals:59,"<":60,"equals (firefox)":61,"ß":63,"@ (firefox)":64,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,windows:91,leftcommand:91,chromebooksearch:91,rightwindowkey:92,windowsmenu:93,rightcommant:93,sleep:95,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,numpadperiod:108,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126,f16:127,f17:128,f18:129,f19:130,f20:131,f21:132,f22:133,f23:134,f24:135,numlock:144,scrolllock:145,"^":160,"!":161,"#":163,$:164,"ù":165,pagebackward:166,pageforward:167,refresh:168,closingparen:169,"*":170,"~+*":171,home:172,minus:173,mute:173,unmute:173,decreasevolumelevel:174,increasevolumelevel:175,next:176,previous:177,stop:178,"play/pause":179,email:180,mute:181,unmute:181,semicolon:186,"ñ":186,equal:187,comma:188,dash:189,period:190,forwardslash:191,"ç":191,"grave accent":192,"æ":192,"ö":192,"?":193,"/":193,"°":193,numpadperiod:194,openbracket:219,backslash:220,closebracket:221,"å":221,singlequote:222,"ø":222,"ä":222,"`":223,altgr:225,"GNOME Compose Key":230,"ç":231,XF86Forward:233,XF86Back:234,"non-conversion":235,alphanumeric:240,hiragana:242,katakana:242,"half-width":243,"full-width":243,kanji:244,unlocktrackpad:251,toggletouchpad:255},e.prototype.installListeners=function(){var t=this;this.element.addEventListener("keydown",this.keyDownListener=function(e){!function(t,e){(i(t,e.downListeners)||e.trackAllKeys)&&(e.keyStates[t.keyCode]="down")}(e,t)}),this.element.addEventListener("keypress",this.keyPressListener=function(e){!function(t,e){i(t,e.pressListeners)}(e,t)}),this.element.addEventListener("keyup",this.keyUpListener=function(e){!function(t,e){(i(t,e.upListeners)||e.trackAllKeys)&&delete e.keyStates[t.keyCode]}(e,t)})},e.prototype.releaseListeners=function(){this.element.removeEventListener("keydown",this.keyDownListener),this.element.removeEventListener("keypress",this.keyPressListener),this.element.removeEventListener("keyup",this.keyUpListener)},e.prototype.down=function(t,e){return this.downListeners.push({key:t,keyCode:n(t),listener:e}),this},e.prototype.press=function(t,e){return this.pressListeners.push({key:t,keyCode:n(t),listener:e}),this},e.prototype.up=function(t,e){return this.upListeners.push({key:t,keyCode:n(t),listener:e}),this},e.prototype.isDown=function(t){return!!this.keyStates[n(t)]},t.KeyHandler=e}(window)},function(t,e,i){(function(t){!function(t){"use strict";t.drawutils=function(t,e){this.ctx=t,this.offset=new Vertex(0,0),this.scale=new Vertex(1,1),this.fillShapes=e},t.drawutils.prototype.line=function(t,e,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.strokeStyle=i,this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.restore()},t.drawutils.prototype._fillOrDraw=function(t){this.fillShapes?(this.ctx.fillStyle=t,this.ctx.fill()):(this.ctx.strokeStyle=t,this.ctx.stroke())},t.drawutils.prototype.cubicBezier=function(t,e,i,n,r){t instanceof CubicBezierCurve?this.cubicBezier(t.startPoint,t.endPoint,t.startControlPoint,t.endControlPoint,e):(this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.bezierCurveTo(this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y,this.offset.x+n.x*this.scale.x,this.offset.y+n.y*this.scale.y,this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.lineWidth=2,this._fillOrDraw(r),this.ctx.restore())},t.drawutils.prototype.handle=function(t,e){this.point(t,"rgb(0,32,192)"),this.square(e,5,"rgba(0,128,192,0.5)")},t.drawutils.prototype.cubicBezierCurveHandleLines=function(t){this.cubicBezierHandleLines(t.startPoint,t.endPoint,t.startControlPoint,t.endControlPoint)},t.drawutils.prototype.handleLine=function(t,e){this.line(t,e,"rgb(192,192,192)")},t.drawutils.prototype.point=function(t,e){this.ctx.beginPath(),this.ctx.arc(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,3,0,2*Math.PI,!1),this.ctx.closePath(),this._fillOrDraw(e)},t.drawutils.prototype.circle=function(t,e,i){this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e*this.scale.x,e*this.scale.y,0,0,2*Math.PI),this.ctx.closePath(),this._fillOrDraw(i)},t.drawutils.prototype.square=function(t,e,i){this.ctx.beginPath(),this.ctx.rect(this.offset.x+(t.x-e/2)*this.scale.x,this.offset.y+(t.y-e/2)*this.scale.y,e*this.scale.x,e*this.scale.y),this.ctx.closePath(),this._fillOrDraw(i)},t.drawutils.prototype.diamondHandle=function(t,e,i){this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e/2,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y-e/2),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e/2,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y+e/2),this.ctx.closePath(),this._fillOrDraw(i)},t.drawutils.prototype.squareHandle=function(t,e,i){this.ctx.beginPath(),this.ctx.rect(this.offset.x+t.x*this.scale.x-e/2,this.offset.y+t.y*this.scale.y-e/2,e,e),this.ctx.closePath(),this._fillOrDraw(i)},t.drawutils.prototype.crosshair=function(t,e,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e,this.offset.y+t.y*this.scale.y),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y-e),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y+e),this.ctx.strokeStyle=i,this.ctx.lineWidth=.5,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()},t.drawutils.prototype.polygon=function(t,e){if(!(t.vertices.length<=1)){this.ctx.save(),this.ctx.beginPath(),this.ctx.setLineDash([3,5]),this.ctx.lineWidth=1,this.ctx.moveTo(this.offset.x+t.vertices[0].x*this.scale.x,this.offset.y+t.vertices[0].y*this.scale.y);for(var i=0;i<t.vertices.length;i++)this.ctx.lineTo(this.offset.x+t.vertices[i].x*this.scale.x,this.offset.y+t.vertices[i].y*this.scale.y);!t.isOpen&&t.vertices.length>2&&this.ctx.closePath(),this._fillOrDraw(e),this.ctx.setLineDash([]),this.ctx.restore()}},t.drawutils.prototype.string=function(t,e,i){this.fillShapes?(this.ctx.fillStyle="black",this.ctx.fillText(t,e,i)):(this.ctx.strokeStyle="black",this.ctx.strokeText(t,e,i))}}(window||t.export)}).call(this,i(0)(t))},function(t,e){!function(t){"use strict";var e=function(t){this.wrapper=document.getElementById(t),this.blanket=this.wrapper.getElementsByClassName("overlay-blanket")[0],this.content=this.blanket.getElementsByClassName("overlay-content")[0],n(this.wrapper,{display:"none",position:"fixed",left:"0px",top:"0px",width:"100vw",height:"100vh"}),n(this.blanket,{width:"100%",height:"100%",display:"flex","align-items":"center","justify-content":"center",background:"rgba(0,0,0,0.5)"}),n(this.content,{width:"500px",height:"500px","max-width":"50%","max-height":"50%",background:"white",border:"1px solid grey","border-radius":"5px",position:"relative"}),this._headLine=document.createElement("h3"),this._contentNode=document.createElement("div"),this._buttonLine=document.createElement("div"),this.content.innerHTML="",this.content.appendChild(this._headLine),this.content.appendChild(this._contentNode),this.content.appendChild(this._buttonLine),this._textArea=null,n(this._headLine,{width:"calc(100% - 10px)",overflow:"hidden","border-bottom":"1px solid grey",margin:"6px 0px",padding:"0px 5px 3px"}),n(this._contentNode,{width:"calc(100% - 10px)",overflow:"hidden",margin:"0px",padding:"0px 5px",position:"absolute",top:"30px",height:"calc(100% - 60px)"}),n(this._buttonLine,{width:"calc(100% - 10px)",overflow:"hidden",position:"absolute",top:"auto",bottom:"0px","text-align":"right"}),s(this._headLine,"od-hl"),s(this._contentNode,"od-cn"),s(this._buttonLine,"od-bl")};function i(t,e){if("string"==typeof e&&"close"==e)i(t,{label:"Close",onclick:function(){r(t)}});else if("string"==typeof e&&"ok"==e)console.log("add ok button"),i(t,{label:"OK",onclick:function(){r(t)}});else{var n=document.createElement("button");n.type="button",n.innerHTML=e.label?e.label:"no-label","function"==typeof e.action?n.addEventListener("click",e.action):"close"==e.action&&n.addEventListener("click",function(){r(t)}),t._buttonLine.appendChild(n)}}function n(t,e){for(var i in e)t.style[i]=e[i]}function r(t){t.wrapper.style.display="none"}function s(t,e){var i=t.className.split(" ");-1==i.indexOf(e)&&(i.push(e),t.className=i.join(" "))}e.prototype.show=function(t,e,n,r){if(this._headLine.innerHTML=e||"Please confirm",this.setMessage(t,r),this._buttonLine.innerHTML="",n)for(var s in n)i(this,n[s]);else i(this,"ok");this.wrapper.style.display="inherit"},e.prototype.setMessage=function(t,e){e={}||e,"string"==typeof t?(this._contentNode.innerHTML=t,e.messageClass&&s(this._contentNode,e.messageClass)):(this._contentNode.innerHTML="",this._contentNode.appendChild(t))},e.prototype.showTextArea=function(t,e,i,n){this._textArea=document.createElement("textarea"),this._textArea.innerHTML=t||"",this._textArea.style.width="100%",this._textArea.style.height="95%",this._textArea.style.border="0px",n&&n.messageClass&&(this._textArea.className=n.messageClass),this.show(this._textArea,e,i,n)},e.prototype.hide=function(){r(this)},t.overlayDialog=e}(window)},function(t,e){!function(t){"use strict";!function(t){var e=function(t,e){this.item=t,this.type=e,this.vindex=null,this.pindex=null,this.cindex=null};e.VERTEX="vertex",e.prototype.isVertex=function(){return this.type==e.VERTEX},e.prototype.setVIndex=function(t){return this.vindex=t,this},t.Draggable=e}(t),VertexAttr.model={bezierAutoAdjust:!1,renderTime:0};var e=function(i){this.config={fullSize:!0,fitToParent:!0,scaleX:1,scaleY:1,backgroundColor:"#ffffff",rebuild:function(){s()},loadImage:function(){var t=document.getElementById("file");t.setAttribute("data-type","image-upload"),function(t){t.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))}(t)},saveFile:function(){r()}},this.canvas=document.getElementById("my-canvas"),this.ctx=this.canvas.getContext("2d"),this.draw=new drawutils(this.ctx,!1),this.draw.scale.set(this.config.scaleX,this.config.scaleY),this.fill=new drawutils(this.ctx,!0),this.fill.scale.set(this.config.scaleX,this.config.scaleY),this.image=null,this.imageBuffer=null,this.canvasSize={width:1024,height:768},this.vertices=[],this.selectPolygon=null,this.draggedElements=[],this.drawables=[];var n=this;e.prototype.initDrawableObjects=function(){var t=Math.min(n.canvasSize.width,n.canvasSize.height)/3,e=[];e[0]=[new Vertex(0,-t),new Vertex(t,0),new Vertex(.5*t,-t),new Vertex(.5*t,0)],e[1]=[e[0][1],new Vertex(0,t),new Vertex(t,.5*t),new Vertex(0,.5*t)],e[2]=[e[1][1],new Vertex(-t,0),new Vertex(.5*-t,t),new Vertex(.5*-t,0)],e[3]=[e[2][1],e[0][0],new Vertex(-t,.5*-t),new Vertex(0,.5*-t)],this.vertices=[];var i=BezierPath.fromArray(e);for(var r in i.adjustCircular=!0,this.drawables.push(i),e)this.vertices.push(e[r][0]),this.vertices.push(e[r][1]),this.vertices.push(e[r][2]),this.vertices.push(e[r][3]),function(t){e[t][0].listeners.addDragListener(function(n){e[t][0].addXY(-n.params.dragAmount.x,-n.params.dragAmount.y),i.moveCurvePoint(1*t,i.START_POINT,n.params.dragAmount)}),e[t][2].listeners.addDragListener(function(n){e[t][0].attr.bezierAutoAdjust&&i.adjustPredecessorControlPoint(1*t,!0,!0)}),e[t][3].listeners.addDragListener(function(n){!i.adjustCircular&&t+1>=i.bezierCurves.length||e[(t+1)%e.length][0].attr.bezierAutoAdjust&&i.adjustSuccessorControlPoint(1*t,!0,!0)})}(r);var s=[new Vertex(-32,-32),new Vertex(32,-32),new Vertex(32,32),new Vertex(-32,32)],o=new Polygon(s);for(var r in this.drawables.push(o),s)this.vertices.push(s[r])},e.prototype.redraw=function(){var t=(new Date).getTime();this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.canvasSize.width,this.canvasSize.height),n.image&&(n.config.fitImage?n.ctx.drawImage(n.image,0,0,n.image.width,n.image.height,0,0,n.canvasSize.width,n.canvasSize.height):n.ctx.drawImage(n.image,0,0));var e=Math.min(n.canvasSize.width,n.canvasSize.height)/3;for(var i in n.draw.circle({x:0,y:0},e,"#000000"),this.drawables){var r=this.drawables[i];if(r instanceof BezierPath)for(var s in r.bezierCurves)this.draw.cubicBezier(r.bezierCurves[s].startPoint,r.bezierCurves[s].endPoint,r.bezierCurves[s].startControlPoint,r.bezierCurves[s].endControlPoint,"#00a822"),r.bezierCurves[s].startPoint.attr.bezierAutoAdjust||(this.draw.diamondHandle(r.bezierCurves[s].startPoint,7,"orange"),r.bezierCurves[s].startPoint.attr.renderTime=t),r.bezierCurves[s].endPoint.attr.bezierAutoAdjust||(this.draw.diamondHandle(r.bezierCurves[s].endPoint,7,"orange"),r.bezierCurves[s].endPoint.attr.renderTime=t),this.draw.handleLine(r.bezierCurves[s].startPoint,r.bezierCurves[s].startControlPoint),this.draw.handleLine(r.bezierCurves[s].endPoint,r.bezierCurves[s].endControlPoint);else if(r instanceof Polygon)for(var i in this.draw.polygon(r,"#0022a8"),r.vertices);else console.error("Cannot draw object. Unknown class "+r.constructor.name+".")}for(var i in this.vertices)this.vertices[i].attr.renderTime!=t&&this.draw.squareHandle(this.vertices[i],5,this.vertices[i].attr.isSelected?"rgba(192,128,0)":"rgb(0,128,192)");null!=this.selectPolygon&&this.selectPolygon.vertices.length>0&&(console.log("Drawing selectPolygon",this.selectPolygon.vertices.length,"vertices"),this.draw.polygon(this.selectPolygon,"#888888"),this.draw.crosshair(this.selectPolygon.vertices[0],3,"#008888"))};e.prototype.clearSelection=function(t){for(var e in this.vertices)this.vertices[e].attr.isSelected=!1;return t&&this.redraw(),this};document.getElementById("file").addEventListener("change",function(t){var e=document.getElementById("file").getAttribute("data-type");"image-upload"==e?function(t){if(-1!="image/gif,image/jpeg,image/jpg,image/gif,image/png".indexOf(t.target.files[0].type)||window.confirm("This seems not to be an image ("+t.target.files[0].type+"). Continue?")){var e=new FileReader;e.onload=function(t){this.image=new Image,this.image.onload=function(){var t=document.createElement("canvas");t.width=this.image.width,t.height=this.image.height,t.getContext("2d").drawImage(this.image,0,0,this.image.width,image.height),alert("Sorry, not yet implemented.")},this.image.src=t.target.result},e.readAsDataURL(t.target.files[0])}}(t):console.warn("Unrecognized upload type: "+e)});var r=function(){var t=new Blob(["Hello, world!\nSorry, exporting SVGs is not yet implemented."],{type:"text/plain;charset=utf-8"});saveAs(t,"helloworld.txt")},s=function(){};e.prototype.resizeCanvas=function(){var t=function(t,e){n.ctx.canvas.width=t,n.ctx.canvas.height=e,n.canvas.width=t,n.canvas.height=e,n.canvasSize.width=t,n.canvasSize.height=e,n.draw.offset.x=n.fill.offset.x=t/2,n.draw.offset.y=n.fill.offset.y=e/2};if(n.config.fullSize&&!n.config.fitToParent)t(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight);else if(n.config.fitToParent){t(n.canvas.parentNode.clientWidth-2,n.canvas.parentNode.clientHeight-2)}else t(1024,768);n.redraw()},t.addEventListener("resize",this.resizeCanvas),this.resizeCanvas(),e.prototype.selectVerticesInPolygon=function(t){for(var e in this.vertices)t.containsVert(this.vertices[e])&&(this.vertices[e].attr.isSelected=!0)};var o=function(t){for(var e in n.vertices){var i=n.vertices[e];if(i.distance(t)<7)return new Draggable(i,Draggable.VERTEX).setVIndex(e)}return!1};var a=function(t,e){return{x:(t-n.draw.offset.x)/n.draw.scale.x,y:(e-n.draw.offset.y)/n.draw.scale.y}};new MouseHandler(this.canvas).down(function(t){if(1==t.which){var e=o(a(t.params.pos.x,t.params.pos.y));if(console.log(e),e){if("vertex"==e.type&&n.vertices[e.vindex].attr.isSelected)for(var i in n.vertices)n.vertices[i].attr.isSelected&&(n.draggedElements.push(new Draggable(n.vertices[i],Draggable.VERTEX).setVIndex(i)),n.vertices[i].listeners.fireDragStartEvent(t));else n.draggedElements.push(e),"bpath"==e.type?n.paths[e.pindex].bezierCurves[e.cindex].getPointByID(e.pid).listeners.fireDragStartEvent(t):"vertex"==e.type&&n.vertices[e.vindex].listeners.fireDragStartEvent(t);n.redraw()}}}).drag(function(t){if(t.params.dragAmount.x/=n.draw.scale.x,t.params.dragAmount.y/=n.draw.scale.y,h.isDown("ctrl"))n.draw.offset.add(t.params.dragAmount),n.fill.offset.set(n.draw.offset),n.redraw();else for(var e in n.draggedElements){var i=n.draggedElements[e];"bpath"==i.type?(n.paths[i.pindex].moveCurvePoint(i.cindex,i.pid,t.params.dragAmount),n.paths[i.pindex].bezierCurves[i.cindex].getPointByID(i.pid).listeners.fireDragEvent(t)):"vertex"==i.type&&(n.vertices[i.vindex].add(t.params.dragAmount),n.vertices[i.vindex].listeners.fireDragEvent(t))}n.redraw()}).up(function(t){if(1==t.which){for(var e in t.params.wasDragged||function(t,e){var i=o(a(t,e));if(i)if(h.isDown("shift")){if("bpath"==i.type){let t=n.paths[i.pindex].bezierCurves[i.cindex].getPointByID(i.pid);t.attr.isSelected=!t.attr.isSelected}else"vertex"==i.type&&(n.vertices[i.vindex].attr.isSelected=!n.vertices[i.vindex].attr.isSelected);n.redraw()}else h.isDown("y")&&(n.vertices[i.vindex].attr.bezierAutoAdjust=!n.vertices[i.vindex].attr.bezierAutoAdjust,console.log("bezierAutoAdjust="+n.vertices[i.vindex].attr.bezierAutoAdjust),n.redraw());else if(null!=n.selectPolygon){var r=a(t,e);n.selectPolygon.vertices.push(r),n.redraw()}}(t.params.pos.x,t.params.pos.y),n.draggedElements){var i=n.draggedElements[e];"bpath"==i.type?n.paths[i.pindex].bezierCurves[i.cindex].getPointByID(i.pid).listeners.fireDragEndEvent(t):"vertex"==i.type&&n.vertices[i.vindex].listeners.fireDragEndEvent(t)}n.draggedElements=[],n.redraw()}});var h=new KeyHandler({trackAll:!0}).down("enter",function(){console.log("ENTER was hit.")}).press("enter",function(){console.log("ENTER was pressed.")}).up("enter",function(){console.log("ENTER was released.")}).down("escape",function(){console.log("ESCAPE was hit."),n.clearSelection(!0)}).down("shift",function(){console.log("SHIFT was hit."),n.selectPolygon=new Polygon,n.redraw()}).up("shift",function(){console.log("SHIFT was released."),null!=n.selectPolygon&&(n.selectVerticesInPolygon(n.selectPolygon),n.selectPolygon=null,n.redraw())}).down("y",function(){console.log("y was hit.")}).up("y",function(){console.log("y was released.")}).down("e",function(){console.log("e was hit. shift is pressed?",h.isDown("shift"))}).up("windows",function(){console.log("windows was released.")});window.dialog=new overlayDialog("dialog-wrapper"),this.initDrawableObjects(),this.redraw(),this.canvas.focus()};t.PlotBoilerplate=e}(window)}]);