!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("pb",[],e):"object"==typeof exports?exports.pb=e():t.pb=e()}(window,function(){return function(t){function e(s){if(i[s])return i[s].exports;var r=i[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)e.d(s,r,function(e){return t[e]}.bind(null,r));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=20)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(4),r=i(10),n=function(){function t(t,e){if(this.className="Vertex","undefined"==typeof t)this.x=0,this.y=0;else if("number"==typeof t&&"number"==typeof e)this.x=t,this.y=e;else{var i=t;"number"==typeof i.x&&"number"==typeof i.y?(this.x=i.x,this.y=i.y):("number"==typeof t?this.x=t:"undefined"==typeof t?this.x=0:this.x=NaN,"number"==typeof e?this.y=e:"undefined"==typeof e?this.y=0:this.y=NaN)}this.attr=new s.VertexAttr,this.listeners=new r.VertexListeners(this)}return t.prototype.set=function(t,e){if("number"==typeof t&&"number"==typeof e)this.x=t,this.y=e;else{var i=t;"number"==typeof i.x&&"number"==typeof i.y?(this.x=i.x,this.y=i.y):("number"==typeof t?this.x=t:"undefined"==typeof t?this.x=0:this.x=NaN,"number"==typeof e?this.y=e:"undefined"==typeof e?this.y=0:this.y=NaN)}return this},t.prototype.setX=function(t){return this.x=t,this},t.prototype.setY=function(t){return this.y=t,this},t.prototype.invX=function(){return this.x=-this.x,this},t.prototype.invY=function(){return this.y=-this.y,this},t.prototype.add=function(t,e){if("number"==typeof t&&"number"==typeof e)this.x+=t,this.y+=e;else{var i=t;"number"==typeof i.x&&"number"==typeof i.y?(this.x+=i.x,this.y+=i.y):("number"==typeof t?this.x+=t:console.warn("Cannot add "+typeof t+" to numeric x component!"),"number"==typeof e?this.y+=e:console.warn("Cannot add "+typeof e+" to numeric y component!"))}return this},t.prototype.addXY=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.addX=function(t){return this.x+=t,this},t.prototype.addY=function(t){return this.y+=t,this},t.prototype.sub=function(t,e){if("number"==typeof t&&"number"==typeof e)this.x-=t,this.y-=e;else{var i=t;"number"==typeof i.x&&"number"==typeof i.y?(this.x-=i.x,this.y-=i.y):("number"==typeof t?this.x-=t:console.warn("Cannot add "+typeof t+" to numeric x component!"),"number"==typeof e?this.y-=e:console.warn("Cannot add "+typeof e+" to numeric y component!"))}return this},t.prototype.equals=function(e){var i=Math.abs(this.x-e.x)<t.EPSILON,s=Math.abs(this.y-e.y)<t.EPSILON,r=i&&s;return r},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.distance=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))},t.prototype.difference=function(e){return new t(e.x-this.x,e.y-this.y)},t.prototype.scale=function(e,i){return i&&"undefined"!=typeof i||(i=new t(0,0)),this.x=i.x+(this.x-i.x)*e,this.y=i.y+(this.y-i.y)*e,this},t.prototype.rotate=function(e,i){i&&"undefined"!=typeof i||(i=new t(0,0)),this.sub(i),e+=Math.atan2(this.y,this.x);var s=this.distance(t.ZERO);this.x,this.y;return this.x=s*Math.cos(e),this.y=s*Math.sin(e),this.add(i),this},t.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},t.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.prototype.inv=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.toString=function(){return"("+this.x+","+this.y+")"},t.prototype.toSVGString=function(t){t=t||{};var e=[];return e.push("<circle"),t.className&&e.push(' class="'+t.className+'"'),e.push(' cx="'+this.x+'"'),e.push(' cy="'+this.y+'"'),e.push(' r="2"'),e.push(" />"),e.join("")},t.randomVertex=function(e){return new t(e.min.x+Math.random()*(e.max.x-e.min.x),e.min.y+Math.random()*(e.max.y-e.min.y))},t.ZERO=new t(0,0),t.EPSILON=1e-6,t.utils={buildArrowHead:function(e,i,s,r,n){var o=Math.atan2((i.y-e.y)*n,(i.x-e.x)*r),a=[];return a.push(new t(i.x*r-s*Math.cos(o),i.y*n-s*Math.sin(o))),a.push(new t(i.x*r-1.35*s*Math.cos(o-Math.PI/8),i.y*n-1.35*s*Math.sin(o-Math.PI/8))),a.push(new t(i.x*r,i.y*n)),a.push(new t(i.x*r-1.35*s*Math.cos(o+Math.PI/8),i.y*n-1.35*s*Math.sin(o+Math.PI/8))),a}},t}();e.Vertex=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){this.min=t,this.max=e,this.width=e.x-t.x,this.height=e.y-t.y}return t}();e.Bounds=s},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i(12),n=i(0),o=function(t){function e(i,s){var r=t.call(this,i,s,function(t,i){return new e(t,i)})||this;return r.className="Line",r}return s(e,t),e.prototype.intersection=function(t){var e=this.denominator(t);if(0==e)return null;var i=this.a.y-t.a.y,s=this.a.x-t.a.x,r=(t.b.x-t.a.x)*i-(t.b.y-t.a.y)*s,o=(this.b.x-this.a.x)*i-(this.b.y-this.a.y)*s;return i=r/e,s=o/e,new n.Vertex(this.a.x+i*(this.b.x-this.a.x),this.a.y+i*(this.b.y-this.a.y))},e.prototype.toSVGString=function(t){t=t||{};var e=[];return e.push("<line"),t.className&&e.push(' class="'+t.className+'"'),e.push(' x1="'+this.a.x+'"'),e.push(' y1="'+this.a.y+'"'),e.push(' x2="'+this.b.x+'"'),e.push(' y2="'+this.b.y+'"'),e.push(" />"),e.join("")},e}(r.VertTuple);e.Line=o},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i(12),n=i(0),o=function(t){function e(i,s){var r=t.call(this,i,s,function(t,i){return new e(t,i)})||this;return r.className="Vector",r}return s(e,t),e.prototype.perp=function(){var t=this.clone();return t.sub(this.a),t=new e(new n.Vertex,new n.Vertex(-t.b.y,t.b.x)),t.a.add(this.a),t.b.add(this.a),t},e.prototype.inverse=function(){var t=this.a;return this.a=this.b,this.b=t,this},e.prototype.inv=function(){return this.b.x=this.a.x-(this.b.x-this.a.x),this.b.y=this.a.y-(this.b.y-this.a.y),this},e.prototype.intersection=function(t){var e=this.denominator(t);if(0==e)return null;var i=this.a.y-t.a.y,s=this.a.x-t.a.x,r=(t.b.x-t.a.x)*i-(t.b.y-t.a.y)*s,o=(this.b.x-this.a.x)*i-(this.b.y-this.a.y)*s;return i=r/e,s=o/e,new n.Vertex(this.a.x+i*(this.b.x-this.a.x),this.a.y+i*(this.b.y-this.a.y))},e.prototype.toSVGString=function(t){t=t||{};var i=[],s=e.utils.buildArrowHead(this.a,this.b,8,1,1);i.push("<g"),t.className&&i.push(' class="'+t.className+'"'),i.push(">"),i.push("   <line"),i.push(' x1="'+this.a.x+'"'),i.push(' y1="'+this.a.y+'"'),i.push(' x2="'+s[0].x+'"'),i.push(' y2="'+s[0].y+'"'),i.push(" />"),i.push('   <polygon points="');for(var r=0;r<s.length;r++)r>0&&i.push(" "),i.push(""+s[r].x+","+s[r].y);return i.push('"/>'),i.push("</g>"),i.join("")},e.utils={buildArrowHead:function(t,e,i,s,r){var o=Math.atan2((e.y-t.y)*r,(e.x-t.x)*s),a=[];return a.push(new n.Vertex(e.x*s-i*Math.cos(o),e.y*r-i*Math.sin(o))),a.push(new n.Vertex(e.x*s-1.35*i*Math.cos(o-Math.PI/8),e.y*r-1.35*i*Math.sin(o-Math.PI/8))),a.push(new n.Vertex(e.x*s,e.y*r)),a.push(new n.Vertex(e.x*s-1.35*i*Math.cos(o+Math.PI/8),e.y*r-1.35*i*Math.sin(o+Math.PI/8))),a}},e}(r.VertTuple);e.Vector=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this.draggable=!0,this.selectable=!0,this.isSelected=!1;for(var e in t.model)this[e]=t.model[e]}return t.model={draggable:!0,selectable:!0,isSelected:!1},t}();e.VertexAttr=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),r=i(0),n=i(3),o=function(){function t(e,i,s,r){this.START_POINT=t.START_POINT,this.START_CONTROL_POINT=t.START_CONTROL_POINT,this.END_CONTROL_POINT=t.END_CONTROL_POINT,this.END_POINT=t.END_POINT,this.startPoint=e,this.startControlPoint=s,this.endPoint=i,this.endControlPoint=r,this.curveIntervals=30,this.segmentCache=[],this.segmentLengths=[],this.arcLength=null,this.updateArcLengths()}return t.prototype.moveCurvePoint=function(t,e,i,s){t==this.START_POINT?(this.getStartPoint().add(e),i&&this.getStartControlPoint().add(e)):t==this.START_CONTROL_POINT?this.getStartControlPoint().add(e):t==this.END_CONTROL_POINT?this.getEndControlPoint().add(e):t==this.END_POINT?(this.getEndPoint().add(e),i&&this.getEndControlPoint().add(e)):console.log("[CubicBezierCurve.moveCurvePoint] pointID '"+t+"' invalid."),s&&this.updateArcLengths()},t.prototype.translate=function(t){return this.startPoint.add(t),this.startControlPoint.add(t),this.endControlPoint.add(t),this.endPoint.add(t),this},t.prototype.reverse=function(){var t=this.startPoint;return this.startPoint=this.endPoint,this.endPoint=t,t=this.startControlPoint,this.startControlPoint=this.endControlPoint,this.endControlPoint=t,this},t.prototype.getLength=function(){return this.arcLength},t.prototype.updateArcLengths=function(){var t=this.startPoint.clone(),e=new r.Vertex(0,0),i=1/this.curveIntervals;this.segmentCache=[],this.segmentCache.push(this.startPoint),this.segmentLengths=[];for(var s,n=0,o=0;o<=1;)e=this.getPointAt(o),this.segmentCache.push(e),s=t.distance(e),this.segmentLengths.push(s),n+=s,t=e,o+=i;this.arcLength=n},t.prototype.getClosestT=function(t){var e=1,i={t:0,tPrev:0,tNext:1},s=0;do i=this.locateIntervalByDistance(t,i.tPrev,i.tNext,this.curveIntervals),s++;while(s<4&&this.getPointAt(i.tPrev).distance(this.getPointAt(i.tNext))>e);return i.t},t.prototype.locateIntervalByDistance=function(t,e,i,s){for(var r=-1,n=0,o=0,a=i-e,h=0;h<=s;h++){o=e+a*(h/s);var l=this.getPointAt(o),c=l.distance(t);(r==-1||c<n)&&(r=h,n=c)}return{t:e+a*(r/s),tPrev:e+a*(Math.max(0,r-1)/s),tNext:e+a*(Math.min(s,r+1)/s)}},t.prototype.getBounds=function(){for(var t,e=new r.Vertex(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new r.Vertex(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),n=0;n<this.segmentCache.length;n++)t=this.segmentCache[n],e.x=Math.min(e.x,t.x),e.y=Math.min(e.y,t.y),i.x=Math.max(i.x,t.x),i.y=Math.max(i.y,t.y);return new s.Bounds(e,i)},t.prototype.getStartPoint=function(){return this.startPoint},t.prototype.getEndPoint=function(){return this.endPoint},t.prototype.getStartControlPoint=function(){return this.startControlPoint},t.prototype.getEndControlPoint=function(){return this.endControlPoint},t.prototype.getPointByID=function(t){if(t==this.START_POINT)return this.startPoint;if(t==this.END_POINT)return this.endPoint;if(t==this.START_CONTROL_POINT)return this.startControlPoint;if(t==this.END_CONTROL_POINT)return this.endControlPoint;throw new Error("Invalid point ID '"+t+"'.")},t.prototype.getPointAt=function(t){var e=this.startPoint.x*Math.pow(1-t,3)+3*this.startControlPoint.x*t*Math.pow(1-t,2)+3*this.endControlPoint.x*Math.pow(t,2)*(1-t)+this.endPoint.x*Math.pow(t,3),i=this.startPoint.y*Math.pow(1-t,3)+3*this.startControlPoint.y*t*Math.pow(1-t,2)+3*this.endControlPoint.y*Math.pow(t,2)*(1-t)+this.endPoint.y*Math.pow(t,3);return new r.Vertex(e,i)},t.prototype.getPoint=function(t){return this.getPointAt(t/this.arcLength)},t.prototype.getTangentAt=function(t){var e=this.getStartPoint(),i=this.getStartControlPoint(),s=this.getEndControlPoint(),n=this.getEndPoint(),o=t*t,a=1-2*t+o,h=-3*e.x*a+i.x*(3*a-6*(t-o))+s.x*(6*(t-o)-3*o)+3*n.x*o,l=-3*e.y*a+i.y*(3*a-6*(t-o))+s.y*(6*(t-o)-3*o)+3*n.y*o;return new r.Vertex(h,l)},t.prototype.getSubCurveAt=function(e,i){var s=new n.Vector(this.getPointAt(e),this.getTangentAt(e)),r=new n.Vector(this.getPointAt(i),this.getTangentAt(i).inv());return s.b.add(s.a),r.b.add(r.a),s.scale(.33333333*(i-e)),r.scale(.33333333*(i-e)),new t(s.a,r.a,s.b,r.b)},t.prototype.convertU2T=function(t){return Math.max(0,Math.min(1,t/this.arcLength))},t.prototype.getTangent=function(t){return this.getTangentAt(this.convertU2T(t))},t.prototype.getPerpendicular=function(t){return this.getPerpendicularAt(this.convertU2T(t))},t.prototype.getPerpendicularAt=function(t){var e=this.getTangentAt(t);return new r.Vertex(e.y,-e.x)},t.prototype.clone=function(){return new t(this.getStartPoint().clone(),this.getEndPoint().clone(),this.getStartControlPoint().clone(),this.getEndControlPoint().clone())},t.prototype.equals=function(t){return!!t&&(!!(t.startPoint&&t.endPoint&&t.startControlPoint&&t.endControlPoint)&&(this.startPoint.equals(t.startPoint)&&this.endPoint.equals(t.endPoint)&&this.startControlPoint.equals(t.startControlPoint)&&this.endControlPoint.equals(t.endControlPoint)))},t.isInstance=function(e){return e instanceof t},t.prototype.toSVGPathData=function(){var t=[];return t.push("M "),t.push(this.startPoint.x.toString()),t.push(" "),t.push(this.startPoint.y.toString()),t.push(" C "),t.push(this.startControlPoint.x.toString()),t.push(" "),t.push(this.startControlPoint.y.toString()),t.push(" "),t.push(this.endControlPoint.x.toString()),t.push(" "),t.push(this.endControlPoint.y.toString()),t.push(" "),t.push(this.endPoint.x.toString()),t.push(" "),t.push(this.endPoint.y.toString()),t.join("")},t.prototype.toJSON=function(t){var e="{ "+(t?"\n\t":"")+'"startPoint" : ['+this.getStartPoint().x+","+this.getStartPoint().y+"], "+(t?"\n\t":"")+'"endPoint" : ['+this.getEndPoint().x+","+this.getEndPoint().y+"], "+(t?"\n\t":"")+'"startControlPoint": ['+this.getStartControlPoint().x+","+this.getStartControlPoint().y+"], "+(t?"\n\t":"")+'"endControlPoint" : ['+this.getEndControlPoint().x+","+this.getEndControlPoint().y+"]"+(t?"\n\t":"")+" }";return e},t.fromJSON=function(e){var i=JSON.parse(e);return t.fromObject(i)},t.fromObject=function(e){if("object"!=typeof e)throw"Can only build from object.";if(!e.startPoint)throw'Object member "startPoint" missing.';if(!e.endPoint)throw'Object member "endPoint" missing.';if(!e.startControlPoint)throw'Object member "startControlPoint" missing.';if(!e.endControlPoint)throw'Object member "endControlPoint" missing.';return new t(new r.Vertex(e.startPoint[0],e.startPoint[1]),new r.Vertex(e.endPoint[0],e.endPoint[1]),new r.Vertex(e.startControlPoint[0],e.startControlPoint[1]),new r.Vertex(e.endControlPoint[0],e.endControlPoint[1]))},t.fromArray=function(e){if(!Array.isArray(e))throw"Can only build from object.";if(4!=e.length)throw"Can only build from array with four elements.";return new t(e[0],e[1],e[2],e[3])},t.START_POINT=0,t.START_CONTROL_POINT=1,t.END_CONTROL_POINT=2,t.END_POINT=3,t}();e.CubicBezierCurve=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),r=i(5),n=i(0),o=function(){function t(t){this.className="BezierPath",this.START_POINT=0,this.START_CONTROL_POINT=1,this.END_CONTROL_POINT=2,this.END_POINT=3,t||(t=[]),this.totalArcLength=0,this.adjustCircular=!1,this.bezierCurves=[]}return t.prototype.addCurve=function(t){if(null==t||"undefined"==typeof t)throw"Cannot add null curve to bézier path.";this.bezierCurves.push(t),this.bezierCurves.length>1?(t.startPoint=this.bezierCurves[this.bezierCurves.length-2].endPoint,this.adjustSuccessorControlPoint(this.bezierCurves.length-2,!0,!0)):this.totalArcLength+=t.getLength()},t.prototype.locateCurveByStartPoint=function(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].startPoint.equals(t))return e;return-1},t.prototype.locateCurveByEndPoint=function(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].endPoint.equals(t))return e;return-1},t.prototype.locateCurveByStartControlPoint=function(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].startControlPoint.equals(t))return e;return-1},t.prototype.locateCurveByEndControlPoint=function(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].endControlPoint.equals(t))return e;return-1},t.prototype.getLength=function(){return this.totalArcLength},t.prototype.updateArcLengths=function(){this.totalArcLength=0;for(var t=0;t<this.bezierCurves.length;t++)this.bezierCurves[t].updateArcLengths(),this.totalArcLength+=this.bezierCurves[t].getLength()},t.prototype.getCurveCount=function(){return this.bezierCurves.length},t.prototype.getCurveAt=function(t){return this.bezierCurves[t]},t.prototype.translate=function(t){for(var e=0;e<this.bezierCurves.length;e++){var i=this.bezierCurves[e];i.getStartPoint().add(t),i.getStartControlPoint().add(t),i.getEndControlPoint().add(t)}var i=this.bezierCurves[this.bezierCurves.length-1];return i.getEndPoint().add(t),this.updateArcLengths(),this},t.prototype.scale=function(t,e){for(var i=0;i<this.bezierCurves.length;i++){var s=this.bezierCurves[i];s.getStartPoint().scale(e,t),s.getStartControlPoint().scale(e,t),s.getEndControlPoint().scale(e,t)}return this.bezierCurves.length>0&&!this.adjustCircular&&this.bezierCurves[this.bezierCurves.length-1].getEndPoint().scale(e,t),this.updateArcLengths(),this},t.prototype.rotate=function(t,e){for(var i=0;i<this.bezierCurves.length;i++){var s=this.bezierCurves[i];s.getStartPoint().rotate(t,e),s.getStartControlPoint().rotate(t,e),s.getEndControlPoint().rotate(t,e)}this.bezierCurves.length>0&&!this.adjustCircular&&this.bezierCurves[this.bezierCurves.length-1].getEndPoint().rotate(t,e)},t.prototype.getClosestT=function(t){for(var e=-1,i=0,s=0,r=0,n=0,o=0,a=0;a<this.bezierCurves.length;a++)r=this.bezierCurves[a].getClosestT(t),s=this.bezierCurves[a].getPointAt(r).distance(t),(e==-1||s<i)&&(e=a,i=s,n=o+r*this.bezierCurves[a].getLength()),o+=this.bezierCurves[a].getLength();return Math.max(0,Math.min(1,n/this.totalArcLength))},t.prototype.getPoint=function(t){if(t<0||t>this.totalArcLength)return console.log("[BezierPath.getPoint(u)] u is out of bounds: "+t+"."),null;for(var e=0,i=0;e<this.bezierCurves.length&&i+this.bezierCurves[e].getLength()<t;)i+=this.bezierCurves[e].getLength(),e++;if(e>=this.bezierCurves.length)return this.bezierCurves[this.bezierCurves.length-1].getEndPoint().clone();var s=this.bezierCurves[e],r=t-i;return s.getPoint(r)},t.prototype.getPointAt=function(t){return this.getPoint(t*this.totalArcLength)},t.prototype.getTangentAt=function(t){return this.getTangent(t*this.totalArcLength)},t.prototype.getTangent=function(t){if(t<0||t>this.totalArcLength)return console.warn("[BezierPath.getTangent(u)] u is out of bounds: "+t+"."),null;for(var e=0,i=0;e<this.bezierCurves.length&&i+this.bezierCurves[e].getLength()<t;)i+=this.bezierCurves[e].getLength(),e++;var s=this.bezierCurves[e],r=t-i;return s.getTangent(r)},t.prototype.getPerpendicularAt=function(t){return this.getPerpendicular(t*this.totalArcLength)},t.prototype.getPerpendicular=function(e){if(e<0||e>this.totalArcLength)return console.log("[BezierPath.getPerpendicular(u)] u is out of bounds: "+e+"."),null;var i=t._locateUIndex(this,e),s=this.bezierCurves[i.i],r=e-i.uPart;return s.getPerpendicular(r)},t._locateUIndex=function(t,e){for(var i=0,s=0,r=0;i<t.bezierCurves.length&&s+t.bezierCurves[i].getLength()<e;)s+=t.bezierCurves[i].getLength(),i+1<t.bezierCurves.length&&(r+=t.bezierCurves[i].getLength()),i++;return{i:i,uPart:s,uBefore:r}},t.prototype.getSubPathAt=function(e,i){e=Math.max(0,e),i=Math.min(1,i);var s=e*this.totalArcLength,r=i*this.totalArcLength,n=t._locateUIndex(this,s),o=t._locateUIndex(this,r),a=(s-n.uBefore)/this.bezierCurves[n.i].getLength();if(n.i==o.i){var h=(r-o.uBefore)/this.bezierCurves[o.i].getLength(),l=this.bezierCurves[n.i].getSubCurveAt(a,h);return t.fromArray([l])}var c=[];if(n.i>o.i){var l=this.bezierCurves[n.i].getSubCurveAt(a,0);c.push(l);for(var u=n.i-1;u>o.i;u--)c.push(this.bezierCurves[u].clone().reverse());var h=(r-o.uBefore)/this.bezierCurves[o.i].getLength();c.push(this.bezierCurves[o.i].getSubCurveAt(1,h))}else{var l=this.bezierCurves[n.i].getSubCurveAt(a,1);c.push(l);for(var u=n.i+1;u<o.i&&u<this.bezierCurves.length;u++)c.push(this.bezierCurves[u].clone());var h=(r-o.uBefore)/this.bezierCurves[o.i].getLength();c.push(this.bezierCurves[o.i].getSubCurveAt(0,h))}return t.fromArray(c)},t.prototype.moveCurvePoint=function(t,e,i){var s=this.getCurveAt(t);if(s.moveCurvePoint(e,i,!0,!0),e==this.START_POINT&&(t>0||this.adjustCircular)){var r=this.getCurveAt(t-1<0?this.bezierCurves.length+(t-1):t-1);r.moveCurvePoint(this.END_CONTROL_POINT,i,!0,!1)}else if(e==this.END_POINT&&(t+1<this.bezierCurves.length||this.adjustCircular)){var n=this.getCurveAt((t+1)%this.bezierCurves.length);n.moveCurvePoint(this.START_CONTROL_POINT,i,!0,!1)}else e==this.START_CONTROL_POINT&&t>0?this.adjustPredecessorControlPoint(t,!0,!1):e==this.END_CONTROL_POINT&&t+1<this.getCurveCount()&&this.adjustSuccessorControlPoint(t,!0,!1);this.updateArcLengths()},t.prototype.adjustPredecessorControlPoint=function(e,i,s){if(this.adjustCircular||!(e<=0)){var r=this.getCurveAt(e),n=this.getCurveAt(e-1<0?this.getCurveCount()+(e-1):e-1);t.adjustNeighbourControlPoint(r,n,r.getStartPoint(),r.getStartControlPoint(),n.getEndPoint(),n.getEndControlPoint(),i,s)}},t.prototype.adjustSuccessorControlPoint=function(e,i,s){if(this.adjustCircular||!(e+1>this.getCurveCount())){var r=this.getCurveAt(e),n=this.getCurveAt((e+1)%this.getCurveCount());t.adjustNeighbourControlPoint(r,n,r.getEndPoint(),r.getEndControlPoint(),n.getStartPoint(),n.getStartControlPoint(),i,s)}},t.adjustNeighbourControlPoint=function(t,e,i,s,r,o,a,h){var l=new n.Vertex(s.x-i.x,s.y-i.y),c=new n.Vertex(o.x-r.x,o.y-r.y),u=Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2)),f=Math.sqrt(Math.pow(c.x,2)+Math.pow(c.y,2));u<=.1||(a?o.set(r.x-l.x*(f/u),r.y-l.y*(f/u)):o.set(r.x-l.x,r.y-l.y),e.updateArcLengths())},t.prototype.getBounds=function(){for(var t,e=new n.Vertex(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new n.Vertex(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),r=0;r<this.bezierCurves.length;r++)t=this.bezierCurves[r].getBounds(),e.x=Math.min(e.x,t.min.x),e.y=Math.min(e.y,t.min.y),i.x=Math.max(i.x,t.max.x),i.y=Math.max(i.y,t.max.y);return new s.Bounds(e,i)},t.prototype.clone=function(){for(var e=new t(null),i=0;i<this.bezierCurves.length;i++)e.bezierCurves.push(this.bezierCurves[i].clone()),i>0&&(e.bezierCurves[i-1].endPoint=e.bezierCurves[i].startPoint);return e.updateArcLengths(),e.adjustCircular=this.adjustCircular,e},t.prototype.equals=function(t){if(!t)return!1;if(!t.bezierCurves)return!1;if("undefined"==typeof t.bezierCurves.length)return!1;if(t.bezierCurves.length!=this.bezierCurves.length)return!1;for(var e=0;e<this.bezierCurves.length;e++)if(!this.bezierCurves[e].equals(t.bezierCurves[e]))return!1;return!0},t.prototype.toSVGString=function(t){t=t||{};var e=[];e.push("<path"),t.className&&e.push(' class="'+t.className+'"'),e.push(' d="');for(var i=0;i<this.bezierCurves.length;i++)i>0&&e.push(" "),e.push(this.bezierCurves[i].toSVGPathData());return e.push('" />'),e.join("")},t.prototype.toJSON=function(t){var e=[];e.push("[");for(var i=0;i<this.bezierCurves.length;i++)i>0&&e.push(","),t?e.push("\n\t"):e.push(" "),e.push(this.bezierCurves[i].toJSON(t));return 0!=this.bezierCurves.length&&e.push(" "),e.push("]"),e.join("")},t.fromJSON=function(e){var i=JSON.parse(e);return t.fromArray(i)},t.fromArray=function(e){if(!Array.isArray(e))throw"[BezierPath.fromArray] Passed object must be an array.";var i=e;if(i.length<1)throw"[BezierPath.fromArray] Passed array must contain at least one bezier curve (has "+i.length+").";for(var s=new t(null),n=null,o=0;o<i.length;o++){var a=null;if(r.CubicBezierCurve.isInstance(i[o]))a=i[o].clone();else if(0 in i[o]&&1 in i[o]&&2 in i[o]&&3 in i[o]){if(!(i[o][0]&&i[o][1]&&i[o][2]&&i[o][3]))throw"Cannot convert path data to BezierPath instance. At least one element is undefined (index="+o+"): "+i[o];a=r.CubicBezierCurve.fromArray(i[o])}else a=r.CubicBezierCurve.fromObject(i[o]);n&&(a.startPoint=n.endPoint),s.bezierCurves.push(a),n=a}return s.updateArcLengths(),s},t.prototype.toReducedListRepresentation=function(t){"undefined"==typeof t&&(t=1);var e=[];e.push("[");for(var i=0;i<this.bezierCurves.length;i++){var s=this.bezierCurves[i];e.push(s.getStartPoint().x.toFixed(t)),e.push(","),e.push(s.getStartPoint().y.toFixed(t)),e.push(","),e.push(s.getStartControlPoint().x.toFixed(t)),e.push(","),e.push(s.getStartControlPoint().y.toFixed(t)),e.push(","),e.push(s.getEndControlPoint().x.toFixed(t)),e.push(","),e.push(s.getEndControlPoint().y.toFixed(t)),e.push(",")}if(0!=this.bezierCurves.length){var s=this.bezierCurves[this.bezierCurves.length-1];e.push(s.getEndPoint().x.toFixed(t)),e.push(","),e.push(s.getEndPoint().y.toFixed(t))}return e.push("]"),e.join("")},t.fromReducedListRepresentation=function(e){var i=JSON.parse(e);if(!i.length)throw console.log("Cannot parse bezier path from non-array object nor from empty point list."),"Cannot parse bezier path from non-array object nor from empty point list.";if(i.length<8)throw console.log("Cannot build bezier path. The passed array must contain at least 8 elements (numbers)."),"Cannot build bezier path. The passed array must contain at least 8 elements (numbers).";var s=new t(null),o=null,a=null,h=null,l=null,c=0;do{0==c&&(o=new n.Vertex(i[c],i[c+1])),a=new n.Vertex(i[c+2],i[c+3]),h=new n.Vertex(i[c+4],i[c+5]),l=new n.Vertex(i[c+6],i[c+7]);var u=new r.CubicBezierCurve(o,l,a,h);s.bezierCurves.push(u),o=l,c+=6}while(c+2<i.length);return s.updateArcLengths(),s},t.START_POINT=0,t.START_CONTROL_POINT=1,t.END_CONTROL_POINT=2,t.END_POINT=3,t}();e.BezierPath=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),r=i(0),n=function(){function t(t,e){this.className="Polygon","undefined"==typeof t&&(t=[]),this.vertices=t,this.isOpen=e}return t.prototype.containsVert=function(t){for(var e=!1,i=0,s=this.vertices.length-1;i<this.vertices.length;s=i++){var r=this.vertices[i].x,n=this.vertices[i].y,o=this.vertices[s].x,a=this.vertices[s].y,h=n>t.y!=a>t.y&&t.x<(o-r)*(t.y-n)/(a-n)+r;h&&(e=!e)}return e},t.prototype.scale=function(t,e){for(var i in this.vertices)"function"==typeof this.vertices[i].scale?this.vertices[i].scale(t,e):console.log("There seems to be a null vertex!",this.vertices[i]);return this},t.prototype.rotate=function(t,e){for(var i in this.vertices)this.vertices[i].rotate(t,e);return this},t.prototype.toQuadraticBezierData=function(){if(this.vertices.length<3)return[];var t=[],e=this.vertices[0],i=this.vertices[1],s=new r.Vertex(e.x+(i.x-e.x)/2,e.y+(i.y-e.y)/2);t.push(s);for(var n=this.isOpen?this.vertices.length:this.vertices.length+1,o=1;o<n;o++){e=this.vertices[o%this.vertices.length],i=this.vertices[(o+1)%this.vertices.length];var s=new r.Vertex(e.x+(i.x-e.x)/2,e.y+(i.y-e.y)/2);t.push(e),t.push(s),e=i}return t},t.prototype.toQuadraticBezierSVGString=function(){var t=this.toQuadraticBezierData();if(0==t.length)return"";for(var e=["M "+t[0].x+" "+t[0].y],i=1;i<t.length;i+=2)e.push("Q "+t[i].x+" "+t[i].y+", "+t[i+1].x+" "+t[i+1].y);return e.join(" ")},t.prototype.toCubicBezierData=function(t){if("undefined"==typeof t&&(t=1),this.vertices.length<3)return[];var e=[],i=this.vertices[0],s=this.vertices[1],n=new r.Vertex(i.x+(s.x-i.x)/2,i.y+(s.y-i.y)/2);e.push(n);for(var o=this.isOpen?this.vertices.length-1:this.vertices.length,a=0;a<o;a++){var i=this.vertices[a%this.vertices.length],s=this.vertices[(a+1)%this.vertices.length],h=this.vertices[(a+2)%this.vertices.length],l=new r.Vertex(i.x+(s.x-i.x)/2,i.y+(s.y-i.y)/2),c=new r.Vertex(s.x+(h.x-s.x)/2,s.y+(h.y-s.y)/2),u=new r.Vertex(l.x+(s.x-l.x)*t,l.y+(s.y-l.y)*t),f=new r.Vertex(c.x+(s.x-c.x)*t,c.y+(s.y-c.y)*t);e.push(u),e.push(f),e.push(c)}return e},t.prototype.toCubicBezierSVGString=function(t){var e=this.toCubicBezierData(t);if(0==e.length)return"";for(var i=["M "+e[0].x+" "+e[0].y],s=1;s<e.length;s+=3)i.push("C "+e[s].x+" "+e[s].y+", "+e[s+1].x+" "+e[s+1].y+", "+e[s+2].x+" "+e[s+2].y);return i.join(" ")},t.prototype.toCubicBezierPath=function(t){for(var e=this.toCubicBezierData(t),i=[],r=0;r+3<e.length;r+=3)i.push([e[r],e[r+3],e[r+1],e[r+2]]);return s.BezierPath.fromArray(i)},t.prototype.toSVGString=function(t){t=t||{};var e=[];if(e.push("<path"),t.className&&e.push(' class="'+t.className+'"'),e.push(' d="'),this.vertices.length>0){e.push("M "),e.push(this.vertices[0].x.toString()),e.push(" "),e.push(this.vertices[0].y.toString());for(var i=1;i<this.vertices.length;i++)e.push(" L "),e.push(this.vertices[i].x.toString()),e.push(" "),e.push(this.vertices[i].y.toString());this.isOpen||e.push(" Z")}return e.push('" />'),e.join("")},t}();e.Polygon=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),r=i(9),n=i(2),o=i(7),a=i(0),h=i(13),l=function(){function t(t,e,i){this.className="Triangle",this.a=t,this.b=e,this.c=i,this.calcCircumcircle()}return t.fromArray=function(e){if(e.length<3)throw"Cannot create triangle from array with less than three vertices ("+e.length+")";return new t(e[0],e[1],e[2])},t.prototype.getCentroid=function(){return new a.Vertex((this.a.x+this.b.x+this.c.x)/3,(this.a.y+this.b.y+this.c.y)/3)},t.prototype.scaleToCentroid=function(t){var e=this.getCentroid();return this.a.scale(t,e),this.b.scale(t,e),this.c.scale(t,e),this},t.prototype.getCircumcircle=function(){return this.center&&this.radius||this.calcCircumcircle(),new r.Circle(this.center.clone(),this.radius)},t.prototype.isAdjacent=function(t){var e=this.a.equals(t.a)||this.a.equals(t.b)||this.a.equals(t.c),i=this.b.equals(t.a)||this.b.equals(t.b)||this.b.equals(t.c),s=this.c.equals(t.a)||this.c.equals(t.b)||this.c.equals(t.c);return e&&i||e&&s||i&&s},t.prototype.getThirdVertex=function(t,e){return this.a.equals(t)&&this.b.equals(e)||this.a.equals(e)&&this.b.equals(t)?this.c:this.b.equals(t)&&this.c.equals(e)||this.b.equals(e)&&this.c.equals(t)?this.a:this.b},t.prototype.calcCircumcircle=function(){var e,i,s=this.b.x-this.a.x,r=this.b.y-this.a.y,n=this.c.x-this.a.x,o=this.c.y-this.a.y,h=s*(this.a.x+this.b.x)+r*(this.a.y+this.b.y),l=n*(this.a.x+this.c.x)+o*(this.a.y+this.c.y),c=2*(s*(this.c.y-this.b.y)-r*(this.c.x-this.b.x));if(Math.abs(c)<t.EPSILON){var u=this.bounds();this.center=new a.Vertex((u.min.x+u.max.x)/2,(u.min.y+u.max.y)/2),e=this.center.x-u.min.x,i=this.center.y-u.min.y}else{var f=(o*h-r*l)/c,d=(s*l-n*h)/c;this.center=new a.Vertex(f,d),e=this.center.x-this.a.x,i=this.center.y-this.a.y}this.radius_squared=e*e+i*i,this.radius=Math.sqrt(this.radius_squared)},t.prototype.inCircumcircle=function(t){var e=this.center.x-t.x,i=this.center.y-t.y,s=e*e+i*i;return s<=this.radius_squared},t.prototype.bounds=function(){return new s.Bounds(new a.Vertex(t.utils.min3(this.a.x,this.b.x,this.c.x),t.utils.min3(this.a.y,this.b.y,this.c.y)),new a.Vertex(t.utils.max3(this.a.x,this.b.x,this.c.x),t.utils.max3(this.a.y,this.b.y,this.c.y)))},t.prototype.toPolygon=function(){return new o.Polygon([this.a,this.b,this.c])},t.prototype.determinant=function(){return(this.b.y-this.a.y)*(this.c.x-this.b.x)-(this.c.y-this.b.y)*(this.b.x-this.a.x)},t.prototype.containsPoint=function(e){return t.utils.pointIsInTriangle(e.x,e.y,this.a.x,this.a.y,this.b.x,this.b.y,this.c.x,this.c.y)},t.prototype.getIncircularTriangle=function(){var e=new n.Line(this.a,this.b),i=new n.Line(this.b,this.c),s=new n.Line(this.c,this.a),r=h.geomutils.nsectAngle(this.b,this.a,this.c,2)[0],o=h.geomutils.nsectAngle(this.c,this.b,this.a,2)[0],a=r.intersection(o),l=e.getClosestPoint(a),c=i.getClosestPoint(a),u=s.getClosestPoint(a);
return new t(l,c,u)},t.prototype.getIncircle=function(){return this.getIncircularTriangle().getCircumcircle()},t.prototype.getIncenter=function(){return this.center&&this.radius||this.calcCircumcircle(),this.center.clone()},t.prototype.toString=function(){return"{ a : "+this.a.toString()+", b : "+this.b.toString()+", c : "+this.c.toString()+"}"},t.prototype.toSVGString=function(t){t=t||{};var e=[];e.push("<path"),t.className&&e.push(' class="'+t.className+'"'),e.push(' d="');var i=[this.a,this.b,this.c];if(i.length>0){e.push("M "),e.push(i[0].x),e.push(" "),e.push(i[0].y);for(var s=1;s<i.length;s++)e.push(" L "),e.push(i[s].x),e.push(" "),e.push(i[s].y);e.push(" Z")}return e.push('" />'),e.join("")},t.EPSILON=1e-6,t.utils={max3:function(t,e,i){return t>=e&&t>=i?t:e>=t&&e>=i?e:i},min3:function(t,e,i){return t<=e&&t<=i?t:e<=t&&e<=i?e:i},pointIsInTriangle:function(t,e,i,s,r,n,o,a){var h=.5*(-n*o+s*(-r+o)+i*(n-a)+r*a),l=1/(2*h)*(s*o-i*a+(a-s)*t+(i-o)*e),c=1/(2*h)*(i*n-s*r+(s-n)*t+(r-i)*e);return l>0&&c>0&&1-l-c>0}},t}();e.Triangle=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(3),r=i(0),n=function(){function t(t,e){this.className="Circle",this.center=t,this.radius=e}return t.prototype.lineDistance=function(t){var e=t.getClosestPoint(this.center);return e.distance(this.center)-this.radius},t.prototype.vertAt=function(e){return t.circleUtils.vertAt(e,this.radius).add(this.center)},t.prototype.tangentAt=function(e){var i=t.circleUtils.vertAt(e,this.radius);return new s.Vector(i,new r.Vertex(0,0)).add(this.center).perp()},t.prototype.toSVGString=function(t){t=t||{};var e=[];return e.push("<circle"),t.className&&e.push(' class="'+t.className+'"'),e.push(' cx="'+this.center.x+'"'),e.push(' cy="'+this.center.y+'"'),e.push(' r="'+this.radius+'"'),e.push(" />"),e.join("")},t.circleUtils={vertAt:function(t,e){return new r.Vertex(Math.sin(t)*e,Math.cos(t)*e)}},t}();e.Circle=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t){this.drag=[],this.dragStart=[],this.dragEnd=[],this.vertex=t}return t.prototype.addDragListener=function(e){return t._addListener(this.drag,e),this},t.prototype.removeDragListener=function(e){return this.drag=t._removeListener(this.drag,e),this},t.prototype.addDragStartListener=function(e){return t._addListener(this.dragStart,e),this},t.prototype.removeDragStartListener=function(e){return this.dragStart=t._removeListener(this.dragStart,e),this},t.prototype.addDragEndListener=function(e){return t._addListener(this.dragEnd,e),this},t.prototype.removeDragEndListener=function(e){return this.dragEnd=t._removeListener(this.dragEnd,e),this},t.prototype.fireDragEvent=function(e){t._fireEvent(this,this.drag,e)},t.prototype.fireDragStartEvent=function(e){t._fireEvent(this,this.dragStart,e)},t.prototype.fireDragEndEvent=function(e){t._fireEvent(this,this.dragEnd,e)},t._fireEvent=function(t,e,i){var s=i;"undefined"==typeof s.params?s.params={vertex:t.vertex}:s.params.vertex=t.vertex;for(var r in e)e[r](s)},t._addListener=function(t,e){for(var i in t)if(t[i]==e)return!1;return t.push(e),!0},t._removeListener=function(t,e){for(var i=0;i<t.length;i++)if(t[i]==e)return t.splice(i,1);return t},t}();e.VertexListeners=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){this.center=t,this.size=e}return t.utils={baseLog:function(t,e){return Math.log(t)/Math.log(e)},mapRasterScale:function(e,i){var s=1;return i>=1?(s=Math.abs(Math.floor(1/t.utils.baseLog(e,i))),s=1/Math.pow(e,s)):s=Math.abs(Math.floor(t.utils.baseLog(1/e,1/(i+1)))),s}},t}();e.Grid=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(0),r=function(){function t(t,e,i){this.a=t,this.b=e,this.factory=i}return t.prototype.length=function(){return Math.sqrt(Math.pow(this.b.x-this.a.x,2)+Math.pow(this.b.y-this.a.y,2))},t.prototype.setLength=function(t){return this.scale(t/this.length())},t.prototype.sub=function(t){return this.a.sub(t),this.b.sub(t),this},t.prototype.add=function(t){return this.a.add(t),this.b.add(t),this},t.prototype.normalize=function(){return this.b.set(this.a.x+(this.b.x-this.a.x)/this.length(),this.a.y+(this.b.y-this.a.y)/this.length()),this},t.prototype.scale=function(t){return this.b.set(this.a.x+(this.b.x-this.a.x)*t,this.a.y+(this.b.y-this.a.y)*t),this},t.prototype.moveTo=function(t){var e=this.a.difference(t);return this.a.add(e),this.b.add(e),this},t.prototype.angle=function(t){"undefined"==typeof t&&(t=this.factory(new s.Vertex(0,0),new s.Vertex(100,0)));var e=this.b.clone().sub(this.a),i=t.b.clone().sub(t.a);return Math.atan2(i.x,i.y)-Math.atan2(e.x,e.y)},t.prototype.vertAt=function(t){return new s.Vertex(this.a.x+(this.b.x-this.a.x)*t,this.a.y+(this.b.y-this.a.y)*t)},t.prototype.denominator=function(t){return(t.b.y-t.a.y)*(this.b.x-this.a.x)-(t.b.x-t.a.x)*(this.b.y-this.a.y)},t.prototype.colinear=function(t){return Math.abs(this.denominator(t))<s.Vertex.EPSILON},t.prototype.getClosestT=function(e){var i=t.vtutils.dist2(this.a,this.b);if(0===i)return 0;var s=((e.x-this.a.x)*(this.b.x-this.a.x)+(e.y-this.a.y)*(this.b.y-this.a.y))/i;return s},t.prototype.getClosestPoint=function(t){var e=this.getClosestT(t);return this.vertAt(e)},t.prototype.pointDistance=function(e){return Math.sqrt(t.vtutils.dist2(e,this.vertAt(this.getClosestT(e))))},t.prototype.clone=function(){return this.factory(this.a.clone(),this.b.clone())},t.prototype.toString=function(){return"{ a : "+this.a.toString()+", b : "+this.b.toString()+" }"},t.vtutils={dist2:function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)}},t}();e.VertTuple=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(2),r=i(8);e.geomutils={nsectAngle:function(t,e,i,n){var o=new r.Triangle(t,e,i),a=new s.Line(t,e),h=new s.Line(t,i),l=(a.angle(),h.angle(),a.angle(h)),c=o.determinant()>0;l<0&&(l=2*Math.PI+l),c||(l=(2*Math.PI-l)*-1);for(var u=Math.max(a.length(),h.length()),f=u/a.length(),d=[],p=1;p<n;p++)d.push(new s.Line(t,e.clone().rotate(-p*(l/n),t)).scale(f));return d}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){this.className="VEllipse",this.center=t,this.axis=e}return t.prototype.toSVGString=function(t){t=t||{};var e=[];return e.push("<ellipse"),t.className&&e.push(' class="'+t.className+'"'),e.push(' cx="'+this.center.x+'"'),e.push(' cy="'+this.center.y+'"'),e.push(' rx="'+this.axis.x+'"'),e.push(' ry="'+this.axis.y+'"'),e.push(" />"),e.join("")},t}();e.VEllipse=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e,i){this.className="PBImage",this.image=t,this.upperLeft=e,this.lowerRight=i}return t.prototype.toSVGString=function(t){return console.warn("PBImage is not yet SVG serializable. Returning empty SVG string."),""},t}();e.PBImage=s},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){this.mouseDownPos=void 0,this.mouseDragPos=void 0,this.mousePos=void 0,this.mouseButton=-1,this.listeners={},this.installed={},this.handlers={},this.name=e,this.element=t,this.mouseDownPos=null,this.mouseDragPos=null,this.mousePos=null,this.mouseButton=-1,this.listeners={},this.installed={},this.handlers={};var i=this;this.handlers.mousemove=function(t){i.listeners.mousemove&&i.listeners.mousemove(i.mkParams(t,"mousemove")),i.mouseDragPos&&i.listeners.drag&&i.listeners.drag(i.mkParams(t,"drag")),i.mouseDownPos&&(i.mouseDragPos=i.relPos(t))},this.handlers.mouseup=function(t){i.listeners.mouseup&&i.listeners.mouseup(i.mkParams(t,"mouseup")),i.mouseDragPos=void 0,i.mouseDownPos=void 0,i.mouseButton=-1},this.handlers.mousedown=function(t){i.mouseDragPos=i.relPos(t),i.mouseDownPos=i.relPos(t),i.mouseButton=t.button,i.listeners.mousedown&&i.listeners.mousedown(i.mkParams(t,"mousedown"))},this.handlers.click=function(t){i.listeners.click&&i.listeners.click(i.mkParams(t,"click"))},this.handlers.wheel=function(t){i.listeners.wheel&&i.listeners.wheel(i.mkParams(t,"wheel"))},this.element.addEventListener("mousemove",this.handlers.mousemove),this.element.addEventListener("mouseup",this.handlers.mouseup),this.element.addEventListener("mousedown",this.handlers.mousedown),this.element.addEventListener("click",this.handlers.click),this.element.addEventListener("wheel",this.handlers.wheel)}return t.prototype.relPos=function(t){return{x:t.offsetX,y:t.offsetY}},t.prototype.mkParams=function(t,e){var i=this.relPos(t),s=t;return s.params={element:this.element,name:e,pos:i,button:this.mouseButton,leftButton:0==this.mouseButton,middleButton:1==this.mouseButton,rightButton:2==this.mouseButton,mouseDownPos:this.mouseDownPos,draggedFrom:this.mouseDragPos,wasDragged:null!=this.mouseDownPos&&(this.mouseDownPos.x!=i.x||this.mouseDownPos.y!=i.y),dragAmount:null!=this.mouseDownPos?{x:i.x-this.mouseDragPos.x,y:i.y-this.mouseDragPos.y}:{x:0,y:0}},s},t.prototype.listenFor=function(t){this.installed[t]||(this.installed[t]=!0)},t.prototype.unlistenFor=function(t){this.installed[t]&&delete this.installed[t]},t.prototype.drag=function(t){return this.listeners.drag&&this.throwAlreadyInstalled("drag"),this.listeners.drag=t,this.listenFor("mousedown"),this.listenFor("mousemove"),this.listenFor("mouseup"),this},t.prototype.move=function(t){return this.listeners.mousemove&&this.throwAlreadyInstalled("mousemove"),this.listenFor("mousemove"),this.listeners.mousemove=t,this},t.prototype.up=function(t){return this.listeners.mouseup&&this.throwAlreadyInstalled("mouseup"),this.listenFor("mouseup"),this.listeners.mouseup=t,this},t.prototype.down=function(t){return this.listeners.mousedown&&this.throwAlreadyInstalled("mousedown"),this.listenFor("mousedown"),this.listeners.mousedown=t,this},t.prototype.click=function(t){return this.listeners.click&&this.throwAlreadyInstalled("click"),this.listenFor("click"),this.listeners.click=t,this},t.prototype.wheel=function(t){return this.listeners.wheel&&this.throwAlreadyInstalled("wheel"),this.listenFor("wheel"),this.listeners.wheel=t,this},t.prototype.throwAlreadyInstalled=function(t){throw"This MouseHandler already has a '"+t+"' callback. To keep the code simple there is only room for one."},t.prototype.destroy=function(){this.unlistenFor("mousedown"),this.unlistenFor("mousemove"),this.unlistenFor("moseup"),this.unlistenFor("click"),this.unlistenFor("wheel"),this.element.removeEventListener("mousemove",this.handlers.mousemove),this.element.removeEventListener("mouseup",this.handlers.mousedown),this.element.removeEventListener("mousedown",this.handlers.mousedown),this.element.removeEventListener("click",this.handlers.click),this.element.removeEventListener("wheel",this.handlers.wheel)},t}();e.MouseHandler=r;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(MouseEvent);e.XMouseEvent=n;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(WheelEvent);e.XWheelEvent=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t){this.downListeners=[],this.pressListeners=[],this.upListeners=[],this.keyStates={},t=t||{},this.element=t.element?t.element:window,this.downListeners=[],this.pressListeners=[],this.upListeners=[],this.keyStates=[],this.trackAllKeys=t.trackAll||!1,this.installListeners()}return t.prototype.fireEvent=function(t,e){var i=!1;for(var s in e){var r=e[s];r.keyCode==t.keyCode&&(r.listener(t),i=!0)}return i},t.prototype.fireDownEvent=function(t,e){(e.fireEvent(t,e.downListeners)||e.trackAllKeys)&&(e.keyStates[t.keyCode]="down")},t.prototype.firePressEvent=function(t,e){e.fireEvent(t,e.pressListeners)},t.prototype.fireUpEvent=function(t,e){(e.fireEvent(t,e.upListeners)||e.trackAllKeys)&&delete e.keyStates[t.keyCode]},t.key2code=function(e){if("number"==typeof e)return e;if("string"!=typeof e)throw"Unknown key name or key type (should be a string or integer): "+e;if(t.KEY_CODES[e])return t.KEY_CODES[e];throw"Unknown key (cannot resolve key code): "+e},t.prototype.installListeners=function(){var t=this;this.element.addEventListener("keydown",this._keyDownListener=function(e){t.fireDownEvent(e,t)}),this.element.addEventListener("keypress",this._keyPressListener=function(e){t.firePressEvent(e,t)}),this.element.addEventListener("keyup",this._keyUpListener=function(e){t.fireUpEvent(e,t)})},t.prototype.releaseListeners=function(){this.element.removeEventListener("keydown",this._keyDownListener),this.element.removeEventListener("keypress",this._keyPressListener),this.element.removeEventListener("keyup",this._keyUpListener)},t.prototype.down=function(e,i){return this.downListeners.push({key:e,keyCode:t.key2code(e),listener:i}),this},t.prototype.press=function(e,i){return this.pressListeners.push({key:e,keyCode:t.key2code(e),listener:i}),this},t.prototype.up=function(e,i){return this.upListeners.push({key:e,keyCode:t.key2code(e),listener:i}),this},t.prototype.isDown=function(e){return"number"==typeof e?!!this.keyStates[e]:!!this.keyStates[t.key2code(e)]},t.KEY_CODES={break:3,backspace:8,tab:9,clear:12,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,hangul:21,hanja:25,escape:27,conversion:28,"non-conversion":29,spacebar:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,select:41,print:42,execute:43,printscreen:44,insert:45,delete:46,help:47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,"semicolon (firefox)":59,equals:59,"<":60,"equals (firefox)":61,"ß":63,"@ (firefox)":64,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,windows:91,leftcommand:91,chromebooksearch:91,rightwindowkey:92,windowsmenu:93,rightcommant:93,sleep:95,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,numpadperiod:108,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126,f16:127,f17:128,f18:129,f19:130,f20:131,f21:132,f22:133,f23:134,f24:135,numlock:144,scrolllock:145,"^":160,"!":161,"#":163,$:164,"ù":165,pagebackward:166,pageforward:167,refresh:168,closingparen:169,"*":170,"~+*":171,minus:173,decreasevolumelevel:174,increasevolumelevel:175,next:176,previous:177,stop:178,"play/pause":179,email:180,mute:181,unmute:181,semicolon:186,"ñ":186,equal:187,comma:188,dash:189,period:190,forwardslash:191,"ç":191,"grave accent":192,"æ":192,"ö":192,"?":193,"/":193,"°":193,openbracket:219,backslash:220,closebracket:221,"å":221,singlequote:222,"ø":222,"ä":222,"`":223,altgr:225,"GNOME Compose Key":230,XF86Forward:233,XF86Back:234,alphanumeric:240,hiragana:242,katakana:242,"half-width":243,"full-width":243,kanji:244,unlocktrackpad:251,toggletouchpad:255},t}();e.KeyHandler=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(5),r=i(0),n=function(){function t(t,e){this.ctx=t,this.offset=new r.Vertex(0,0),this.scale=new r.Vertex(1,1),this.fillShapes=e}return t.prototype.beginDrawCycle=function(){},t.prototype.line=function(t,e,i,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.strokeStyle=i,this.ctx.lineWidth=s||1,this.ctx.stroke(),this.ctx.restore()},t.prototype.arrow=function(t,e,i){var s=8;this.ctx.save(),this.ctx.beginPath();var n=r.Vertex.utils.buildArrowHead(t,e,s,this.scale.x,this.scale.y);this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y);for(var o=0;o<n.length;o++)this.ctx.lineTo(this.offset.x+n[o].x,this.offset.y+n[o].y);this.ctx.lineTo(this.offset.x+n[0].x,this.offset.y+n[0].y),this.ctx.lineWidth=1,this._fillOrDraw(i),this.ctx.restore()},t.prototype.image=function(t,e,i){this.ctx.save(),this.ctx.drawImage(t,0,0,t.naturalWidth-1,t.naturalHeight-1,this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,i.x*this.scale.x,i.y*this.scale.y),this.ctx.restore()},t.prototype.rect=function(t,e,i,s,r){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+e)*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+e)*this.scale.x,this.offset.y+(t.y+i)*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+(t.y+i)*this.scale.y),this.ctx.closePath(),this.ctx.lineWidth=r||1,this._fillOrDraw(s),this.ctx.restore()},t.prototype._fillOrDraw=function(t){this.fillShapes?(this.ctx.fillStyle=t,this.ctx.fill()):(this.ctx.strokeStyle=t,this.ctx.stroke())},t.prototype.cubicBezier=function(t,e,i,r,n,o){return t instanceof s.CubicBezierCurve?void this.cubicBezier(t.startPoint,t.endPoint,t.startControlPoint,t.endControlPoint,n,o):(this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.bezierCurveTo(this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y,this.offset.x+r.x*this.scale.x,this.offset.y+r.y*this.scale.y,this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.lineWidth=o||2,this._fillOrDraw(n),void this.ctx.restore())},t.prototype.quadraticBezier=function(t,e,i,s,r){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.quadraticCurveTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y),this.ctx.lineWidth=r||2,this._fillOrDraw(s),this.ctx.restore()},t.prototype.cubicBezierPath=function(t,e){if(t&&0!=t.length){this.ctx.save(),this.ctx.beginPath();var i,s,r;this.ctx.moveTo(this.offset.x+t[0].x*this.scale.x,this.offset.y+t[0].y*this.scale.y);for(var n=1;n<t.length;n+=3)s=t[n],r=t[n+1],i=t[n+2],this.ctx.bezierCurveTo(this.offset.x+s.x*this.scale.x,this.offset.y+s.y*this.scale.y,this.offset.x+r.x*this.scale.x,this.offset.y+r.y*this.scale.y,this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y);this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(e),this.ctx.restore()}},t.prototype.handle=function(t,e){this.point(t,"rgb(0,32,192)"),this.square(e,5,"rgba(0,128,192,0.5)")},t.prototype.handleLine=function(t,e){this.line(t,e,"rgb(192,192,192)")},t.prototype.dot=function(t,e){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(Math.round(this.offset.x+this.scale.x*t.x),Math.round(this.offset.y+this.scale.y*t.y)),this.ctx.lineTo(Math.round(this.offset.x+this.scale.x*t.x+1),Math.round(this.offset.y+this.scale.y*t.y+1)),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(e),this.ctx.restore()},t.prototype.point=function(t,e){var i=3;this.ctx.beginPath(),this.ctx.arc(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,i,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(e)},t.prototype.circle=function(t,e,i,s){this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e*this.scale.x,e*this.scale.y,0,0,2*Math.PI),this.ctx.closePath(),this.ctx.lineWidth=s||1,this._fillOrDraw(i)},t.prototype.ellipse=function(t,e,i,s,r){this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e*this.scale.x,i*this.scale.y,0,0,2*Math.PI),this.ctx.closePath(),this.ctx.lineWidth=r||1,this._fillOrDraw(s)},t.prototype.square=function(t,e,i,s){this.ctx.beginPath(),this.ctx.rect(this.offset.x+(t.x-e/2)*this.scale.x,this.offset.y+(t.y-e/2)*this.scale.y,e*this.scale.x,e*this.scale.y),this.ctx.closePath(),this.ctx.lineWidth=s||1,this._fillOrDraw(i)},t.prototype.grid=function(t,e,i,s,r,n){this.ctx.beginPath();for(var o=-Math.ceil(.5*i/r)*r,a=i/2,h=-Math.ceil(.5*e/s)*s;h<e/2;h+=s)this.ctx.moveTo(this.offset.x+(t.x+h)*this.scale.x,this.offset.y+(t.y+o)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+h)*this.scale.x,this.offset.y+(t.y+a)*this.scale.y);for(var l=-Math.ceil(.5*e/s)*s,c=e/2,u=-Math.ceil(.5*i/r)*r;u<i/2;u+=r)this.ctx.moveTo(this.offset.x+(t.x+l)*this.scale.x-4,this.offset.y+(t.y+u)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+c)*this.scale.x+4,this.offset.y+(t.y+u)*this.scale.y);this.ctx.strokeStyle=n,this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.closePath()},t.prototype.raster=function(t,e,i,s,r,n){this.ctx.save(),this.ctx.beginPath();for(var o=0,a=0,h=-Math.ceil(.5*e/s)*s;h<e/2;h+=s){o++;for(var l=-Math.ceil(.5*i/r)*r;l<i/2;l+=r)1==o&&a++,this.ctx.moveTo(this.offset.x+(t.x+h)*this.scale.x-4,this.offset.y+(t.y+l)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+h)*this.scale.x+4,this.offset.y+(t.y+l)*this.scale.y),this.ctx.moveTo(this.offset.x+(t.x+h)*this.scale.x,this.offset.y+(t.y+l)*this.scale.y-4),this.ctx.lineTo(this.offset.x+(t.x+h)*this.scale.x,this.offset.y+(t.y+l)*this.scale.y+4)}this.ctx.strokeStyle=n,this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()},t.prototype.diamondHandle=function(t,e,i){this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e/2,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y-e/2),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e/2,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y+e/2),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(i)},t.prototype.squareHandle=function(t,e,i){this.ctx.beginPath(),this.ctx.rect(this.offset.x+t.x*this.scale.x-e/2,this.offset.y+t.y*this.scale.y-e/2,e,e),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(i)},t.prototype.circleHandle=function(t,e,i){e=e||3,this.ctx.beginPath(),this.ctx.arc(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(i)},t.prototype.crosshair=function(t,e,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e,this.offset.y+t.y*this.scale.y),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y-e),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y+e),this.ctx.strokeStyle=i,this.ctx.lineWidth=.5,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()},t.prototype.polygon=function(t,e,i){this.polyline(t.vertices,t.isOpen,e,i)},t.prototype.polyline=function(t,e,i,s){if(!(t.length<=1)){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=s||1,this.ctx.moveTo(this.offset.x+t[0].x*this.scale.x,this.offset.y+t[0].y*this.scale.y);for(var r=0;r<t.length;r++)this.ctx.lineTo(this.offset.x+t[r].x*this.scale.x,this.offset.y+t[r].y*this.scale.y);!e&&t.length>2&&this.ctx.closePath(),this._fillOrDraw(i),this.ctx.setLineDash([]),this.ctx.restore()}},t.prototype.label=function(t,e,i,s,r){this.ctx.save(),this.ctx.translate(e,i),"undefined"!=typeof s&&this.ctx.rotate(s),this.ctx.fillStyle=r||"black",this.fillShapes?this.ctx.fillText(t,0,0):this.ctx.strokeText(t,0,0),this.ctx.restore()},t.prototype.clear=function(t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},t}();e.drawutils=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(0),r=function(){function t(e,i){this.gl=e,this.offset=new s.Vertex(0,0),this.scale=new s.Vertex(1,1),this.fillShapes=i,this._zindex=0,null!=e&&"undefined"!=typeof e&&(this.glutils=new n(e),this._vertShader=this.glutils.compileShader(t.vertCode,this.gl.VERTEX_SHADER),this._fragShader=this.glutils.compileShader(t.fragCode,this.gl.FRAGMENT_SHADER),this._program=this.glutils.makeProgram(this._vertShader,this._fragShader),this.vertex_buffer=this.gl.createBuffer(),console.log("gl initialized"))}return t.prototype.beginDrawCycle=function(){this._zindex=0},t.prototype.copyInstance=function(e){var i=new t(null,e);return i.gl=this.gl,i.glutils=this.glutils,i._vertShader=this._vertShader,i._fragShader=this._fragShader,i._program=this._program,i},t.prototype._x2rel=function(t){return(this.scale.x*t+this.offset.x)/this.gl.canvas.width*2-1},t.prototype._y2rel=function(t){return(this.offset.y-this.scale.y*t)/this.gl.canvas.height*2-1},t.prototype.line=function(t,e,i){var s=new Float32Array(6);s[0]=this._x2rel(t.x),s[1]=this._y2rel(t.y),s[2]=this._zindex,s[3]=this._x2rel(e.x),s[4]=this._y2rel(e.y),s[5]=this._zindex,this._zindex+=.001,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW);var r=this.gl.getAttribLocation(this._program,"position");this.gl.vertexAttribPointer(r,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(r),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var n=this.gl.getUniformLocation(this._program,"uRotationVector"),o=[0,1];this.gl.uniform2fv(n,o),this.gl.lineWidth(5),this.gl.drawArrays(this.gl.LINES,0,s.length/3)},t.prototype.arrow=function(t,e,i){},t.prototype.image=function(t,e,i){},t.prototype._fillOrDraw=function(t){},t.prototype.cubicBezier=function(t,e,i,s,r){},t.prototype.cubicBezierPath=function(t,e){},t.prototype.handle=function(t,e){},t.prototype.cubicBezierCurveHandleLines=function(t){},t.prototype.handleLine=function(t,e){},t.prototype.dot=function(t,e){},t.prototype.point=function(t,e){},t.prototype.circle=function(t,e,i){},t.prototype.ellipse=function(t,e,i,s){},t.prototype.square=function(t,e,i){},t.prototype.grid=function(t,e,i,s,r,n){},t.prototype.raster=function(t,e,i,s,r,n){},t.prototype.diamondHandle=function(t,e,i){},t.prototype.squareHandle=function(t,e,i){},t.prototype.circleHandle=function(t,e,i){},t.prototype.crosshair=function(t,e,i){},t.prototype.polygon=function(t,e,i){for(var s=new Float32Array(3*t.vertices.length),r=0;r<t.vertices.length;r++)s[3*r+0]=this._x2rel(t.vertices[r].x),s[3*r+1]=this._y2rel(t.vertices[r].y),s[3*r+2]=this._zindex;this._zindex+=.001,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW);var n=this.gl.getAttribLocation(this._program,"position");this.gl.vertexAttribPointer(n,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(n),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var o=this.gl.getUniformLocation(this._program,"uRotationVector"),a=[0,1];this.gl.uniform2fv(o,a),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,s.length/3)},t.prototype.polyline=function(t,e,i){},t.prototype.label=function(t,e,i,s){},t.prototype.clear=function(t){this.gl.clearColor(1,1,1,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},t.vertCode="\n    precision mediump float;\n\n    attribute vec3 position;\n\n    uniform vec2 uRotationVector;\n\n    void main(void) {\n\tvec2 rotatedPosition = vec2(\n\t    position.x * uRotationVector.y +\n\t\tposition.y * uRotationVector.x,\n\t    position.y * uRotationVector.y -\n\t\tposition.x * uRotationVector.x\n\t);\n\n\tgl_Position = vec4(rotatedPosition, position.z, 1.0);\n    }",t.fragCode="\n    precision highp float;\n\n    void main(void) {\n\tgl_FragColor = vec4(0.0,0.75,1.0,1.0);\n    }",t}();e.drawutilsgl=r;var n=function(){function t(t){this.gl=t}return t.prototype.bufferData=function(t){var e=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),e},t.prototype.compileShader=function(t,e){var i=this.gl.createShader(e);this.gl.shaderSource(i,t),this.gl.compileShader(i);var s=this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS);return s?i:(console.warn("Error in shader:"+this.gl.getShaderInfoLog(i)),this.gl.deleteShader(i),null)},t.prototype.makeProgram=function(t,e){var i=this.gl.createProgram();return this.gl.attachShader(i,t),this.gl.attachShader(i,e),this.gl.linkProgram(i),this.gl.useProgram(i),this.gl.detachShader(i,t),this.gl.detachShader(i,e),this.gl.deleteShader(t),this.gl.deleteShader(e),i},t}()},function(t,e,i){"use strict";window.VertexAttr=i(4).VertexAttr,window.VertexListeners=i(10).VertexListeners,window.Vertex=i(0).Vertex,window.Bounds=i(1).Bounds,window.Grid=i(11).Grid,window.Line=i(2).Line,window.Vector=i(3).Vector,window.CubicBezierCurve=i(5).CubicBezierCurve,window.BezierPath=i(6).BezierPath,window.Polygon=i(7).Polygon,window.Triangle=i(8).Triangle,window.VEllipse=i(14).VEllipse,window.Circle=i(9).Circle,window.PBImage=i(15).PBImage,window.MouseHandler=i(16).MouseHandler,window.KeyHandler=i(17).KeyHandler,window.drawutils=i(18).drawutils,window.drawutilsgl=i(19).drawutilsgl,window.geomutils=i(13).geomutils,window.PlotBoilerplate=i(21).PlotBoilerplate},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(18),r=i(19),n=i(6),o=i(1),a=i(9),h=i(11),l=i(17),c=i(2),u=i(16),f=i(15),d=i(7),p=i(22),y=i(8),g=i(14),v=i(3),x=i(0),m=i(4),w=function(){function t(e){if(m.VertexAttr.model={bezierAutoAdjust:!1,renderTime:0,selectable:!0,isSelected:!1,draggable:!0},"undefined"==typeof e.canvas)throw"No canvas specified.";this.config={canvas:e.canvas,fullSize:t.utils.fetch.val(e,"fullSize",!0),fitToParent:t.utils.fetch.bool(e,"fitToParent",!0),scaleX:t.utils.fetch.num(e,"scaleX",1),scaleY:t.utils.fetch.num(e,"scaleY",1),offsetX:t.utils.fetch.num(e,"offsetX",0),offsetY:t.utils.fetch.num(e,"offsetY",0),rasterGrid:t.utils.fetch.bool(e,"rasterGrid",!0),rasterScaleX:t.utils.fetch.num(e,"rasterScaleX",1),rasterScaleY:t.utils.fetch.num(e,"rasterScaleY",1),rasterAdjustFactor:t.utils.fetch.num(e,"rasterAdjustdFactror",2),drawOrigin:t.utils.fetch.bool(e,"drawOrigin",!1),autoAdjustOffset:t.utils.fetch.val(e,"autoAdjustOffset",!0),offsetAdjustXPercent:t.utils.fetch.num(e,"offsetAdjustXPercent",50),offsetAdjustYPercent:t.utils.fetch.num(e,"offsetAdjustYPercent",50),backgroundColor:e.backgroundColor||"#ffffff",redrawOnResize:t.utils.fetch.bool(e,"redrawOnResize",!0),defaultCanvasWidth:t.utils.fetch.num(e,"defaultCanvasWidth",t.DEFAULT_CANVAS_WIDTH),defaultCanvasHeight:t.utils.fetch.num(e,"defaultCanvasHeight",t.DEFAULT_CANVAS_HEIGHT),canvasWidthFactor:t.utils.fetch.num(e,"canvasWidthFactor",1),canvasHeightFactor:t.utils.fetch.num(e,"canvasHeightFactor",1),cssScaleX:t.utils.fetch.num(e,"cssScaleX",1),cssScaleY:t.utils.fetch.num(e,"cssScaleY",1),cssUniformScale:t.utils.fetch.bool(e,"cssUniformScale",!0),saveFile:function(){i.hooks.saveFile(i)},setToRetina:function(){i._setToRetina()},autoDetectRetina:t.utils.fetch.bool(e,"autoDetectRetina",!0),enableSVGExport:t.utils.fetch.bool(e,"enableSVGExport",!0),preClear:t.utils.fetch.func(e,"preClear",null),preDraw:t.utils.fetch.func(e,"preDraw",null),postDraw:t.utils.fetch.func(e,"postDraw",null),enableMouse:t.utils.fetch.bool(e,"enableMouse",!0),enableTouch:t.utils.fetch.bool(e,"enableTouch",!0),enableKeys:t.utils.fetch.bool(e,"enableKeys",!0),enableMouseWheel:t.utils.fetch.bool(e,"enableMouseWheel",!0),enableGL:t.utils.fetch.bool(e,"enableGL",!1)},this.drawConfig={drawVertices:!0,drawBezierHandleLines:t.utils.fetch.bool(e,"drawBezierHandleLines",!0),drawBezierHandlePoints:t.utils.fetch.bool(e,"drawBezierHandlePoints",!0),drawHandleLines:t.utils.fetch.bool(e,"drawHandleLines",!0),drawHandlePoints:t.utils.fetch.bool(e,"drawHandlePoints",!0),drawGrid:t.utils.fetch.bool(e,"drawGrid",!0),bezier:{color:"#00a822",lineWidth:2,handleLine:{
color:"rgba(180,180,180,0.5)",lineWidth:1}},polygon:{color:"#0022a8",lineWidth:1},triangle:{color:"#6600ff",lineWidth:1},ellipse:{color:"#2222a8",lineWidth:1},circle:{color:"#22a8a8",lineWidth:2},vertex:{color:"#a8a8a8",lineWidth:1},selectedVertex:{color:"#c08000",lineWidth:2},line:{color:"#a844a8",lineWidth:1},vector:{color:"#ff44a8",lineWidth:1},image:{color:"#a8a8a8",lineWidth:1}},this.canvas="string"==typeof e.canvas?document.querySelector(e.canvas):e.canvas,this.config.enableGL?(this.ctx=this.canvas.getContext("webgl"),this.draw=new r.drawutilsgl(this.ctx,!1),this.fill=this.draw.copyInstance(!0),console.warn("Initialized with experimental mode enableGL=true. Note that this is not yet fully implemented.")):(this.ctx=this.canvas.getContext("2d"),this.draw=new s.drawutils(this.ctx,!1),this.fill=new s.drawutils(this.ctx,!0)),this.draw.scale.set(this.config.scaleX,this.config.scaleY),this.fill.scale.set(this.config.scaleX,this.config.scaleY),this.grid=new h.Grid(new x.Vertex(0,0),new x.Vertex(50,50)),this.canvasSize={width:t.DEFAULT_CANVAS_WIDTH,height:t.DEFAULT_CANVAS_HEIGHT},this.vertices=[],this.selectPolygon=null,this.draggedElements=[],this.drawables=[],this.console=console,this.hooks={saveFile:t._saveFile};var i=this;window&&window.addEventListener("resize",function(){return i.resizeCanvas()}),this.resizeCanvas(),e.autoDetectRetina&&this._setToRetina(),this.installInputListeners(),this.updateCSSscale(),this.redraw(),this.canvas.focus()}t._saveFile=function(t){var e=(new p.SVGBuilder).build(t.drawables,{canvasSize:t.canvasSize,offset:t.draw.offset,zoom:t.draw.scale}),i=new Blob([e],{type:"image/svg;charset=utf-8"});if("function"!=typeof window.saveAs)throw"Cannot save file; did you load the ./utils/savefile helper function an the eligrey/SaveFile library?";var s=window.saveAs;s(i,"plotboilerplate.svg")},t.prototype._setToRetina=function(){this.config.autoDetectRetina=!0;var t=window.devicePixelRatio||1;this.config.cssScaleX=this.config.cssScaleY=1/t,this.config.canvasWidthFactor=this.config.canvasHeightFactor=t,this.resizeCanvas(),this.updateCSSscale()},t.prototype.fitToView=function(t){var e=new x.Vertex(this.canvasSize.width/2,this.canvasSize.height/2),i=this.canvasSize.width/this.canvasSize.height,s=t.width/t.height,r=new x.Vertex(t.max.x-t.width/2,t.max.y-t.height/2).inv().addXY(this.canvasSize.width/2,this.canvasSize.height/2);if(this.setOffset(r),i<s){var n=this.canvasSize.width/t.width;this.setZoom(n,n,e)}else{var n=this.canvasSize.height/t.height;this.setZoom(n,n,e)}this.redraw()},t.prototype.setConsole=function(t){this.console=t},t.prototype.updateCSSscale=function(){this.config.cssUniformScale?t.utils.setCSSscale(this.canvas,this.config.cssScaleX,this.config.cssScaleX):t.utils.setCSSscale(this.canvas,this.config.cssScaleX,this.config.cssScaleY)},t.prototype.add=function(e,i){if(Array.isArray(e))for(var s=e,r=0;r<s.length;r++)this.add(s[r]);else if(e instanceof x.Vertex)this.drawables.push(e),this.vertices.push(e);else if(e instanceof c.Line)this.drawables.push(e),this.vertices.push(e.a),this.vertices.push(e.b);else if(e instanceof v.Vector)this.drawables.push(e),this.vertices.push(e.a),this.vertices.push(e.b);else if(e instanceof g.VEllipse)this.vertices.push(e.center),this.vertices.push(e.axis),this.drawables.push(e),e.center.listeners.addDragListener(function(t){e.axis.add(t.params.dragAmount)});else if(e instanceof a.Circle)this.vertices.push(e.center),this.drawables.push(e);else if(e instanceof d.Polygon){this.drawables.push(e);for(var r=0;r<e.vertices.length;r++)this.vertices.push(e.vertices[r])}else if(e instanceof y.Triangle)this.drawables.push(e),this.vertices.push(e.a),this.vertices.push(e.b),this.vertices.push(e.c);else if(e instanceof n.BezierPath){this.drawables.push(e);for(var o=e,r=0;r<o.bezierCurves.length;r++)e.adjustCircular||0!=r||this.vertices.push(o.bezierCurves[r].startPoint),this.vertices.push(o.bezierCurves[r].endPoint),this.vertices.push(o.bezierCurves[r].startControlPoint),this.vertices.push(o.bezierCurves[r].endControlPoint),o.bezierCurves[r].startControlPoint.attr.selectable=!1,o.bezierCurves[r].endControlPoint.attr.selectable=!1;t.utils.enableBezierPathAutoAdjust(e)}else{if(!(e instanceof f.PBImage))throw"Cannot add drawable of unrecognized type: "+typeof e+".";this.vertices.push(e.upperLeft),this.vertices.push(e.lowerRight),this.drawables.push(e),e.upperLeft.listeners.addDragListener(function(t){e.lowerRight.add(t.params.dragAmount)}),e.lowerRight.attr.selectable=!1}(i||"undefined"==typeof i)&&this.redraw()},t.prototype.remove=function(e,i,s){e instanceof x.Vertex&&this.removeVertex(e,!1);for(var r=0;r<this.drawables.length;r++)if(this.drawables[r]===e){if(this.drawables.splice(r,1),s)if(e instanceof c.Line)this.removeVertex(e.a,!1),this.removeVertex(e.b,!1);else if(e instanceof v.Vector)this.removeVertex(e.a,!1),this.removeVertex(e.b,!1);else if(e instanceof g.VEllipse)this.removeVertex(e.center,!1),this.removeVertex(e.axis,!1);else if(e instanceof a.Circle)this.removeVertex(e.center,!1);else if(e instanceof d.Polygon)for(var r=0;r<e.vertices.length;r++)this.removeVertex(e.vertices[r],!1);else if(e instanceof y.Triangle)this.removeVertex(e.a,!1),this.removeVertex(e.b,!1),this.removeVertex(e.c,!1);else if(e instanceof n.BezierPath){t.utils.disableBezierPathAutoAdjust(e);for(var r=0;r<e.bezierCurves.length;r++)this.removeVertex(e.bezierCurves[r].startPoint,!1),this.removeVertex(e.bezierCurves[r].startControlPoint,!1),this.removeVertex(e.bezierCurves[r].endControlPoint,!1),r+1==e.bezierCurves.length&&this.removeVertex(e.bezierCurves[r].endPoint,!1)}else e instanceof f.PBImage&&(this.removeVertex(e.upperLeft,!1),this.removeVertex(e.lowerRight,!1));return void(i&&this.redraw())}},t.prototype.removeVertex=function(t,e){for(var i=0;i<this.vertices.length;i++)if(this.vertices[i]===t)return this.vertices.splice(i,1),void(e&&this.redraw())},t.prototype.getVertexNear=function(t,e){var i=this.locatePointNear(this.transformMousePosition(t.x,t.y),e/Math.min(this.config.cssScaleX,this.config.cssScaleY));if(i&&"vertex"==i.typeName)return this.vertices[i.vindex]},t.prototype.drawGrid=function(){var t={x:h.Grid.utils.mapRasterScale(this.config.rasterAdjustFactor,this.draw.scale.x)*this.config.rasterScaleX/this.config.cssScaleX,y:h.Grid.utils.mapRasterScale(this.config.rasterAdjustFactor,this.draw.scale.y)*this.config.rasterScaleY/this.config.cssScaleY},e={width:this.grid.size.x*t.x,height:this.grid.size.y*t.y},i={width:this.canvasSize.width/2,height:this.canvasSize.height/2},s=this.draw.offset.clone().inv();s.x=Math.round(s.x+i.width)/Math.round(e.width)*e.width/this.draw.scale.x+(this.draw.offset.x-i.width)/this.draw.scale.x%e.width,s.y=Math.round(s.y+i.height)/Math.round(e.height)*e.height/this.draw.scale.y+(this.draw.offset.y-i.height)/this.draw.scale.x%e.height,this.drawConfig.drawGrid&&(this.config.rasterGrid?this.draw.raster(s,this.canvasSize.width/this.draw.scale.x,this.canvasSize.height/this.draw.scale.y,e.width,e.height,"rgba(0,128,255,0.125)"):this.draw.grid(s,this.canvasSize.width/this.draw.scale.x,this.canvasSize.height/this.draw.scale.y,e.width,e.height,"rgba(0,128,255,0.095)"))},t.prototype.drawOrigin=function(){this.draw.crosshair({x:0,y:0},10,"#000000")},t.prototype._handleColor=function(t,e){return t.attr.isSelected?this.drawConfig.selectedVertex.color:t.attr.draggable?e:"rgba(128,128,128,0.5)"},t.prototype.drawDrawables=function(t){for(var e in this.drawables){var i=this.drawables[e];if(i instanceof n.BezierPath)for(var s in i.bezierCurves)this.draw.cubicBezier(i.bezierCurves[s].startPoint,i.bezierCurves[s].endPoint,i.bezierCurves[s].startControlPoint,i.bezierCurves[s].endControlPoint,this.drawConfig.bezier.color,this.drawConfig.bezier.lineWidth),this.drawConfig.drawBezierHandlePoints&&this.drawConfig.drawHandlePoints?(i.bezierCurves[s].startPoint.attr.bezierAutoAdjust||(this.draw.diamondHandle(i.bezierCurves[s].startPoint,7,this._handleColor(i.bezierCurves[s].startPoint,this.drawConfig.vertex.color)),i.bezierCurves[s].startPoint.attr.renderTime=t),i.bezierCurves[s].endPoint.attr.bezierAutoAdjust||(this.draw.diamondHandle(i.bezierCurves[s].endPoint,7,this._handleColor(i.bezierCurves[s].endPoint,this.drawConfig.vertex.color)),i.bezierCurves[s].endPoint.attr.renderTime=t),this.draw.circleHandle(i.bezierCurves[s].startControlPoint,3,this._handleColor(i.bezierCurves[s].startControlPoint,"#008888")),this.draw.circleHandle(i.bezierCurves[s].endControlPoint,3,this._handleColor(i.bezierCurves[s].endControlPoint,"#008888")),i.bezierCurves[s].startControlPoint.attr.renderTime=t,i.bezierCurves[s].endControlPoint.attr.renderTime=t):(i.bezierCurves[s].startPoint.attr.renderTime=t,i.bezierCurves[s].endPoint.attr.renderTime=t,i.bezierCurves[s].startControlPoint.attr.renderTime=t,i.bezierCurves[s].endControlPoint.attr.renderTime=t),this.drawConfig.drawBezierHandleLines&&this.drawConfig.drawHandleLines&&(this.draw.line(i.bezierCurves[s].startPoint,i.bezierCurves[s].startControlPoint,this.drawConfig.bezier.handleLine.color,this.drawConfig.bezier.handleLine.lineWidth),this.draw.line(i.bezierCurves[s].endPoint,i.bezierCurves[s].endControlPoint,this.drawConfig.bezier.handleLine.color,this.drawConfig.bezier.handleLine.lineWidth));else if(i instanceof d.Polygon){if(this.draw.polygon(i,this.drawConfig.polygon.color,this.drawConfig.polygon.lineWidth),!this.drawConfig.drawHandlePoints)for(var e in i.vertices)i.vertices[e].attr.renderTime=t}else i instanceof y.Triangle?(this.draw.polyline([i.a,i.b,i.c],!1,this.drawConfig.triangle.color,this.drawConfig.triangle.lineWidth),this.drawConfig.drawHandlePoints||(i.a.attr.renderTime=i.b.attr.renderTime=i.c.attr.renderTime=t)):i instanceof g.VEllipse?(this.drawConfig.drawHandleLines&&(this.draw.line(i.center.clone().add(0,i.axis.y-i.center.y),i.axis,"#c8c8c8"),this.draw.line(i.center.clone().add(i.axis.x-i.center.x,0),i.axis,"#c8c8c8")),this.draw.ellipse(i.center,Math.abs(i.axis.x-i.center.x),Math.abs(i.axis.y-i.center.y),this.drawConfig.ellipse.color,this.drawConfig.ellipse.lineWidth),this.drawConfig.drawHandlePoints||(i.center.attr.renderTime=t,i.axis.attr.renderTime=t)):i instanceof a.Circle?this.draw.circle(i.center,i.radius,this.drawConfig.circle.color,this.drawConfig.circle.lineWidth):i instanceof x.Vertex?!this.drawConfig.drawVertices||i.attr.selectable&&i.attr.draggable||(this.draw.circleHandle(i,7,this.drawConfig.vertex.color),i.attr.renderTime=t):i instanceof c.Line?(this.draw.line(i.a,i.b,this.drawConfig.line.color,this.drawConfig.line.lineWidth),this.drawConfig.drawHandlePoints&&i.a.attr.selectable||(i.a.attr.renderTime=t),this.drawConfig.drawHandlePoints&&i.b.attr.selectable||(i.b.attr.renderTime=t)):i instanceof v.Vector?(this.draw.arrow(i.a,i.b,this.drawConfig.vector.color),this.drawConfig.drawHandlePoints&&i.b.attr.selectable?this.draw.circleHandle(i.b,3,"#a8a8a8"):i.b.attr.renderTime=t,this.drawConfig.drawHandlePoints&&i.a.attr.selectable||(i.a.attr.renderTime=t),this.drawConfig.drawHandlePoints&&i.b.attr.selectable||(i.b.attr.renderTime=t)):i instanceof f.PBImage?(this.drawConfig.drawHandleLines&&this.draw.line(i.upperLeft,i.lowerRight,this.drawConfig.image.color,this.drawConfig.image.lineWidth),this.fill.image(i.image,i.upperLeft,i.lowerRight.clone().sub(i.upperLeft)),this.drawConfig.drawHandlePoints&&(this.draw.circleHandle(i.lowerRight,3,this.drawConfig.image.color),i.lowerRight.attr.renderTime=t)):this.console.error("Cannot draw object. Unknown class.")}},t.prototype.drawSelectPolygon=function(){null!=this.selectPolygon&&this.selectPolygon.vertices.length>0&&(this.draw.polygon(this.selectPolygon,"#888888"),this.draw.crosshair(this.selectPolygon.vertices[0],3,"#008888"))},t.prototype.drawVertices=function(t){for(var e in this.vertices)this.drawConfig.drawVertices&&this.vertices[e].attr.renderTime!=t&&this.draw.squareHandle(this.vertices[e],5,this._handleColor(this.vertices[e],"rgb(0,128,192)"))},t.prototype.redraw=function(){var t=(new Date).getTime();this.config.preClear&&this.config.preClear(),this.clear(),this.config.preDraw&&this.config.preDraw(),this.draw.beginDrawCycle(),this.fill.beginDrawCycle(),this.drawGrid(),this.config.drawOrigin&&this.drawOrigin(),this.drawDrawables(t),this.drawVertices(t),this.drawSelectPolygon(),this.config.postDraw&&this.config.postDraw()},t.prototype.clear=function(){this.draw.clear(this.config.backgroundColor)},t.prototype.clearSelection=function(t){for(var e in this.vertices)this.vertices[e].attr.isSelected=!1;return t&&this.redraw(),this},t.prototype.viewport=function(){return new o.Bounds(this.transformMousePosition(0,0),this.transformMousePosition(this.canvasSize.width*this.config.cssScaleX,this.canvasSize.height*this.config.cssScaleY))},t.prototype.saveFile=function(){this.hooks.saveFile(this)},t.prototype.getAvailableContainerSpace=function(){var t=this,e=t.canvas.parentNode,i=t.canvas;i.style.display="none";var s=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding"))||0,r=parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-width"))||0,n=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-left"))||s,o=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-right"))||s,a=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-top"))||s,h=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-bottom"))||s,l=parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-left-width"))||r,c=parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-right-width"))||r,u=parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-top-width"))||r,f=parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-bottom-width"))||r,d=e.clientWidth,p=e.clientHeight;return i.style.display="block",{width:d-n-o-l-c,height:p-a-h-u-f}},t.prototype.resizeCanvas=function(){var t=this,e=function(e,i){e*=t.config.canvasWidthFactor,i*=t.config.canvasHeightFactor,t.canvas.width=e,t.canvas.height=i,t.canvasSize.width=e,t.canvasSize.height=i,t.config.autoAdjustOffset&&(t.draw.offset.x=t.fill.offset.x=t.config.offsetX=e*(t.config.offsetAdjustXPercent/100),t.draw.offset.y=t.fill.offset.y=t.config.offsetY=i*(t.config.offsetAdjustYPercent/100))};if(t.config.fullSize&&!t.config.fitToParent){var i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;t.canvas.style.position="absolute",t.canvas.style.width=t.config.canvasWidthFactor*i+"px",t.canvas.style.height=t.config.canvasWidthFactor*s+"px",t.canvas.style.top="0px",t.canvas.style.left="0px",e(i,s)}else if(t.config.fitToParent){t.canvas.style.position="absolute";var r=this.getAvailableContainerSpace();t.canvas.style.width=t.config.canvasWidthFactor*r.width+"px",t.canvas.style.height=t.config.canvasHeightFactor*r.height+"px",t.canvas.style.top=null,t.canvas.style.left=null,e(r.width,r.height)}else t.canvas.style.width=null,t.canvas.style.height=null,e(t.config.defaultCanvasWidth,t.config.defaultCanvasHeight);t.config.redrawOnResize&&t.redraw()},t.prototype.selectVerticesInPolygon=function(t){for(var e in this.vertices)this.vertices[e].attr.selectable&&t.containsVert(this.vertices[e])&&(this.vertices[e].attr.isSelected=!0)},t.prototype.locatePointNear=function(e,i){var s=this;"undefined"==typeof i&&(i=7),i/=s.draw.scale.x;for(var r=0;r<s.vertices.length;r++){var n=s.vertices[r];if((n.attr.draggable||n.attr.selectable)&&n.distance(e)<i)return new t.Draggable(n,t.Draggable.VERTEX).setVIndex(r)}return null},t.prototype.handleClick=function(e,i){var s=this,r=this.locatePointNear(s.transformMousePosition(e,i),t.DEFAULT_CLICK_TOLERANCE/Math.min(s.config.cssScaleX,s.config.cssScaleY));if(r)if(this.keyHandler&&this.keyHandler.isDown("shift")){if("bpath"==r.typeName){var n=s.paths[r.pindex].bezierCurves[r.cindex].getPointByID(r.pid);n.attr.selectable&&(n.attr.isSelected=!n.attr.isSelected)}else if("vertex"==r.typeName){var n=s.vertices[r.vindex];n.attr.selectable&&(n.attr.isSelected=!n.attr.isSelected)}s.redraw()}else this.keyHandler.isDown("y")&&(s.vertices[r.vindex].attr.bezierAutoAdjust=!s.vertices[r.vindex].attr.bezierAutoAdjust,s.redraw());else if(null!=s.selectPolygon){var n=s.transformMousePosition(e,i);s.selectPolygon.vertices.push(new x.Vertex(n.x,n.y)),s.redraw()}},t.prototype.transformMousePosition=function(t,e){return{x:(t/this.config.cssScaleX-this.config.offsetX)/this.config.scaleX,y:(e/this.config.cssScaleY-this.config.offsetY)/this.config.scaleY}},t.prototype.revertMousePosition=function(t,e){return{x:t/this.config.cssScaleX+this.config.offsetX,y:e/this.config.cssScaleY+this.config.offsetY}},t.prototype.getDraggedElementCount=function(){return this.draggedElements.length},t.prototype.mouseDownHandler=function(e){var i=this;if(1==e.which){var s=i.locatePointNear(i.transformMousePosition(e.params.pos.x,e.params.pos.y),t.DEFAULT_CLICK_TOLERANCE/Math.min(i.config.cssScaleX,i.config.cssScaleY));if(s){if("vertex"==s.typeName&&i.vertices[s.vindex].attr.isSelected)for(var r=0;r<i.vertices.length;r++)i.vertices[r].attr.isSelected&&(i.draggedElements.push(new t.Draggable(i.vertices[r],t.Draggable.VERTEX).setVIndex(r)),i.vertices[r].listeners.fireDragStartEvent(e));else{if(!i.vertices[s.vindex].attr.draggable)return;i.draggedElements.push(s),"bpath"==s.typeName?i.paths[s.pindex].bezierCurves[s.cindex].getPointByID(s.pid).listeners.fireDragStartEvent(e):"vertex"==s.typeName&&i.vertices[s.vindex].listeners.fireDragStartEvent(e)}i.redraw()}}},t.prototype.mouseDragHandler=function(t){var e=this,i={x:t.params.dragAmount.x,y:t.params.dragAmount.y};if(t.params.dragAmount.x/=e.config.cssScaleX,t.params.dragAmount.y/=e.config.cssScaleY,this.keyHandler.isDown("alt")||this.keyHandler.isDown("spacebar"))e.setOffset(e.draw.offset.clone().add(t.params.dragAmount)),e.redraw();else{t.params.dragAmount.x/=e.draw.scale.x,t.params.dragAmount.y/=e.draw.scale.y;for(var s in e.draggedElements){var r=e.draggedElements[s];if("bpath"==r.typeName)e.paths[r.pindex].moveCurvePoint(r.cindex,r.pid,new x.Vertex(t.params.dragAmount.x,t.params.dragAmount.y)),e.paths[r.pindex].bezierCurves[r.cindex].getPointByID(r.pid).listeners.fireDragEvent(t);else if("vertex"==r.typeName){if(!e.vertices[r.vindex].attr.draggable)continue;e.vertices[r.vindex].add(t.params.dragAmount),e.vertices[r.vindex].listeners.fireDragEvent(t)}}}t.params.dragAmount.x=i.x,t.params.dragAmount.y=i.y,e.redraw()},t.prototype.mouseUpHandler=function(t){var e=this;if(1==t.which){t.params.wasDragged||e.handleClick(t.params.pos.x,t.params.pos.y);for(var i in e.draggedElements){var s=e.draggedElements[i];"bpath"==s.typeName?e.paths[s.pindex].bezierCurves[s.cindex].getPointByID(s.pid).listeners.fireDragEndEvent(t):"vertex"==s.typeName&&e.vertices[s.vindex].listeners.fireDragEndEvent(t)}e.draggedElements=[],e.redraw()}},t.prototype.mouseWheelHandler=function(t){var e=1.25,i=this,s=t;s.deltaY<0?i.setZoom(i.config.scaleX*e,i.config.scaleY*e,new x.Vertex(t.params.pos.x,t.params.pos.y)):s.deltaY>0&&i.setZoom(i.config.scaleX/e,i.config.scaleY/e,new x.Vertex(t.params.pos.x,t.params.pos.y)),t.preventDefault(),i.redraw()},t.prototype.setOffset=function(t){this.draw.offset.set(t),this.fill.offset.set(t),this.config.offsetX=t.x,this.config.offsetY=t.y},t.prototype.setZoom=function(t,e,i){var s=this.transformMousePosition(i.x,i.y);this.draw.scale.x=this.fill.scale.x=this.config.scaleX=Math.max(t,.01),this.draw.scale.y=this.fill.scale.y=this.config.scaleY=Math.max(e,.01);var r=this.transformMousePosition(i.x,i.y),n=this.draw.offset.x+(r.x-s.x)*this.draw.scale.x,o=this.draw.offset.y+(r.y-s.y)*this.draw.scale.y;this.setOffset({x:n,y:o})},t.prototype.installInputListeners=function(){var e=this;if(this.config.enableMouse?new u.MouseHandler(this.canvas).down(function(t){e.mouseDownHandler(t)}).drag(function(t){e.mouseDragHandler(t)}).up(function(t){e.mouseUpHandler(t)}):e.console.log("Mouse interaction disabled."),this.config.enableMouseWheel?new u.MouseHandler(this.canvas).wheel(function(t){e.mouseWheelHandler(t)}):e.console.log("Mouse wheel interaction disabled."),this.config.enableTouch){var i=function(t){return{x:t.x-e.canvas.offsetLeft,y:t.y-e.canvas.offsetTop}};if(window.AlloyFinger&&"function"==typeof window.AlloyFinger)try{var s=window.AlloyFinger,r=null,n=null,o=null,a=null,h=function(){r=null,n=null,o=null,a=null,e.draggedElements=[]};new s(this.canvas,{touchStart:function(s){if(1==s.touches.length&&(r=new x.Vertex(i({x:s.touches[0].clientX,y:s.touches[0].clientY})),n=new x.Vertex(i({x:s.touches[0].clientX,y:s.touches[0].clientY})),o=e.locatePointNear(e.transformMousePosition(r.x,r.y),t.DEFAULT_TOUCH_TOLERANCE/Math.min(e.config.cssScaleX,e.config.cssScaleY)),o&&"vertex"==o.typeName)){var a=e.vertices[o.vindex],h={params:{dragAmount:{x:0,y:0},wasDragged:!1,mouseDownPos:n.clone(),mouseDragPos:n.clone(),vertex:a}};e.draggedElements=[o],a.listeners.fireDragStartEvent(h)}},touchMove:function(t){if(1==t.touches.length&&o){t.preventDefault(),t.stopPropagation();var s=i({x:t.touches[0].clientX,y:t.touches[0].clientY}),a=e.transformMousePosition(s.x,s.y),h=new x.Vertex(e.transformMousePosition(r.x,r.y)).difference(a);if("vertex"==o.typeName){if(!e.vertices[o.vindex].attr.draggable)return;e.vertices[o.vindex].add(h);var l=e.vertices[o.vindex],c={params:{dragAmount:h.clone(),wasDragged:!0,mouseDownPos:n.clone(),mouseDragPos:n.clone().add(h),vertex:l}};l.listeners.fireDragEvent(c),e.redraw()}r=new x.Vertex(s)}else 2==t.touches.length&&(t.preventDefault(),t.stopPropagation(),e.setOffset(e.draw.offset.clone().addXY(t.deltaX,t.deltaY)),e.redraw())},touchEnd:function(t){if(o&&"vertex"==o.typeName){var i=e.vertices[o.vindex],s={params:{dragAmount:{x:0,y:0},wasDragged:!1,mouseDownPos:n.clone(),mouseDragPos:n.clone(),vertex:i}};i.listeners.fireDragEndEvent(s)}h()},touchCancel:function(t){h()},multipointStart:function(t){a=e.draw.scale.clone()},multipointEnd:function(t){a=null},pinch:function(t){var i=new x.Vertex(t.touches.item(0).clientX,t.touches.item(0).clientY),s=new x.Vertex(t.touches.item(1).clientX,t.touches.item(1).clientY),r=new c.Line(i,s).vertAt(.5);e.setZoom(a.x*t.zoom,a.y*t.zoom,r),e.redraw()}})}catch(t){console.error("Failed to initialize AlloyFinger!"),console.error(t)}else window.Touchy&&"function"==typeof window.Touchy?console.error("[Deprecation] Found Touchy which is not supported any more. Please use AlloyFinger instead."):console.warn("Cannot initialize the touch handler. AlloyFinger is missig. Did you include it?")}else e.console.log("Touch interaction disabled.");this.config.enableKeys?this.keyHandler=new l.KeyHandler({trackAll:!0}).down("escape",function(){e.clearSelection(!0)}).down("shift",function(){e.selectPolygon=new d.Polygon,e.redraw()}).up("shift",function(){null!=e.selectPolygon&&(e.selectVerticesInPolygon(e.selectPolygon),e.selectPolygon=null,e.redraw())}):e.console.log("Keyboard interaction disabled.")},t.prototype.createGUI=function(){if(window.utils&&"function"==typeof window.utils.createGUI)return window.utils.createGUI(this);throw"Cannot create dat.GUI instance; did you load the ./utils/creategui helper function an the dat.GUI library?"};var e;return t.DEFAULT_CANVAS_WIDTH=1024,t.DEFAULT_CANVAS_HEIGHT=768,t.DEFAULT_CLICK_TOLERANCE=8,t.DEFAULT_TOUCH_TOLERANCE=32,t.Draggable=(e=function(){function e(t,e){this.item=t,this.typeName=e}return e.prototype.isVertex=function(){return this.typeName==t.Draggable.VERTEX},e.prototype.setVIndex=function(t){return this.vindex=t,this},e}(),e.VERTEX="vertex",e),t.utils={safeMergeByKeys:function(t,e){for(var i in e)if(e.hasOwnProperty(i))if(console.log(i,e[i]),t.hasOwnProperty(i)){var s=typeof t[i];try{"boolean"==s?t[i]=!!JSON.parse(e[i]):"number"==s?t[i]=1*JSON.parse(e[i]):"function"==s&&"function"==typeof e[i]?t[i]=e[i]:t[i]=e[i]}catch(t){console.error("error in key ",i,e[i],t)}}else t[i]=e[i];return t},setCSSscale:function(t,e,i){t.style["transform-origin"]="0 0",1==e&&1==i?t.style.transform=null:t.style.transform="scale("+e+","+i+")"},fetch:{val:function(t,e,i){return t.hasOwnProperty(e)?"undefined"==typeof t[e]?i:t[e]:i},num:function(t,e,i){if(!t.hasOwnProperty(e))return i;if("number"==typeof t[e])return t[e];try{return 1*JSON.parse(t[e])}catch(t){return i}},bool:function(t,e,i){if(!t.hasOwnProperty(e))return i;if("boolean"==typeof t[e])return t[e];try{return!!JSON.parse(t[e])}catch(t){return i}},func:function(t,e,i){return t.hasOwnProperty(e)?"function"!=typeof t[e]?i:t[e]:i}},enableBezierPathAutoAdjust:function(t){for(var e=0;e<t.bezierCurves.length;e++)t.bezierCurves[e].startPoint.listeners.addDragListener(function(e){var i=t.locateCurveByStartPoint(e.params.vertex);t.bezierCurves[i].startPoint.addXY(-e.params.dragAmount.x,-e.params.dragAmount.y),t.moveCurvePoint(1*i,t.START_POINT,e.params.dragAmount),t.updateArcLengths()}),t.bezierCurves[e].startControlPoint.listeners.addDragListener(function(e){var i=t.locateCurveByStartControlPoint(e.params.vertex);t.bezierCurves[i].startPoint.attr.bezierAutoAdjust&&(t.adjustPredecessorControlPoint(1*i,!0,!1),t.updateArcLengths())}),t.bezierCurves[e].endControlPoint.listeners.addDragListener(function(e){var i=t.locateCurveByEndControlPoint(e.params.vertex);t.bezierCurves[i%t.bezierCurves.length].endPoint.attr.bezierAutoAdjust&&(t.adjustSuccessorControlPoint(1*i,!0,!1),t.updateArcLengths())}),e+1==t.bezierCurves.length&&t.bezierCurves[t.bezierCurves.length-1].endPoint.listeners.addDragListener(function(e){if(!t.adjustCircular){var i=t.locateCurveByEndPoint(e.params.vertex);t.moveCurvePoint(1*i,t.END_CONTROL_POINT,new x.Vertex({x:e.params.dragAmount.x,y:e.params.dragAmount.y}))}t.updateArcLengths()})},disableBezierPathAutoAdjust:function(t){}},t}();e.PlotBoilerplate=w},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.prototype.build=function(t,e){var i="\n",s="  ",r=[];r.push('<?xml version="1.0" encoding="UTF-8"?>'+i),r.push('<svg width="'+e.canvasSize.width+'" height="'+e.canvasSize.height+'"'),r.push(' viewBox="'),r.push("0"),r.push(" "),r.push("0"),r.push(" "),r.push(e.canvasSize.width.toString()),r.push(" "),r.push(e.canvasSize.height.toString()),r.push('"'),r.push(' xmlns="http://www.w3.org/2000/svg">'+i),r.push(s+"<defs>"+i),r.push(s+"<style>"+i),r.push(s+s+" .Vertex { fill : blue; stroke : none; } "+i),r.push(s+s+" .Triangle { fill : none; stroke : turquoise; stroke-width : 1px; } "+i),r.push(s+s+" .Polygon { fill : none; stroke : green; stroke-width : 2px; } "+i),r.push(s+s+" .BezierPath { fill : none; stroke : blue; stroke-width : 2px; } "+i),r.push(s+s+" .VEllipse { fill : none; stroke : black; stroke-width : 1px; } "+i),r.push(s+s+" .Line { fill : none; stroke : purple; stroke-width : 1px; } "+i),r.push(s+"</style>"+i),r.push(s+"</defs>"+i),r.push(s+'<g class="main-g"'),(e.zoom||e.offset)&&(r.push(' transform="'),e.zoom&&r.push("scale("+e.zoom.x+","+e.zoom.y+")"),e.offset&&r.push(" translate("+e.offset.x+","+e.offset.y+")"),r.push('"')),r.push(">"+i);for(var n in t){var o=t[n];"function"==typeof o.toSVGString?(r.push(s+s),r.push(o.toSVGString({className:o.className})),r.push(i)):console.warn("Unrecognized drawable type has no toSVGString()-function. Ignoring: "+o.className)}return r.push(s+"</g>"+i),r.push("</svg>"+i),r.join("")},t}();e.SVGBuilder=s}])});
//# sourceMappingURL=plotboilerplate.min.js.map