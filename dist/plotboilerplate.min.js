!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("pb",[],e):"object"==typeof exports?exports.pb=e():t.pb=e()}(window,function(){return function(t){function e(s){if(i[s])return i[s].exports;var r=i[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)e.d(s,r,function(e){return t[e]}.bind(null,r));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(1),i(2),i(3),i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15),i(16),i(17)},function(t,e){},function(t,e){(function(){function t(){this.draggable=!0,this.selectable=!0,this.isSelected=!1;for(var e in t.model)this[e]=t.model[e]}return t.model={draggable:!0,selectable:!0,isSelected:!1},t})()},function(t,e){(function(){function t(t){this.drag=[],this.dragStart=[],this.dragEnd=[],this.vertex=t}return t.prototype.addDragListener=function(t){return this.drag.push(t),this},t.prototype.addDragStartListener=function(t){return this.dragStart.push(t),this},t.prototype.addDragEndListener=function(t){return this.dragEnd.push(t),this},t.prototype.fireDragEvent=function(e){t._fireEvent(this,this.drag,e)},t.prototype.fireDragStartEvent=function(e){t._fireEvent(this,this.dragStart,e)},t.prototype.fireDragEndEvent=function(e){t._fireEvent(this,this.dragEnd,e)},t._fireEvent=function(t,e,i){var s=i;"undefined"==typeof s.params?s.params={vertex:t.vertex}:s.params.vertex=t.vertex;for(var r in e)e[r](s)},t})()},function(t,e){(function(){function t(t,e){if("undefined"==typeof t)this.x=0,this.y=0;else if("number"==typeof t&&"number"==typeof e)this.x=t,this.y=e;else{var i=t;"number"==typeof i.x&&"number"==typeof i.y?(this.x=i.x,this.y=i.y):("number"==typeof t?this.x=t:"undefined"==typeof t?this.x=0:this.x=NaN,"number"==typeof e?this.y=e:"undefined"==typeof e?this.y=0:this.y=NaN)}this.attr=new VertexAttr,this.listeners=new VertexListeners(this)}return t.prototype.set=function(t,e){if("number"==typeof t&&"number"==typeof e)this.x=t,this.y=e;else{var i=t;"number"==typeof i.x&&"number"==typeof i.y?(this.x=i.x,this.y=i.y):("number"==typeof t?this.x=t:"undefined"==typeof t?this.x=0:this.x=NaN,"number"==typeof e?this.y=e:"undefined"==typeof e?this.y=0:this.y=NaN)}return this},t.prototype.setX=function(t){return this.x=t,this},t.prototype.setY=function(t){return this.y=t,this},t.prototype.invX=function(){return this.x=-this.x,this},t.prototype.invY=function(){return this.y=-this.y,this},t.prototype.add=function(t,e){if("number"==typeof t&&"number"==typeof e)this.x+=t,this.y+=e;else{var i=t;"number"==typeof i.x&&"number"==typeof i.y?(this.x+=i.x,this.y+=i.y):("number"==typeof t?this.x+=t:console.warn("Cannot add "+typeof t+" to numeric x component!"),"number"==typeof e?this.y+=e:console.warn("Cannot add "+typeof e+" to numeric y component!"))}return this},t.prototype.addXY=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.sub=function(t,e){if("number"==typeof t&&"number"==typeof e)this.x-=t,this.y-=e;else{var i=t;"number"==typeof i.x&&"number"==typeof i.y?(this.x-=i.x,this.y-=i.y):("number"==typeof t?this.x-=t:console.warn("Cannot add "+typeof t+" to numeric x component!"),"number"==typeof e?this.y-=e:console.warn("Cannot add "+typeof e+" to numeric y component!"))}return this},t.prototype.equals=function(e){var i=Math.abs(this.x-e.x)<t.EPSILON,s=Math.abs(this.y-e.y)<t.EPSILON,r=i&&s;return r},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.distance=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))},t.prototype.difference=function(e){return new t(e.x-this.x,e.y-this.y)},t.prototype.scale=function(e,i){return i&&"undefined"!=typeof i||(i=new t(0,0)),this.x=i.x+(this.x-i.x)*e,this.y=i.y+(this.y-i.y)*e,this},t.prototype.rotate=function(e,i){i&&"undefined"!=typeof i||(i=new t(0,0)),this.sub(i),e+=Math.atan2(this.y,this.x);var s=this.distance(t.ZERO);this.x,this.y;return this.x=s*Math.cos(e),this.y=s*Math.sin(e),this.add(i),this},t.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},t.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.prototype.inv=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.toString=function(){return"("+this.x+","+this.y+")"},t.prototype.toSVGString=function(t){t=t||{};var e=[];return e.push("<circle"),t.className&&e.push(' class="'+t.className+'"'),e.push(' cx="'+this.x+'"'),e.push(' cy="'+this.y+'"'),e.push(' r="2"'),e.push(" />"),e.join("")},t.randomVertex=function(e){return new t(e.min.x+Math.random()*(e.max.x-e.min.x),e.min.y+Math.random()*(e.max.y-e.min.y))},t.ZERO=new t(0,0),t.EPSILON=1e-6,t.utils={buildArrowHead:function(e,i,s,r,n){var o=Math.atan2((i.y-e.y)*n,(i.x-e.x)*r),a=[];return a.push(new t(i.x*r-s*Math.cos(o),i.y*n-s*Math.sin(o))),a.push(new t(i.x*r-1.35*s*Math.cos(o-Math.PI/8),i.y*n-1.35*s*Math.sin(o-Math.PI/8))),a.push(new t(i.x*r,i.y*n)),a.push(new t(i.x*r-1.35*s*Math.cos(o+Math.PI/8),i.y*n-1.35*s*Math.sin(o+Math.PI/8))),a}},t})()},function(t,e){(function(){function t(t,e){this.center=t,this.size=e}return t.utils={baseLog:function(t,e){return Math.log(t)/Math.log(e)},mapRasterScale:function(e,i){var s=1;return i>=1?(s=Math.abs(Math.floor(1/t.utils.baseLog(e,i))),s=1/Math.pow(e,s)):s=Math.abs(Math.floor(t.utils.baseLog(1/e,1/(i+1)))),s}},t})()},function(t,e){var i=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();(function(t){function e(i,s){return t.call(this,i,s,function(t,i){return new e(t,i)})||this}return i(e,t),e.prototype.intersection=function(t){var e=this.denominator(t);if(0==e)return null;var i=this.a.y-t.a.y,s=this.a.x-t.a.x,r=(t.b.x-t.a.x)*i-(t.b.y-t.a.y)*s,n=(this.b.x-this.a.x)*i-(this.b.y-this.a.y)*s;return i=r/e,s=n/e,new Vertex(this.a.x+i*(this.b.x-this.a.x),this.a.y+i*(this.b.y-this.a.y))},e.prototype.toSVGString=function(t){t=t||{};var e=[];return e.push("<line"),t.className&&e.push(' class="'+t.className+'"'),e.push(' x1="'+this.a.x+'"'),e.push(' y1="'+this.a.y+'"'),e.push(' x2="'+this.b.x+'"'),e.push(' y2="'+this.b.y+'"'),e.push(" />"),e.join("")},e})(VertTuple)},function(t,e){var i=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();(function(t){function e(i,s){return t.call(this,i,s,function(t,i){return new e(t,i)})||this}return i(e,t),e.prototype.perp=function(){var t=this.clone();return t.sub(this.a),t=new e(new Vertex,new Vertex(-t.b.y,t.b.x)),t.a.add(this.a),t.b.add(this.a),t},e.prototype.inverse=function(){var t=this.a;return this.a=this.b,this.b=t,this},e.prototype.inv=function(){return this.b.x=this.a.x-(this.b.x-this.a.x),this.b.y=this.a.y-(this.b.y-this.a.y),this},e.prototype.intersection=function(t){var e=this.denominator(t);if(0==e)return null;var i=this.a.y-t.a.y,s=this.a.x-t.a.x,r=(t.b.x-t.a.x)*i-(t.b.y-t.a.y)*s,n=(this.b.x-this.a.x)*i-(this.b.y-this.a.y)*s;return i=r/e,s=n/e,new Vertex(this.a.x+i*(this.b.x-this.a.x),this.a.y+i*(this.b.y-this.a.y))},e.prototype.toSVGString=function(t){t=t||{};var i=[],s=e.utils.buildArrowHead(this.a,this.b,8,1,1);i.push("<g"),t.className&&i.push(' class="'+t.className+'"'),i.push(">"),i.push("   <line"),i.push(' x1="'+this.a.x+'"'),i.push(' y1="'+this.a.y+'"'),i.push(' x2="'+s[0].x+'"'),i.push(' y2="'+s[0].y+'"'),i.push(" />"),i.push('   <polygon points="');for(var r=0;r<s.length;r++)r>0&&i.push(" "),i.push(""+s[r].x+","+s[r].y);return i.push('"/>'),i.push("</g>"),i.join("")},e.utils={buildArrowHead:function(t,e,i,s,r){var n=Math.atan2((e.y-t.y)*r,(e.x-t.x)*s),o=[];return o.push(new Vertex(e.x*s-i*Math.cos(n),e.y*r-i*Math.sin(n))),o.push(new Vertex(e.x*s-1.35*i*Math.cos(n-Math.PI/8),e.y*r-1.35*i*Math.sin(n-Math.PI/8))),o.push(new Vertex(e.x*s,e.y*r)),o.push(new Vertex(e.x*s-1.35*i*Math.cos(n+Math.PI/8),e.y*r-1.35*i*Math.sin(n+Math.PI/8))),o}},e})(VertTuple)},function(t,e){(function(){function t(e,i,s,r){this.START_POINT=t.START_POINT,this.START_CONTROL_POINT=t.START_CONTROL_POINT,this.END_CONTROL_POINT=t.END_CONTROL_POINT,this.END_POINT=t.END_POINT,this.startPoint=e,this.startControlPoint=s,this.endPoint=i,this.endControlPoint=r,this.curveIntervals=30,this.segmentCache=[],this.segmentLengths=[],this.arcLength=null,this.updateArcLengths()}return t.prototype.moveCurvePoint=function(t,e,i,s){t==this.START_POINT?(this.getStartPoint().add(e),i&&this.getStartControlPoint().add(e)):t==this.START_CONTROL_POINT?this.getStartControlPoint().add(e):t==this.END_CONTROL_POINT?this.getEndControlPoint().add(e):t==this.END_POINT?(this.getEndPoint().add(e),i&&this.getEndControlPoint().add(e)):console.log("[CubicBezierCurve.moveCurvePoint] pointID '"+t+"' invalid."),s&&this.updateArcLengths()},t.prototype.translate=function(t){return this.startPoint.add(t),this.startControlPoint.add(t),this.endControlPoint.add(t),this.endPoint.add(t),this},t.prototype.reverse=function(){var t=this.startPoint;return this.startPoint=this.endPoint,this.endPoint=t,t=this.startControlPoint,this.startControlPoint=this.endControlPoint,this.endControlPoint=t,this},t.prototype.getLength=function(){return this.arcLength},t.prototype.updateArcLengths=function(){var t=this.startPoint.clone(),e=new Vertex(0,0),i=1/this.curveIntervals;this.segmentCache=[],this.segmentCache.push(this.startPoint),this.segmentLengths=[];for(var s,r=0,n=0;n<=1;)e=this.getPointAt(n),this.segmentCache.push(e),s=t.distance(e),this.segmentLengths.push(s),r+=s,t=e,n+=i;this.arcLength=r},t.prototype.getStartPoint=function(){return this.startPoint},t.prototype.getEndPoint=function(){return this.endPoint},t.prototype.getStartControlPoint=function(){return this.startControlPoint},t.prototype.getEndControlPoint=function(){return this.endControlPoint},t.prototype.getPointByID=function(t){if(t==this.START_POINT)return this.startPoint;if(t==this.END_POINT)return this.endPoint;if(t==this.START_CONTROL_POINT)return this.startControlPoint;if(t==this.END_CONTROL_POINT)return this.endControlPoint;throw new Error("Invalid point ID '"+t+"'.")},t.prototype.getPointAt=function(t){var e=this.startPoint.x*Math.pow(1-t,3)+3*this.startControlPoint.x*t*Math.pow(1-t,2)+3*this.endControlPoint.x*Math.pow(t,2)*(1-t)+this.endPoint.x*Math.pow(t,3),i=this.startPoint.y*Math.pow(1-t,3)+3*this.startControlPoint.y*t*Math.pow(1-t,2)+3*this.endControlPoint.y*Math.pow(t,2)*(1-t)+this.endPoint.y*Math.pow(t,3);return new Vertex(e,i)},t.prototype.getPoint=function(t){return this.getPointAt(t/this.arcLength)},t.prototype.getTangentAt=function(t){var e=this.getStartPoint(),i=this.getStartControlPoint(),s=this.getEndControlPoint(),r=this.getEndPoint(),n=t*t,o=1-2*t+n,a=-3*e.x*o+i.x*(3*o-6*(t-n))+s.x*(6*(t-n)-3*n)+3*r.x*n,h=-3*e.y*o+i.y*(3*o-6*(t-n))+s.y*(6*(t-n)-3*n)+3*r.y*n;return new Vertex(a,h)},t.prototype.getSubCurveAt=function(e,i){var s=new Vector(this.getPointAt(e),this.getTangentAt(e)),r=new Vector(this.getPointAt(i),this.getTangentAt(i).inv());return s.b.add(s.a),r.b.add(r.a),s.scale(.33333333*(i-e)),r.scale(.33333333*(i-e)),new t(s.a,r.a,s.b,r.b)},t.prototype.convertU2T=function(t){return Math.max(0,Math.min(1,t/this.arcLength))},t.prototype.getTangent=function(t){return this.getTangentAt(this.convertU2T(t))},t.prototype.getPerpendicular=function(t){return this.getPerpendicularAt(this.convertU2T(t))},t.prototype.getPerpendicularAt=function(t){var e=this.getTangentAt(t);return new Vertex(e.y,-e.x)},t.prototype.clone=function(){return new t(this.getStartPoint().clone(),this.getEndPoint().clone(),this.getStartControlPoint().clone(),this.getEndControlPoint().clone())},t.prototype.equals=function(t){return!!t&&(!!(t.startPoint&&t.endPoint&&t.startControlPoint&&t.endControlPoint)&&(this.startPoint.equals(t.startPoint)&&this.endPoint.equals(t.endPoint)&&this.startControlPoint.equals(t.startControlPoint)&&this.endControlPoint.equals(t.endControlPoint)))},t.isInstance=function(e){return e instanceof t},t.prototype.toSVGPathData=function(){var t=[];return t.push("M "),t.push(this.startPoint.x.toString()),t.push(" "),t.push(this.startPoint.y.toString()),t.push(" C "),t.push(this.startControlPoint.x.toString()),t.push(" "),t.push(this.startControlPoint.y.toString()),t.push(" "),t.push(this.endControlPoint.x.toString()),t.push(" "),t.push(this.endControlPoint.y.toString()),t.push(" "),t.push(this.endPoint.x.toString()),t.push(" "),t.push(this.endPoint.y.toString()),t.join("")},t.prototype.toJSON=function(t){var e="{ "+(t?"\n\t":"")+'"startPoint" : ['+this.getStartPoint().x+","+this.getStartPoint().y+"], "+(t?"\n\t":"")+'"endPoint" : ['+this.getEndPoint().x+","+this.getEndPoint().y+"], "+(t?"\n\t":"")+'"startControlPoint": ['+this.getStartControlPoint().x+","+this.getStartControlPoint().y+"], "+(t?"\n\t":"")+'"endControlPoint" : ['+this.getEndControlPoint().x+","+this.getEndControlPoint().y+"]"+(t?"\n\t":"")+" }";return e},t.fromJSON=function(e){var i=JSON.parse(e);return t.fromObject(i)},t.fromObject=function(e){if("object"!=typeof e)throw"Can only build from object.";if(!e.startPoint)throw'Object member "startPoint" missing.';if(!e.endPoint)throw'Object member "endPoint" missing.';if(!e.startControlPoint)throw'Object member "startControlPoint" missing.';if(!e.endControlPoint)throw'Object member "endControlPoint" missing.';return new t(new Vertex(e.startPoint[0],e.startPoint[1]),new Vertex(e.endPoint[0],e.endPoint[1]),new Vertex(e.startControlPoint[0],e.startControlPoint[1]),new Vertex(e.endControlPoint[0],e.endControlPoint[1]))},t.fromArray=function(e){if(!Array.isArray(e))throw"Can only build from object.";if(4!=e.length)throw"Can only build from array with four elements.";return new t(e[0],e[1],e[2],e[3])},t.START_POINT=0,t.START_CONTROL_POINT=1,t.END_CONTROL_POINT=2,t.END_POINT=3,t})()},function(t,e){(function(){function t(t){this.START_POINT=0,this.START_CONTROL_POINT=1,this.END_CONTROL_POINT=2,this.END_POINT=3,t||(t=[]),this.totalArcLength=0,this.adjustCircular=!1,this.bezierCurves=[]}return t.prototype.addCurve=function(t){if(null==t||"undefined"==typeof t)throw"Cannot add null curve to bézier path.";this.bezierCurves.push(t),this.bezierCurves.length>1?(t.startPoint=this.bezierCurves[this.bezierCurves.length-2].endPoint,this.adjustSuccessorControlPoint(this.bezierCurves.length-2,!0,!0)):this.totalArcLength+=t.getLength()},t.prototype.locateCurveByStartPoint=function(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].startPoint.equals(t))return e;return-1},t.prototype.locateCurveByEndPoint=function(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].endPoint.equals(t))return e;return-1},t.prototype.locateCurveByStartControlPoint=function(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].startControlPoint.equals(t))return e;return-1},t.prototype.locateCurveByEndControlPoint=function(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].endControlPoint.equals(t))return e;return-1},t.prototype.getLength=function(){return this.totalArcLength},t.prototype.updateArcLengths=function(){this.totalArcLength=0;for(var t=0;t<this.bezierCurves.length;t++)this.bezierCurves[t].updateArcLengths(),this.totalArcLength+=this.bezierCurves[t].getLength()},t.prototype.getCurveCount=function(){return this.bezierCurves.length},t.prototype.getCurveAt=function(t){return this.bezierCurves[t]},t.prototype.translate=function(t){for(var e=0;e<this.bezierCurves.length;e++){var i=this.bezierCurves[e];i.getStartPoint().add(t),i.getStartControlPoint().add(t),i.getEndControlPoint().add(t)}var i=this.bezierCurves[this.bezierCurves.length-1];return i.getEndPoint().add(t),this.updateArcLengths(),this},t.prototype.scale=function(t,e){for(var i=0;i<this.bezierCurves.length;i++){var s=this.bezierCurves[i];s.getStartPoint().scale(e,t),s.getStartControlPoint().scale(e,t),s.getEndControlPoint().scale(e,t)}return this.bezierCurves.length>0&&!this.adjustCircular&&this.bezierCurves[this.bezierCurves.length-1].getEndPoint().scale(e,t),this.updateArcLengths(),this},t.prototype.rotate=function(t,e){for(var i=0;i<this.bezierCurves.length;i++){var s=this.bezierCurves[i];s.getStartPoint().rotate(t,e),s.getStartControlPoint().rotate(t,e),s.getEndControlPoint().rotate(t,e)}this.bezierCurves.length>0&&!this.adjustCircular&&this.bezierCurves[this.bezierCurves.length-1].getEndPoint().rotate(t,e)},t.prototype.getPoint=function(t){if(t<0||t>this.totalArcLength)return console.log("[BezierPath.getPoint(u)] u is out of bounds: "+t+"."),null;for(var e=0,i=0;e<this.bezierCurves.length&&i+this.bezierCurves[e].getLength()<t;)i+=this.bezierCurves[e].getLength(),e++;if(e>=this.bezierCurves.length)return this.bezierCurves[this.bezierCurves.length-1].getEndPoint().clone();var s=this.bezierCurves[e],r=t-i;return s.getPoint(r)},t.prototype.getPointAt=function(t){return this.getPoint(t*this.totalArcLength)},t.prototype.getTangentAt=function(t){return this.getTangent(t*this.totalArcLength)},t.prototype.getTangent=function(t){if(t<0||t>this.totalArcLength)return console.warn("[BezierPath.getTangent(u)] u is out of bounds: "+t+"."),null;for(var e=0,i=0;e<this.bezierCurves.length&&i+this.bezierCurves[e].getLength()<t;)i+=this.bezierCurves[e].getLength(),e++;var s=this.bezierCurves[e],r=t-i;return s.getTangent(r)},t.prototype.getPerpendicularAt=function(t){return this.getPerpendicular(t*this.totalArcLength)},t.prototype.getPerpendicular=function(e){if(e<0||e>this.totalArcLength)return console.log("[BezierPath.getPerpendicular(u)] u is out of bounds: "+e+"."),null;var i=t._locateUIndex(this,e),s=this.bezierCurves[i.i],r=e-i.uPart;return s.getPerpendicular(r)},t._locateUIndex=function(t,e){for(var i=0,s=0,r=0;i<t.bezierCurves.length&&s+t.bezierCurves[i].getLength()<e;)s+=t.bezierCurves[i].getLength(),i+1<t.bezierCurves.length&&(r+=t.bezierCurves[i].getLength()),i++;return{i:i,uPart:s,uBefore:r}},t.prototype.getSubPathAt=function(e,i){e=Math.max(0,e),i=Math.min(1,i);var s=e*this.totalArcLength,r=i*this.totalArcLength,n=t._locateUIndex(this,s),o=t._locateUIndex(this,r),a=(s-n.uBefore)/this.bezierCurves[n.i].getLength();if(n.i==o.i){var h=(r-o.uBefore)/this.bezierCurves[o.i].getLength(),l=this.bezierCurves[n.i].getSubCurveAt(a,h);return t.fromArray([l])}var u=[];if(n.i>o.i){var l=this.bezierCurves[n.i].getSubCurveAt(a,0);u.push(l);for(var c=n.i-1;c>o.i;c--)u.push(this.bezierCurves[c].clone().reverse());var h=(r-o.uBefore)/this.bezierCurves[o.i].getLength();u.push(this.bezierCurves[o.i].getSubCurveAt(1,h))}else{var l=this.bezierCurves[n.i].getSubCurveAt(a,1);u.push(l);for(var c=n.i+1;c<o.i&&c<this.bezierCurves.length;c++)u.push(this.bezierCurves[c].clone());var h=(r-o.uBefore)/this.bezierCurves[o.i].getLength();u.push(this.bezierCurves[o.i].getSubCurveAt(0,h))}return t.fromArray(u)},t.prototype.moveCurvePoint=function(t,e,i){var s=this.getCurveAt(t);if(s.moveCurvePoint(e,i,!0,!0),e==this.START_POINT&&(t>0||this.adjustCircular)){var r=this.getCurveAt(t-1<0?this.bezierCurves.length+(t-1):t-1);r.moveCurvePoint(this.END_CONTROL_POINT,i,!0,!1)}else if(e==this.END_POINT&&(t+1<this.bezierCurves.length||this.adjustCircular)){var n=this.getCurveAt((t+1)%this.bezierCurves.length);n.moveCurvePoint(this.START_CONTROL_POINT,i,!0,!1)}else e==this.START_CONTROL_POINT&&t>0?this.adjustPredecessorControlPoint(t,!0,!1):e==this.END_CONTROL_POINT&&t+1<this.getCurveCount()&&this.adjustSuccessorControlPoint(t,!0,!1);this.updateArcLengths()},t.prototype.adjustPredecessorControlPoint=function(t,e,i){if(this.adjustCircular||!(t<=0)){var s=this.getCurveAt(t),r=this.getCurveAt(t-1<0?this.getCurveCount()+(t-1):t-1);this.adjustNeighbourControlPoint(s,r,s.getStartPoint(),s.getStartControlPoint(),r.getEndPoint(),r.getEndControlPoint(),e,i)}},t.prototype.adjustSuccessorControlPoint=function(t,e,i){if(this.adjustCircular||!(t+1>this.getCurveCount())){var s=this.getCurveAt(t),r=this.getCurveAt((t+1)%this.getCurveCount());return this.adjustNeighbourControlPoint(s,r,s.getEndPoint(),s.getEndControlPoint(),r.getStartPoint(),r.getStartControlPoint(),e,i)}},t.prototype.adjustNeighbourControlPoint=function(t,e,i,s,r,n,o,a){var h=new Vertex(s.x-i.x,s.y-i.y),l=new Vertex(n.x-r.x,n.y-r.y),u=Math.sqrt(Math.pow(h.x,2)+Math.pow(h.y,2)),c=Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2));u<=.1||(o?n.set(r.x-h.x*(c/u),r.y-h.y*(c/u)):n.set(r.x-h.x,r.y-h.y),e.updateArcLengths())},t.prototype.clone=function(){for(var e=new t(null),i=0;i<this.bezierCurves.length;i++)e.bezierCurves.push(this.bezierCurves[i].clone()),i>0&&(e.bezierCurves[i-1].endPoint=e.bezierCurves[i].startPoint);return e.updateArcLengths(),e.adjustCircular=this.adjustCircular,e},t.prototype.equals=function(t){if(!t)return!1;if(!t.bezierCurves)return!1;if("undefined"==typeof t.bezierCurves.length)return!1;if(t.bezierCurves.length!=this.bezierCurves.length)return!1;for(var e=0;e<this.bezierCurves.length;e++)if(!this.bezierCurves[e].equals(t.bezierCurves[e]))return!1;return!0},t.prototype.toSVGString=function(t){t=t||{};var e=[];e.push("<path"),t.className&&e.push(' class="'+t.className+'"'),e.push(' d="');for(var i=0;i<this.bezierCurves.length;i++)i>0&&e.push(" "),e.push(this.bezierCurves[i].toSVGPathData());return e.push('" />'),e.join("")},t.prototype.toJSON=function(t){var e=[];e.push("[");for(var i=0;i<this.bezierCurves.length;i++)i>0&&e.push(","),t?e.push("\n\t"):e.push(" "),e.push(this.bezierCurves[i].toJSON(t));return 0!=this.bezierCurves.length&&e.push(" "),e.push("]"),e.join("")},t.prototype.fromJSON=function(e){var i=JSON.parse(e);return t.fromArray(i)},t.fromArray=function(e){if(!Array.isArray(e))throw"[BezierPath.fromArray] Passed object must be an array.";var i=e;if(i.length<1)throw"[BezierPath.fromArray] Passed array must contain at least one bezier curve (has "+i.length+").";for(var s=new t(null),r=null,n=0;n<i.length;n++){var o=null;if(CubicBezierCurve.isInstance(i[n]))o=i[n].clone();else if(0 in i[n]&&1 in i[n]&&2 in i[n]&&3 in i[n]){if(!(i[n][0]&&i[n][1]&&i[n][2]&&i[n][3]))throw"Cannot convert path data to BezierPath instance. At least one element is undefined (index="+n+"): "+i[n];o=CubicBezierCurve.fromArray(i[n])}else o=CubicBezierCurve.fromObject(i[n]);r&&(o.startPoint=r.endPoint),s.bezierCurves.push(o),r=o}return s.updateArcLengths(),s},t.prototype.toReducedListRepresentation=function(e){"undefined"==typeof e&&(e=1);var i=[];i.push("[");for(var s=0;s<this.bezierCurves.length;s++){var r=this.bezierCurves[s];i.push(t._roundToDigits(r.getStartPoint().x,e,!1)),i.push(","),i.push(t._roundToDigits(r.getStartPoint().y,e,!1)),i.push(","),i.push(t._roundToDigits(r.getStartControlPoint().x,e,!1)),i.push(","),i.push(t._roundToDigits(r.getStartControlPoint().y,e,!1)),i.push(","),i.push(t._roundToDigits(r.getEndControlPoint().x,e,!1)),i.push(","),i.push(t._roundToDigits(r.getEndControlPoint().y,e,!1)),i.push(",")}if(0!=this.bezierCurves.length){var r=this.bezierCurves[this.bezierCurves.length-1];i.push(t._roundToDigits(r.getEndPoint().x,e,!1)),i.push(","),i.push(t._roundToDigits(r.getEndPoint().y,e,!1))}return i.push("]"),i.join("")},t.fromReducedListRepresentation=function(e){var i=JSON.parse(e);if(!i.length)throw console.log("Cannot parse bezier path from non-array object nor from empty point list."),"Cannot parse bezier path from non-array object nor from empty point list.";if(i.length<8)throw console.log("Cannot build bezier path. The passed array must contain at least 8 elements (numbers)."),"Cannot build bezier path. The passed array must contain at least 8 elements (numbers).";var s=new t(null),r=null,n=null,o=null,a=null,h=0;do{0==h&&(r=new Vertex(i[h],i[h+1])),n=new Vertex(i[h+2],i[h+3]),o=new Vertex(i[h+4],i[h+5]),a=new Vertex(i[h+6],i[h+7]);var l=new CubicBezierCurve(r,a,n,o);s.bezierCurves.push(l),r=a,h+=6}while(h+2<i.length);return s.updateArcLengths(),s},t._roundToDigits=function(t,e,i){if(e<=0)return Math.round(t).toString();var s=Math.pow(10,e);t=Math.round(t*s);var r=""+t/s,n=r.lastIndexOf(".");if(n==-1&&(n=r.length),i)for(var o=r.length-n-1,a=e-o;a-- >0;)r+="&nbsp;";return r},t.START_POINT=0,t.START_CONTROL_POINT=1,t.END_CONTROL_POINT=2,t.END_POINT=3,t})()},function(t,e){(function(){function t(t,e){"undefined"==typeof t&&(t=[]),this.vertices=t,this.isOpen=e}return t.prototype.containsVert=function(t){for(var e=!1,i=0,s=this.vertices.length-1;i<this.vertices.length;s=i++){var r=this.vertices[i].x,n=this.vertices[i].y,o=this.vertices[s].x,a=this.vertices[s].y,h=n>t.y!=a>t.y&&t.x<(o-r)*(t.y-n)/(a-n)+r;h&&(e=!e)}return e},t.prototype.scale=function(t,e){for(var i in this.vertices)"function"==typeof this.vertices[i].scale?this.vertices[i].scale(t,e):console.log("There seems to be a null vertex!",this.vertices[i]);return this},t.prototype.rotate=function(t,e){for(var i in this.vertices)this.vertices[i].rotate(t,e);return this},t.prototype.toQuadraticBezierData=function(){if(this.vertices.length<3)return[];var t=[],e=this.vertices[0],i=this.vertices[1],s=new Vertex(e.x+(i.x-e.x)/2,e.y+(i.y-e.y)/2);t.push(s);for(var r=this.isOpen?this.vertices.length:this.vertices.length+1,n=1;n<r;n++){e=this.vertices[n%this.vertices.length],i=this.vertices[(n+1)%this.vertices.length];var s=new Vertex(e.x+(i.x-e.x)/2,e.y+(i.y-e.y)/2);t.push(e),t.push(s),e=i}return t},t.prototype.toQuadraticBezierSVGString=function(){var t=this.toQuadraticBezierData();if(0==t.length)return"";for(var e=["M "+t[0].x+" "+t[0].y],i=1;i<t.length;i+=2)e.push("Q "+t[i].x+" "+t[i].y+", "+t[i+1].x+" "+t[i+1].y);return e.join(" ")},t.prototype.toCubicBezierData=function(t){if("undefined"==typeof t&&(t=1),this.vertices.length<3)return[];var e=[],i=this.vertices[0],s=this.vertices[1],r=new Vertex(i.x+(s.x-i.x)/2,i.y+(s.y-i.y)/2);e.push(r);for(var n=this.isOpen?this.vertices.length-1:this.vertices.length,o=0;o<n;o++){var i=this.vertices[o%this.vertices.length],s=this.vertices[(o+1)%this.vertices.length],a=this.vertices[(o+2)%this.vertices.length],h=new Vertex(i.x+(s.x-i.x)/2,i.y+(s.y-i.y)/2),l=new Vertex(s.x+(a.x-s.x)/2,s.y+(a.y-s.y)/2),u=new Vertex(h.x+(s.x-h.x)*t,h.y+(s.y-h.y)*t),c=new Vertex(l.x+(s.x-l.x)*t,l.y+(s.y-l.y)*t);e.push(u),e.push(c),e.push(l)}return e},t.prototype.toCubicBezierSVGString=function(t){var e=this.toCubicBezierData(t);if(0==e.length)return"";for(var i=["M "+e[0].x+" "+e[0].y],s=1;s<e.length;s+=3)i.push("C "+e[s].x+" "+e[s].y+", "+e[s+1].x+" "+e[s+1].y+", "+e[s+2].x+" "+e[s+2].y);return i.join(" ")},t.prototype.toCubicBezierPath=function(t){for(var e=this.toCubicBezierData(t),i=[],s=0;s+3<e.length;s+=3)i.push([e[s],e[s+3],e[s+1],e[s+2]]);return BezierPath.fromArray(i)},t.prototype.toSVGString=function(t){t=t||{};var e=[];if(e.push("<path"),t.className&&e.push(' class="'+t.className+'"'),e.push(' d="'),this.vertices.length>0){e.push("M "),e.push(this.vertices[0].x.toString()),e.push(" "),e.push(this.vertices[0].y.toString());for(var i=1;i<this.vertices.length;i++)e.push(" L "),e.push(this.vertices[i].x.toString()),e.push(" "),e.push(this.vertices[i].y.toString());this.isOpen||e.push(" Z")}return e.push('" />'),e.join("")},t})()},function(t,e){(function(){function t(t,e,i){this.a=t,this.b=e,this.c=i,this.calcCircumcircle()}return t.fromArray=function(e){if(e.length<3)throw"Cannot create triangle from array with less than three vertices ("+e.length+")";return new t(e[0],e[1],e[2])},t.prototype.getCentroid=function(){return new Vertex((this.a.x+this.b.x+this.c.x)/3,(this.a.y+this.b.y+this.c.y)/3)},t.prototype.scaleToCentroid=function(t){var e=this.getCentroid();return this.a.scale(t,e),this.b.scale(t,e),this.c.scale(t,e),this},t.prototype.getCircumcircle=function(){return this.center&&this.radius||this.calcCircumcircle(),{center:this.center.clone(),radius:this.radius}},t.prototype.isAdjacent=function(t){var e=this.a.equals(t.a)||this.a.equals(t.b)||this.a.equals(t.c),i=this.b.equals(t.a)||this.b.equals(t.b)||this.b.equals(t.c),s=this.c.equals(t.a)||this.c.equals(t.b)||this.c.equals(t.c);return e&&i||e&&s||i&&s},t.prototype.getThirdVertex=function(t,e){return this.a.equals(t)&&this.b.equals(e)||this.a.equals(e)&&this.b.equals(t)?this.c:this.b.equals(t)&&this.c.equals(e)||this.b.equals(e)&&this.c.equals(t)?this.a:this.b},t.prototype.calcCircumcircle=function(){var e,i,s=this.b.x-this.a.x,r=this.b.y-this.a.y,n=this.c.x-this.a.x,o=this.c.y-this.a.y,a=s*(this.a.x+this.b.x)+r*(this.a.y+this.b.y),h=n*(this.a.x+this.c.x)+o*(this.a.y+this.c.y),l=2*(s*(this.c.y-this.b.y)-r*(this.c.x-this.b.x));if(Math.abs(l)<t.EPSILON){var u=this.bounds();this.center=new Vertex((u.xMin+u.xMax)/2,(u.yMin+u.yMax)/2),e=this.center.x-u.xMin,i=this.center.y-u.yMin}else{var c=(o*a-r*h)/l,f=(s*h-n*a)/l;this.center=new Vertex(c,f),e=this.center.x-this.a.x,i=this.center.y-this.a.y}this.radius_squared=e*e+i*i,this.radius=Math.sqrt(this.radius_squared)},t.prototype.inCircumcircle=function(t){var e=this.center.x-t.x,i=this.center.y-t.y,s=e*e+i*i;return s<=this.radius_squared},t.prototype.bounds=function(){var e=t.utils.min3(this.a.x,this.b.x,this.c.x),i=t.utils.min3(this.a.y,this.b.y,this.c.y),s=t.utils.max3(this.a.x,this.b.x,this.c.x),r=t.utils.max3(this.a.y,this.b.y,this.c.y);return{xMin:e,yMin:i,xMax:s,yMax:r,width:s-e,height:r-i}},t.prototype.toPolygon=function(){return new Polygon([this.a,this.b,this.c])},t.prototype.determinant=function(){return(this.b.y-this.a.y)*(this.c.x-this.b.x)-(this.c.y-this.b.y)*(this.b.x-this.a.x)},t.prototype.containsPoint=function(e){return t.utils.pointIsInTriangle(e.x,e.y,this.a.x,this.a.y,this.b.x,this.b.y,this.c.x,this.c.y)},t.prototype.toString=function(){return"{ a : "+this.a.toString()+", b : "+this.b.toString()+", c : "+this.c.toString()+"}"},t.prototype.toSVGString=function(t){t=t||{};var e=[];e.push("<path"),t.className&&e.push(' class="'+t.className+'"'),e.push(' d="');var i=[this.a,this.b,this.c];if(i.length>0){e.push("M "),e.push(i[0].x),e.push(" "),e.push(i[0].y);for(var s=1;s<i.length;s++)e.push(" L "),e.push(i[s].x),e.push(" "),e.push(i[s].y);e.push(" Z")}return e.push('" />'),e.join("")},t.EPSILON=1e-6,t.utils={max3:function(t,e,i){return t>=e&&t>=i?t:e>=t&&e>=i?e:i},min3:function(t,e,i){return t<=e&&t<=i?t:e<=t&&e<=i?e:i},pointIsInTriangle:function(t,e,i,s,r,n,o,a){var h=.5*(-n*o+s*(-r+o)+i*(n-a)+r*a),l=1/(2*h)*(s*o-i*a+(a-s)*t+(i-o)*e),u=1/(2*h)*(i*n-s*r+(s-n)*t+(r-i)*e);return l>0&&u>0&&1-l-u>0}},t})()},function(t,e){(function(){function t(t,e){this.center=t,this.axis=e}return t.prototype.toSVGString=function(t){t=t||{};var e=[];return e.push("<ellipse"),t.className&&e.push(' class="'+t.className+'"'),e.push(' cx="'+this.center.x+'"'),e.push(' cy="'+this.center.y+'"'),e.push(' rx="'+this.axis.x+'"'),e.push(' ry="'+this.axis.y+'"'),e.push(" />"),e.join("")},t})()},function(t,e){(function(){function t(t,e,i){this.image=t,this.upperLeft=e,this.lowerRight=i}return t.prototype.toSVGString=function(t){return console.warn("PBImage is not yet SVG serializable. Returning empty SVG string."),""},t})()},function(t,e){
var i=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e})(MouseEvent),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(WheelEvent),function(){function t(t){this.mouseDownPos=null,this.mouseDragPos=null,this.mousePos=null,this.mouseButton=-1,this.listeners={},this.installed={},this.handlers={},this.element=t,this.mouseDownPos=null,this.mouseDragPos=null,this.mousePos=null,this.mouseButton=-1,this.listeners={},this.installed={},this.handlers={};var e=this;this.handlers.mousemove=function(t){e.listeners.mousemove&&e.listeners.mousemove(e.mkParams(t,"mousemove")),e.mouseDragPos&&e.listeners.drag&&e.listeners.drag(e.mkParams(t,"drag")),e.mouseDownPos&&(e.mouseDragPos=e.relPos(t))},this.handlers.mouseup=function(t){e.listeners.mouseup&&e.listeners.mouseup(e.mkParams(t,"mouseup")),e.mouseDragPos=null,e.mouseDownPos=null,e.mouseButton=-1},this.handlers.mousedown=function(t){e.mouseDragPos=e.relPos(t),e.mouseDownPos=e.relPos(t),e.mouseButton=t.button,e.listeners.mousedown&&e.listeners.mousedown(e.mkParams(t,"mousedown"))},this.handlers.click=function(t){e.listeners.click&&e.listeners.click(e.mkParams(t,"mousedown"))},this.handlers.wheel=function(t){e.listeners.wheel&&e.listeners.wheel(e.mkParams(t,"wheel"))}}return t.prototype.relPos=function(t){return{x:t.offsetX,y:t.offsetY}},t.prototype.mkParams=function(t,e){var i=this.relPos(t),s=t;return s.params={element:this.element,name:e,pos:i,button:this.mouseButton,leftButton:0==this.mouseButton,middleButton:1==this.mouseButton,rightButton:2==this.mouseButton,mouseDownPos:this.mouseDownPos,draggedFrom:this.mouseDragPos,wasDragged:null!=this.mouseDownPos&&(this.mouseDownPos.x!=i.x||this.mouseDownPos.y!=i.y),dragAmount:null!=this.mouseDownPos?{x:i.x-this.mouseDragPos.x,y:i.y-this.mouseDragPos.y}:{x:0,y:0}},s},t.prototype.listenFor=function(t){this.installed[t]||(this.element.addEventListener(t,this.handlers[t]),this.installed[t]=!0)},t.prototype.unlistenFor=function(t){this.installed[t]&&(this.element.removeEventListener(t,this.handlers[t]),delete this.installed[t])},t.prototype.drag=function(t){return this.listeners.drag&&this.throwAlreadyInstalled("drag"),this.listeners.drag=t,this.listenFor("mousedown"),this.listenFor("mousemove"),this.listenFor("mouseup"),this},t.prototype.move=function(t){return this.listeners.mousemove&&this.throwAlreadyInstalled("mousemove"),this.listenFor("mousemove"),this.listeners.mousemove=t,this},t.prototype.up=function(t){return this.listeners.mouseup&&this.throwAlreadyInstalled("mouseup"),this.listenFor("mouseup"),this.listeners.mouseup=t,this},t.prototype.down=function(t){return this.listeners.mousedown&&this.throwAlreadyInstalled("mousedown"),this.listenFor("mousedown"),this.listeners.mousedown=t,this},t.prototype.click=function(t){return this.listeners.click&&this.throwAlreadyInstalled("click"),this.listenFor("click"),this.listeners.click=t,this},t.prototype.wheel=function(t){return this.listeners.wheel&&this.throwAlreadyInstalled("wheel"),this.listenFor("wheel"),this.listeners.wheel=t,this},t.prototype.throwAlreadyInstalled=function(t){throw"This MouseHandler already has a '"+t+"' callback. To keep the code simple there is only room for one."},t.prototype.destroy=function(){this.unlistenFor("mousedown"),this.unlistenFor("mousemove"),this.unlistenFor("moseup"),this.unlistenFor("click"),this.unlistenFor("wheel")},t}()},function(t,e){(function(){function t(t){this.downListeners=[],this.pressListeners=[],this.upListeners=[],this.keyStates={},t=t||{},this.element=t.element?t.element:window,this.downListeners=[],this.pressListeners=[],this.upListeners=[],this.keyStates=[],this.trackAllKeys=t.trackAll||!1,this.installListeners()}return t.prototype.fireEvent=function(t,e){var i=!1;for(var s in e){var r=e[s];r.keyCode==t.keyCode&&(r.listener(t),i=!0)}return i},t.prototype.fireDownEvent=function(t,e){(e.fireEvent(t,e.downListeners)||e.trackAllKeys)&&(e.keyStates[t.keyCode]="down")},t.prototype.firePressEvent=function(t,e){e.fireEvent(t,e.pressListeners)},t.prototype.fireUpEvent=function(t,e){(e.fireEvent(t,e.upListeners)||e.trackAllKeys)&&delete e.keyStates[t.keyCode]},t.key2code=function(e){if("number"==typeof e)return e;if("string"!=typeof e)throw"Unknown key name or key type (should be a string or integer): "+e;if(t.KEY_CODES[e])return t.KEY_CODES[e];throw"Unknown key (cannot resolve key code): "+e},t.prototype.installListeners=function(){var t=this;this.element.addEventListener("keydown",this._keyDownListener=function(e){t.fireDownEvent(e,t)}),this.element.addEventListener("keypress",this._keyPressListener=function(e){t.firePressEvent(e,t)}),this.element.addEventListener("keyup",this._keyUpListener=function(e){t.fireUpEvent(e,t)})},t.prototype.releaseListeners=function(){this.element.removeEventListener("keydown",this._keyDownListener),this.element.removeEventListener("keypress",this._keyPressListener),this.element.removeEventListener("keyup",this._keyUpListener)},t.prototype.down=function(e,i){return this.downListeners.push({key:e,keyCode:t.key2code(e),listener:i}),this},t.prototype.press=function(e,i){return this.pressListeners.push({key:e,keyCode:t.key2code(e),listener:i}),this},t.prototype.up=function(e,i){return this.upListeners.push({key:e,keyCode:t.key2code(e),listener:i}),this},t.prototype.isDown=function(e){return"number"==typeof e?!!this.keyStates[e]:!!this.keyStates[t.key2code(e)]},t.KEY_CODES={break:3,backspace:8,delete:8,tab:9,clear:12,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,hangul:21,hanja:25,escape:27,conversion:28,"non-conversion":29,spacebar:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,select:41,print:42,execute:43,printscreen:44,insert:45,help:47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,"semicolon (firefox)":59,equals:59,"<":60,"equals (firefox)":61,"ß":63,"@ (firefox)":64,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,windows:91,leftcommand:91,chromebooksearch:91,rightwindowkey:92,windowsmenu:93,rightcommant:93,sleep:95,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,numpadperiod:108,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126,f16:127,f17:128,f18:129,f19:130,f20:131,f21:132,f22:133,f23:134,f24:135,numlock:144,scrolllock:145,"^":160,"!":161,"#":163,$:164,"ù":165,pagebackward:166,pageforward:167,refresh:168,closingparen:169,"*":170,"~+*":171,minus:173,decreasevolumelevel:174,increasevolumelevel:175,next:176,previous:177,stop:178,"play/pause":179,email:180,mute:181,unmute:181,semicolon:186,"ñ":186,equal:187,comma:188,dash:189,period:190,forwardslash:191,"ç":191,"grave accent":192,"æ":192,"ö":192,"?":193,"/":193,"°":193,openbracket:219,backslash:220,closebracket:221,"å":221,singlequote:222,"ø":222,"ä":222,"`":223,altgr:225,"GNOME Compose Key":230,XF86Forward:233,XF86Back:234,alphanumeric:240,hiragana:242,katakana:242,"half-width":243,"full-width":243,kanji:244,unlocktrackpad:251,toggletouchpad:255},t})()},function(t,e){(function(){function t(t,e){this.ctx=t,this.offset=new Vertex(0,0),this.scale=new Vertex(1,1),this.fillShapes=e}return t.prototype.beginDrawCycle=function(){},t.prototype.line=function(t,e,i,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.strokeStyle=i,this.ctx.lineWidth=s||1,this.ctx.stroke(),this.ctx.restore()},t.prototype.arrow=function(t,e,i){var s=8;this.ctx.save(),this.ctx.beginPath();var r=Vertex.utils.buildArrowHead(t,e,s,this.scale.x,this.scale.y);this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y);for(var n=0;n<r.length;n++)this.ctx.lineTo(this.offset.x+r[n].x,this.offset.y+r[n].y);this.ctx.lineTo(this.offset.x+r[0].x,this.offset.y+r[0].y),this.ctx.lineWidth=1,this._fillOrDraw(i),this.ctx.restore()},t.prototype.image=function(t,e,i){this.ctx.save(),this.ctx.drawImage(t,0,0,t.naturalWidth-1,t.naturalHeight-1,this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,i.x*this.scale.x,i.y*this.scale.y),this.ctx.restore()},t.prototype._fillOrDraw=function(t){this.fillShapes?(this.ctx.fillStyle=t,this.ctx.fill()):(this.ctx.strokeStyle=t,this.ctx.stroke())},t.prototype.cubicBezier=function(t,e,i,s,r,n){return t instanceof CubicBezierCurve?void this.cubicBezier(t.startPoint,t.endPoint,t.startControlPoint,t.endControlPoint,r,n):(this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.bezierCurveTo(this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y,this.offset.x+s.x*this.scale.x,this.offset.y+s.y*this.scale.y,this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.lineWidth=n||2,this._fillOrDraw(r),void this.ctx.restore())},t.prototype.quadraticBezier=function(t,e,i,s,r){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.quadraticCurveTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y),this.ctx.lineWidth=r||2,this._fillOrDraw(s),this.ctx.restore()},t.prototype.cubicBezierPath=function(t,e){if(t&&0!=t.length){this.ctx.save(),this.ctx.beginPath();var i,s,r;this.ctx.moveTo(this.offset.x+t[0].x*this.scale.x,this.offset.y+t[0].y*this.scale.y);for(var n=1;n<t.length;n+=3)s=t[n],r=t[n+1],i=t[n+2],this.ctx.bezierCurveTo(this.offset.x+s.x*this.scale.x,this.offset.y+s.y*this.scale.y,this.offset.x+r.x*this.scale.x,this.offset.y+r.y*this.scale.y,this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y);this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(e),this.ctx.restore()}},t.prototype.handle=function(t,e){this.point(t,"rgb(0,32,192)"),this.square(e,5,"rgba(0,128,192,0.5)")},t.prototype.handleLine=function(t,e){this.line(t,e,"rgb(192,192,192)")},t.prototype.dot=function(t,e){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(Math.round(this.offset.x+this.scale.x*t.x),Math.round(this.offset.y+this.scale.y*t.y)),this.ctx.lineTo(Math.round(this.offset.x+this.scale.x*t.x+1),Math.round(this.offset.y+this.scale.y*t.y+1)),this.ctx.closePath(),this._fillOrDraw(e),this.ctx.restore()},t.prototype.point=function(t,e){var i=3;this.ctx.beginPath(),this.ctx.arc(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,i,0,2*Math.PI,!1),this.ctx.closePath(),this._fillOrDraw(e)},t.prototype.circle=function(t,e,i){this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e*this.scale.x,e*this.scale.y,0,0,2*Math.PI),this.ctx.closePath(),this._fillOrDraw(i)},t.prototype.ellipse=function(t,e,i,s,r){this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e*this.scale.x,i*this.scale.y,0,0,2*Math.PI),this.ctx.closePath(),this.ctx.lineWidth=r||1,this._fillOrDraw(s)},t.prototype.square=function(t,e,i){this.ctx.beginPath(),this.ctx.rect(this.offset.x+(t.x-e/2)*this.scale.x,this.offset.y+(t.y-e/2)*this.scale.y,e*this.scale.x,e*this.scale.y),this.ctx.closePath(),this._fillOrDraw(i)},t.prototype.grid=function(t,e,i,s,r,n){this.ctx.beginPath();for(var o=0;o<e/2;)this.ctx.moveTo(this.offset.x+(t.x+o)*this.scale.x,this.offset.y-(t.y-.5*i)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+o)*this.scale.x,this.offset.y-(t.y+.5*i)*this.scale.y),o+=s;for(o=s;o<e/2;)this.ctx.moveTo(this.offset.x+(t.x-o)*this.scale.x,this.offset.y-(t.y-.5*i)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x-o)*this.scale.x,this.offset.y-(t.y+.5*i)*this.scale.y),o+=s;for(var a=0;a<i/2;)this.ctx.moveTo(this.offset.x-(t.x-.5*e)*this.scale.x,this.offset.y+(t.y+a)*this.scale.y),this.ctx.lineTo(this.offset.x-(t.x+.5*e)*this.scale.x,this.offset.y+(t.y+a)*this.scale.y),a+=r;for(var a=r;a<i/2;)this.ctx.moveTo(this.offset.x-(t.x-.5*e)*this.scale.x,this.offset.y+(t.y-a)*this.scale.y),this.ctx.lineTo(this.offset.x-(t.x+.5*e)*this.scale.x,this.offset.y+(t.y-a)*this.scale.y),a+=r;this.ctx.closePath(),this._fillOrDraw(n)},t.prototype.raster=function(t,e,i,s,r,n){this.ctx.save(),this.ctx.beginPath();for(var o=0,a=0,h=-Math.ceil(.5*e/s)*s;h<e/2;h+=s){o++;for(var l=-Math.ceil(.5*i/r)*r;l<i/2;l+=r)1==o&&a++,this.ctx.moveTo(this.offset.x+(t.x+h)*this.scale.x-4,this.offset.y+(t.y+l)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+h)*this.scale.x+4,this.offset.y+(t.y+l)*this.scale.y),this.ctx.moveTo(this.offset.x+(t.x+h)*this.scale.x,this.offset.y+(t.y+l)*this.scale.y-4),this.ctx.lineTo(this.offset.x+(t.x+h)*this.scale.x,this.offset.y+(t.y+l)*this.scale.y+4)}this.ctx.strokeStyle=n,this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()},t.prototype.diamondHandle=function(t,e,i){this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e/2,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y-e/2),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e/2,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y+e/2),this.ctx.closePath(),this._fillOrDraw(i)},t.prototype.squareHandle=function(t,e,i){this.ctx.beginPath(),this.ctx.rect(this.offset.x+t.x*this.scale.x-e/2,this.offset.y+t.y*this.scale.y-e/2,e,e),this.ctx.closePath(),this._fillOrDraw(i)},t.prototype.circleHandle=function(t,e,i){var s=3;this.ctx.beginPath(),this.ctx.arc(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,s,0,2*Math.PI,!1),this.ctx.closePath(),this._fillOrDraw(i)},t.prototype.crosshair=function(t,e,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e,this.offset.y+t.y*this.scale.y),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y-e),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y+e),this.ctx.strokeStyle=i,this.ctx.lineWidth=.5,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()},t.prototype.polygon=function(t,e,i){this.polyline(t.vertices,t.isOpen,e,i)},t.prototype.polyline=function(t,e,i,s){if(!(t.length<=1)){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=s||1,this.ctx.moveTo(this.offset.x+t[0].x*this.scale.x,this.offset.y+t[0].y*this.scale.y);for(var r=0;r<t.length;r++)this.ctx.lineTo(this.offset.x+t[r].x*this.scale.x,this.offset.y+t[r].y*this.scale.y);!e&&t.length>2&&this.ctx.closePath(),this._fillOrDraw(i),this.ctx.setLineDash([]),this.ctx.restore()}},t.prototype.label=function(t,e,i,s,r){this.ctx.save(),this.ctx.translate(e,i),"undefined"!=typeof s&&this.ctx.rotate(s),this.ctx.fillStyle=r||"black",this.fillShapes?this.ctx.fillText(t,0,0):this.ctx.strokeText(t,0,0),this.ctx.restore()},t.prototype.clear=function(t){this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},t})()},function(t,e){var i=function(){function t(t,e){this.item=t,this.typeName=e}return t.prototype.isVertex=function(){return this.typeName==t.VERTEX},t.prototype.setVIndex=function(t){return this.vindex=t,this},t.VERTEX="vertex",t}();(function(){function t(e){if(VertexAttr.model={bezierAutoAdjust:!1,renderTime:0,selectable:!0,isSelected:!1,draggable:!0},"undefined"==typeof e.canvas)throw"No canvas specified.";this.config={canvas:e.canvas,fullSize:t.utils.fetch.val(e,"fullSize",!0),fitToParent:t.utils.fetch.bool(e,"fitToParent",!0),scaleX:t.utils.fetch.num(e,"scaleX",1),scaleY:t.utils.fetch.num(e,"scaleY",1),offsetX:t.utils.fetch.num(e,"offsetX",0),offsetY:t.utils.fetch.num(e,"offsetY",0),rasterGrid:t.utils.fetch.bool(e,"rasterGrid",!0),rasterAdjustFactor:t.utils.fetch.num(e,"rasterAdjustdFactror",2),drawOrigin:t.utils.fetch.bool(e,"drawOrigin",!1),autoAdjustOffset:t.utils.fetch.val(e,"autoAdjustOffset",!0),offsetAdjustXPercent:t.utils.fetch.num(e,"offsetAdjustXPercent",50),offsetAdjustYPercent:t.utils.fetch.num(e,"offsetAdjustYPercent",50),backgroundColor:e.backgroundColor||"#ffffff",redrawOnResize:t.utils.fetch.bool(e,"redrawOnResize",!0),defaultCanvasWidth:t.utils.fetch.num(e,"defaultCanvasWidth",t.DEFAULT_CANVAS_WIDTH),defaultCanvasHeight:t.utils.fetch.num(e,"defaultCanvasHeight",t.DEFAULT_CANVAS_HEIGHT),canvasWidthFactor:t.utils.fetch.num(e,"canvasWidthFactor",1),canvasHeightFactor:t.utils.fetch.num(e,"canvasHeightFactor",1),cssScaleX:t.utils.fetch.num(e,"cssScaleX",1),cssScaleY:t.utils.fetch.num(e,"cssScaleY",1),cssUniformScale:t.utils.fetch.bool(e,"cssUniformScale",!0),saveFile:function(){i.saveFile()},setToRetina:function(){i._setToRetina()},enableSVGExport:t.utils.fetch.bool(e,"enableSVGExport",!0),preClear:t.utils.fetch.func(e,"preClear",null),preDraw:t.utils.fetch.func(e,"preDraw",null),postDraw:t.utils.fetch.func(e,"postDraw",null),enableMouse:t.utils.fetch.bool(e,"enableMouse",!0),enableTouch:t.utils.fetch.bool(e,"enableTouch",!0),enableKeys:t.utils.fetch.bool(e,"enableKeys",!0),enableMouseWheel:t.utils.fetch.bool(e,"enableMouseWheel",!0),enableGL:t.utils.fetch.bool(e,"enableGL",!1)},this.drawConfig={drawVertices:!0,drawBezierHandleLines:t.utils.fetch.bool(e,"drawBezierHandleLines",!0),drawBezierHandlePoints:t.utils.fetch.bool(e,"drawBezierHandlePoints",!0),drawHandleLines:t.utils.fetch.bool(e,"drawHandleLines",!0),drawHandlePoints:t.utils.fetch.bool(e,"drawHandlePoints",!0),drawGrid:t.utils.fetch.bool(e,"drawGrid",!0),bezier:{color:"#00a822",lineWidth:2,handleLine:{color:"rgba(180,180,180,0.5)",lineWidth:1}},polygon:{color:"#0022a8",lineWidth:1},triangle:{color:"#6600ff",lineWidth:1},ellipse:{color:"#2222a8",lineWidth:1},vertex:{color:"#a8a8a8",lineWidth:1},line:{color:"#a844a8",lineWidth:1},vector:{color:"#ff44a8",lineWidth:1},image:{color:"#a8a8a8",lineWidth:1}},this.canvas="string"==typeof e.canvas?document.getElementById(e.canvas):e.canvas,this.config.enableGL?(this.ctx=this.canvas.getContext("webgl"),this.draw=new drawutilsgl(this.ctx,!1),this.fill=this.draw.copyInstance(!0),console.warn("Initialized with experimental mode enableGL=true. Note that this is not yet fully implemented.")):(this.ctx=this.canvas.getContext("2d"),this.draw=new drawutils(this.ctx,!1),this.fill=new drawutils(this.ctx,!0)),this.draw.scale.set(this.config.scaleX,this.config.scaleY),this.fill.scale.set(this.config.scaleX,this.config.scaleY),this.grid=new Grid(new Vertex(0,0),new Vertex(50,50)),this.canvasSize={width:t.DEFAULT_CANVAS_WIDTH,height:t.DEFAULT_CANVAS_HEIGHT},this.vertices=[],this.selectPolygon=null,this.draggedElements=[],this.drawables=[],this.console=console,this.hooks={saveFile:this._saveFile};var i=this;window&&window.addEventListener("resize",this.resizeCanvas),this.resizeCanvas(),this.installInputListeners(),this.updateCSSscale(),this.redraw(),this.canvas.focus()}return t.prototype._saveFile=function(){var t=this;(new SVGBuilder).build(t.drawables,{canvasSize:t.canvasSize,offset:t.draw.offset,zoom:t.draw.scale});console.warn("Sorry, the typescript version does not yet saveFile again. Coming back soon.")},t.prototype._setToRetina=function(){this.config.cssScaleX=this.config.cssScaleY=.5,this.config.canvasWidthFactor=this.config.canvasHeightFactor=2,this.config.fitToParent=!1,this.resizeCanvas()},t.prototype.setConsole=function(t){if("function"!=typeof t.log)throw"Console object must have a 'log' function.";if("function"!=typeof t.warn)throw"Console object must have a 'warn' function.";if("function"!=typeof t.error)throw"Console object must have a 'error' function.";this.console=t},t.prototype.updateCSSscale=function(){this.config.cssUniformScale?t.utils.setCSSscale(this.canvas,this.config.cssScaleX,this.config.cssScaleX):t.utils.setCSSscale(this.canvas,this.config.cssScaleX,this.config.cssScaleY)},t.prototype.add=function(t,e){if(Array.isArray(t))for(var i=t,s=0;s<i.length;s++)this.add(i[s]);else if(t instanceof Vertex)this.drawables.push(t),this.vertices.push(t);else if(t instanceof Line)this.drawables.push(t),this.vertices.push(t.a),this.vertices.push(t.b);else if(t instanceof Vector)this.drawables.push(t),this.vertices.push(t.a),this.vertices.push(t.b);else if(t instanceof VEllipse)this.vertices.push(t.center),this.vertices.push(t.axis),this.drawables.push(t),t.center.listeners.addDragListener(function(e){t.axis.add(e.params.dragAmount)});else if(t instanceof Polygon){this.drawables.push(t);for(var s=0;s<t.vertices.length;s++)this.vertices.push(t.vertices[s])}else if(t instanceof Triangle)this.drawables.push(t),this.vertices.push(t.a),this.vertices.push(t.b),this.vertices.push(t.c);else if(t instanceof BezierPath){this.drawables.push(t);for(var r=t,s=0;s<r.bezierCurves.length;s++)t.adjustCircular||0!=s||this.vertices.push(r.bezierCurves[s].startPoint),this.vertices.push(r.bezierCurves[s].endPoint),this.vertices.push(r.bezierCurves[s].startControlPoint),this.vertices.push(r.bezierCurves[s].endControlPoint),r.bezierCurves[s].startControlPoint.attr.selectable=!1,r.bezierCurves[s].endControlPoint.attr.selectable=!1;for(var s=0;s<r.bezierCurves.length;s++)r.bezierCurves[s].startPoint.listeners.addDragListener(function(e){var i=t.locateCurveByStartPoint(e.params.vertex);t.bezierCurves[i].startPoint.addXY(-e.params.dragAmount.x,-e.params.dragAmount.y),t.moveCurvePoint(1*i,t.START_POINT,new Vertex(e.params.dragAmount)),t.updateArcLengths()}),r.bezierCurves[s].startControlPoint.listeners.addDragListener(function(e){var i=t.locateCurveByStartControlPoint(e.params.vertex);t.bezierCurves[i].startPoint.attr.bezierAutoAdjust&&(t.adjustPredecessorControlPoint(1*i,!0,!1),t.updateArcLengths())}),r.bezierCurves[s].endControlPoint.listeners.addDragListener(function(e){var i=t.locateCurveByEndControlPoint(e.params.vertex);t.bezierCurves[i%t.bezierCurves.length].endPoint.attr.bezierAutoAdjust&&(t.adjustSuccessorControlPoint(1*i,!0,!1),t.updateArcLengths())}),s+1>r.bezierCurves.length&&t.bezierCurves[t.bezierCurves.length-1].endPoint.listeners.addDragListener(function(e){if(!t.adjustCircular){var i=t.locateCurveByEndPoint(e.params.vertex);t.moveCurvePoint(1*i,t.END_CONTROL_POINT,new Vertex({x:e.params.dragAmount.x/2,y:e.params.dragAmount.y/2}))}t.updateArcLengths()})}else{if(!(t instanceof PBImage))throw"Cannot add drawable of unrecognized type.";this.vertices.push(t.upperLeft),this.vertices.push(t.lowerRight),this.drawables.push(t),t.upperLeft.listeners.addDragListener(function(e){t.lowerRight.add(e.params.dragAmount)}),t.lowerRight.attr.selectable=!1}(e||"undefined"==typeof e)&&this.redraw()},t.prototype.remove=function(t,e){t instanceof Vertex&&this.removeVertex(t,!1);for(var i=0;i<this.drawables.length;i++)if(this.drawables[i]===t)return this.drawables.splice(i,1),void(e&&this.redraw())},t.prototype.removeVertex=function(t,e){for(var i=0;i<this.vertices.length;i++)if(this.vertices[i]===t)return this.vertices.splice(i,1),void(e&&this.redraw())},t.prototype.drawGrid=function(){var t={x:Grid.utils.mapRasterScale(this.config.rasterAdjustFactor,this.draw.scale.x),y:Grid.utils.mapRasterScale(this.config.rasterAdjustFactor,this.draw.scale.y)},e={width:this.grid.size.x*t.x,height:this.grid.size.y*t.y},i={width:this.canvasSize.width/2,height:this.canvasSize.height/2},s=this.draw.offset.clone().inv();s.x=Math.round(s.x+i.width)/Math.round(e.width)*e.width/this.draw.scale.x+(this.draw.offset.x-i.width)/this.draw.scale.x%e.width,s.y=Math.round(s.y+i.height)/Math.round(e.height)*e.height/this.draw.scale.y+(this.draw.offset.y-i.height)/this.draw.scale.x%e.height,this.drawConfig.drawGrid&&(this.config.rasterGrid?this.draw.raster(s,this.canvasSize.width/this.draw.scale.x,this.canvasSize.height/this.draw.scale.y,e.width,e.height,"rgba(0,128,255,0.125)"):this.draw.grid(s,this.canvasSize.width/this.draw.scale.x,this.canvasSize.height/this.draw.scale.y,e.width,e.height,"rgba(0,128,255,0.095)"))},t.prototype.drawOrigin=function(){this.draw.crosshair({x:0,y:0},10,"#000000")},t.prototype._handleColor=function(t,e){return t.attr.draggable?e:"rgba(128,128,128,0.5)"},t.prototype.drawDrawables=function(t){for(var e in this.drawables){var i=this.drawables[e];if(i instanceof BezierPath)for(var s in i.bezierCurves)this.draw.cubicBezier(i.bezierCurves[s].startPoint,i.bezierCurves[s].endPoint,i.bezierCurves[s].startControlPoint,i.bezierCurves[s].endControlPoint,this.drawConfig.bezier.color,this.drawConfig.bezier.lineWidth),this.drawConfig.drawBezierHandlePoints&&this.drawConfig.drawHandlePoints?(i.bezierCurves[s].startPoint.attr.bezierAutoAdjust||(this.draw.diamondHandle(i.bezierCurves[s].startPoint,7,this._handleColor(i.bezierCurves[s].startPoint,"orange")),i.bezierCurves[s].startPoint.attr.renderTime=t),i.bezierCurves[s].endPoint.attr.bezierAutoAdjust||(this.draw.diamondHandle(i.bezierCurves[s].endPoint,7,this._handleColor(i.bezierCurves[s].endPoint,"orange")),i.bezierCurves[s].endPoint.attr.renderTime=t),this.draw.circleHandle(i.bezierCurves[s].startControlPoint,7,this._handleColor(i.bezierCurves[s].startControlPoint,"#008888")),this.draw.circleHandle(i.bezierCurves[s].endControlPoint,7,this._handleColor(i.bezierCurves[s].endControlPoint,"#008888")),i.bezierCurves[s].startControlPoint.attr.renderTime=t,i.bezierCurves[s].endControlPoint.attr.renderTime=t):(i.bezierCurves[s].startPoint.attr.renderTime=t,i.bezierCurves[s].endPoint.attr.renderTime=t,i.bezierCurves[s].startControlPoint.attr.renderTime=t,i.bezierCurves[s].endControlPoint.attr.renderTime=t),this.drawConfig.drawBezierHandleLines&&this.drawConfig.drawHandleLines&&(this.draw.line(i.bezierCurves[s].startPoint,i.bezierCurves[s].startControlPoint,this.drawConfig.bezier.handleLine.color,this.drawConfig.bezier.handleLine.lineWidth),this.draw.line(i.bezierCurves[s].endPoint,i.bezierCurves[s].endControlPoint,this.drawConfig.bezier.handleLine.color,this.drawConfig.bezier.handleLine.lineWidth));else if(i instanceof Polygon){if(this.draw.polygon(i,this.drawConfig.polygon.color,this.drawConfig.polygon.lineWidth),!this.drawConfig.drawHandlePoints)for(var e in i.vertices)i.vertices[e].attr.renderTime=t}else i instanceof Triangle?(this.draw.polyline([i.a,i.b,i.c],!1,this.drawConfig.triangle.color,this.drawConfig.triangle.lineWidth),this.drawConfig.drawHandlePoints||(i.a.attr.renderTime=i.b.attr.renderTime=i.c.attr.renderTime=t)):i instanceof VEllipse?(this.drawConfig.drawHandleLines&&(this.draw.line(i.center.clone().add(0,i.axis.y-i.center.y),i.axis,"#c8c8c8"),this.draw.line(i.center.clone().add(i.axis.x-i.center.x,0),i.axis,"#c8c8c8")),this.draw.ellipse(i.center,Math.abs(i.axis.x-i.center.x),Math.abs(i.axis.y-i.center.y),this.drawConfig.ellipse.color,this.drawConfig.ellipse.lineWidth),this.drawConfig.drawHandlePoints||(i.center.attr.renderTime=t,i.axis.attr.renderTime=t)):i instanceof Vertex?!this.drawConfig.drawVertices||i.attr.selectable&&i.attr.draggable||(this.draw.circleHandle(i,7,this.drawConfig.vertex.color),i.attr.renderTime=t):i instanceof Line?(this.draw.line(i.a,i.b,this.drawConfig.line.color,this.drawConfig.line.lineWidth),this.drawConfig.drawHandlePoints&&i.a.attr.selectable||(i.a.attr.renderTime=t),this.drawConfig.drawHandlePoints&&i.b.attr.selectable||(i.b.attr.renderTime=t)):i instanceof Vector?(this.draw.arrow(i.a,i.b,this.drawConfig.vector.color),this.drawConfig.drawHandlePoints&&i.b.attr.selectable?this.draw.circleHandle(i.b,7,"#a8a8a8"):i.b.attr.renderTime=t,this.drawConfig.drawHandlePoints&&i.a.attr.selectable||(i.a.attr.renderTime=t),this.drawConfig.drawHandlePoints&&i.b.attr.selectable||(i.b.attr.renderTime=t)):i instanceof PBImage?(this.drawConfig.drawHandleLines&&this.draw.line(i.upperLeft,i.lowerRight,this.drawConfig.image.color,this.drawConfig.image.lineWidth),this.fill.image(i.image,i.upperLeft,i.lowerRight.clone().sub(i.upperLeft)),this.drawConfig.drawHandlePoints&&(this.draw.circleHandle(i.lowerRight,7,this.drawConfig.image.color),i.lowerRight.attr.renderTime=t)):this.console.error("Cannot draw object. Unknown class.")}},t.prototype.drawSelectPolygon=function(){null!=this.selectPolygon&&this.selectPolygon.vertices.length>0&&(this.draw.polygon(this.selectPolygon,"#888888"),this.draw.crosshair(this.selectPolygon.vertices[0],3,"#008888"))},t.prototype.drawVertices=function(t){for(var e in this.vertices)this.drawConfig.drawVertices&&this.vertices[e].attr.renderTime!=t&&this.draw.squareHandle(this.vertices[e],5,this.vertices[e].attr.isSelected?"rgba(192,128,0)":this._handleColor(this.vertices[e],"rgb(0,128,192)"))},t.prototype.redraw=function(){var t=(new Date).getTime();this.config.preClear&&this.config.preClear(),this.clear(),this.config.preDraw&&this.config.preDraw(),this.draw.beginDrawCycle(),this.fill.beginDrawCycle(),this.drawGrid(),this.config.drawOrigin&&this.drawOrigin(),this.drawDrawables(t),this.drawVertices(t),this.drawSelectPolygon(),this.config.postDraw&&this.config.postDraw()},t.prototype.clear=function(){this.draw.clear(this.config.backgroundColor)},t.prototype.clearSelection=function(t){for(var e in this.vertices)this.vertices[e].attr.isSelected=!1;return t&&this.redraw(),this},t.prototype.viewport=function(){return{min:this.transformMousePosition(0,0),max:this.transformMousePosition(this.canvasSize.width*this.config.cssScaleX,this.canvasSize.height*this.config.cssScaleY)}},t.prototype.saveFile=function(){this.hooks.saveFile()},t.prototype.getAvailableContainerSpace=function(){var t=this,e=t.canvas.parentNode,i=t.canvas;i.style.display="none";var s=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding"))||0,r=parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-width"))||0,n=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-left"))||s,o=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-right"))||s,a=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-top"))||s,h=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-bottom"))||s,l=parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-left-width"))||r,u=parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-right-width"))||r,c=parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-top-width"))||r,f=parseFloat(window.getComputedStyle(i,null).getPropertyValue("border-bottom-width"))||r,d=e.clientWidth,p=e.clientHeight;return i.style.display="block",{width:d-n-o-l-u,height:p-a-h-c-f}},t.prototype.resizeCanvas=function(){var t=this,e=function(e,i){e*=t.config.canvasWidthFactor,i*=t.config.canvasHeightFactor,t.canvas.width=e,t.canvas.height=i,t.canvasSize.width=e,t.canvasSize.height=i,t.config.autoAdjustOffset&&(t.draw.offset.x=t.fill.offset.x=t.config.offsetX=e*(t.config.offsetAdjustXPercent/100),t.draw.offset.y=t.fill.offset.y=t.config.offsetY=i*(t.config.offsetAdjustYPercent/100))};if(t.config.fullSize&&!t.config.fitToParent){var i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;t.canvas.style.position="absolute",t.canvas.style.width=i+"px",t.canvas.style.height=s+"px",t.canvas.style.top="0px",t.canvas.style.left="0px",e(i,s)}else if(t.config.fitToParent){t.canvas.style.position="absolute";var r=this.getAvailableContainerSpace();t.canvas.style.width=t.config.canvasWidthFactor*r.width+"px",t.canvas.style.height=t.config.canvasHeightFactor*r.height+"px",t.canvas.style.top=null,t.canvas.style.left=null,e(r.width,r.height)}else t.canvas.style.width=null,t.canvas.style.height=null,e(t.config.defaultCanvasWidth,t.config.defaultCanvasHeight);
t.config.redrawOnResize&&t.redraw()},t.prototype.selectVerticesInPolygon=function(t){for(var e in this.vertices)t.containsVert(this.vertices[e])&&(this.vertices[e].attr.isSelected=!0)},t.prototype.locatePointNear=function(t,e){var s=this;"undefined"==typeof e&&(e=7),e/=s.draw.scale.x;for(var r=0;r<s.vertices.length;r++){var n=s.vertices[r];if((n.attr.draggable||n.attr.selectable)&&n.distance(t)<e)return new i(n,i.VERTEX).setVIndex(r)}return null},t.prototype.handleClick=function(e,i){var s=this,r=this.locatePointNear(s.transformMousePosition(e,i),t.DEFAULT_CLICK_TOLERANCE/Math.min(s.config.cssScaleX,s.config.cssScaleY));if(r)if(this.keyHandler&&this.keyHandler.isDown("shift")){if("bpath"==r.typeName){var n=s.paths[r.pindex].bezierCurves[r.cindex].getPointByID(r.pid);n.attr.selectable&&(n.attr.isSelected=!n.attr.isSelected)}else if("vertex"==r.typeName){var n=s.vertices[r.vindex];n.attr.selectable&&(n.attr.isSelected=!n.attr.isSelected)}s.redraw()}else this.keyHandler.isDown("y")&&(s.vertices[r.vindex].attr.bezierAutoAdjust=!s.vertices[r.vindex].attr.bezierAutoAdjust,s.redraw());else if(null!=s.selectPolygon){var n=s.transformMousePosition(e,i);s.selectPolygon.vertices.push(new Vertex(n.x,n.y)),s.redraw()}},t.prototype.transformMousePosition=function(t,e){return{x:(t/this.config.cssScaleX-this.config.offsetX)/this.config.scaleX,y:(e/this.config.cssScaleY-this.config.offsetY)/this.config.scaleY}},t.prototype.mouseDownHandler=function(e){var s=this;if(1==e.which){var r=s.locatePointNear(s.transformMousePosition(e.params.pos.x,e.params.pos.y),t.DEFAULT_CLICK_TOLERANCE/Math.min(s.config.cssScaleX,s.config.cssScaleY));if(r){if("vertex"==r.typeName&&s.vertices[r.vindex].attr.isSelected)for(var n=0;n<s.vertices.length;n++)s.vertices[n].attr.isSelected&&(s.draggedElements.push(new i(s.vertices[n],i.VERTEX).setVIndex(n)),s.vertices[n].listeners.fireDragStartEvent(e));else{if(!s.vertices[r.vindex].attr.draggable)return;s.draggedElements.push(r),"bpath"==r.typeName?s.paths[r.pindex].bezierCurves[r.cindex].getPointByID(r.pid).listeners.fireDragStartEvent(e):"vertex"==r.typeName&&s.vertices[r.vindex].listeners.fireDragStartEvent(e)}s.redraw()}}},t.prototype.mouseDragHandler=function(t){var e=this,i={x:t.params.dragAmount.x,y:t.params.dragAmount.y};if(t.params.dragAmount.x/=e.config.cssScaleX,t.params.dragAmount.y/=e.config.cssScaleY,this.keyHandler.isDown("alt")||this.keyHandler.isDown("ctrl")||this.keyHandler.isDown("spacebar"))e.draw.offset.add(t.params.dragAmount),e.fill.offset.set(e.draw.offset),e.config.offsetX=e.draw.offset.x,e.config.offsetY=e.draw.offset.y,e.redraw();else{t.params.dragAmount.x/=e.draw.scale.x,t.params.dragAmount.y/=e.draw.scale.y;for(var s in e.draggedElements){var r=e.draggedElements[s];if("bpath"==r.typeName)e.paths[r.pindex].moveCurvePoint(r.cindex,r.pid,new Vertex(t.params.dragAmount.x,t.params.dragAmount.y)),e.paths[r.pindex].bezierCurves[r.cindex].getPointByID(r.pid).listeners.fireDragEvent(t);else if("vertex"==r.typeName){if(!e.vertices[r.vindex].attr.draggable)continue;e.vertices[r.vindex].add(t.params.dragAmount),e.vertices[r.vindex].listeners.fireDragEvent(t)}}}t.params.dragAmount.x=i.x,t.params.dragAmount.y=i.y,e.redraw()},t.prototype.mouseUpHandler=function(t){var e=this;if(1==t.which){t.params.wasDragged||e.handleClick(t.params.pos.x,t.params.pos.y);for(var i in e.draggedElements){var s=e.draggedElements[i];"bpath"==s.typeName?e.paths[s.pindex].bezierCurves[s.cindex].getPointByID(s.pid).listeners.fireDragEndEvent(t):"vertex"==s.typeName&&e.vertices[s.vindex].listeners.fireDragEndEvent(t)}e.draggedElements=[],e.redraw()}},t.prototype.mouseWheelHandler=function(t){var e=1.25,i=this,s=t,r=i.transformMousePosition(t.params.pos.x,t.params.pos.y);s.deltaY<0?(i.draw.scale.x=i.fill.scale.x=i.config.scaleX=i.config.scaleX*e,i.draw.scale.y=i.fill.scale.y=i.config.scaleY=i.config.scaleY*e):s.deltaY>0&&(i.draw.scale.x=i.fill.scale.x=i.config.scaleX=Math.max(i.config.scaleX/e,.01),i.draw.scale.y=i.fill.scale.y=i.config.scaleY=Math.max(i.config.scaleY/e,.01));var n=i.transformMousePosition(t.params.pos.x,t.params.pos.y),o=i.draw.offset.x+(n.x-r.x)*i.draw.scale.x,a=i.draw.offset.y+(n.y-r.y)*i.draw.scale.y;i.draw.offset.x=i.fill.offset.x=i.config.offsetX=o,i.draw.offset.y=i.fill.offset.y=i.config.offsetY=a,t.preventDefault(),i.redraw()},t.prototype.installInputListeners=function(){var e=this;if(this.config.enableMouse?new MouseHandler(this.canvas).down(function(t){e.mouseDownHandler(t)}).drag(function(t){e.mouseDragHandler(t)}).up(function(t){e.mouseUpHandler(t)}):e.console.log("Mouse interaction disabled."),this.config.enableMouseWheel?new MouseHandler(this.canvas).wheel(function(t){e.mouseWheelHandler(t)}):e.console.log("Mouse wheel interaction disabled."),this.config.enableTouch)if(window.Touchy&&"function"==typeof window.Touchy){var i=function(t){return{x:t.x-e.canvas.offsetLeft,y:t.y-e.canvas.offsetTop}},s=null,r=null,n=null,o=window.Touchy;new o(this.canvas,{one:function(o,a){s=new Vertex(i(a.lastPoint)),r=new Vertex(i(a.lastPoint)),n=e.locatePointNear(e.transformMousePosition(s.x,s.y),t.DEFAULT_TOUCH_TOLERANCE/Math.min(e.config.cssScaleX,e.config.cssScaleY)),n&&o.on("move",function(t){var o=i(t[0]),a=e.transformMousePosition(o.x,o.y),h=new Vertex(e.transformMousePosition(s.x,s.y)).difference(a);if("vertex"==n.typeName){if(!e.vertices[n.vindex].attr.draggable)return;e.vertices[n.vindex].add(h);var l=e.vertices[n.vindex],u={params:{dragAmount:h.clone(),wasDragged:!0,mouseDownPos:r.clone(),mouseDragPos:r.clone().add(h),vertex:l}};l.listeners.fireDragEvent(u),e.redraw()}s=new Vertex(o)})}})}else console.warn("Cannot initialize the touch handler. Touchy is missig. Did you include it?");else e.console.log("Touch interaction disabled.");this.config.enableKeys?this.keyHandler=new KeyHandler({trackAll:!0}).down("escape",function(){e.clearSelection(!0)}).down("shift",function(){e.selectPolygon=new Polygon,e.redraw()}).up("shift",function(){null!=e.selectPolygon&&(e.selectVerticesInPolygon(e.selectPolygon),e.selectPolygon=null,e.redraw())}).down("e",function(){e.console.log("e was hit. shift is pressed?",this.keyHandler.isDown("shift"))}):e.console.log("Keyboard interaction disabled.")},t.prototype.createGUI=function(){if(window.utils&&"function"==typeof window.utils.createGUI)return window.utils.createGUI(this);throw"Cannot create dat.GUI instance; did you load the ./utils/creategui helper function an the dat.GUI library?"},t.DEFAULT_CANVAS_WIDTH=1024,t.DEFAULT_CANVAS_HEIGHT=768,t.DEFAULT_CLICK_TOLERANCE=8,t.DEFAULT_TOUCH_TOLERANCE=32,t.utils={safeMergeByKeys:function(t,e){for(var i in t)if(e.hasOwnProperty(i)){var s=typeof t[i];try{"boolean"==s?t[i]=!!JSON.parse(e[i]):"number"==s?t[i]=1*JSON.parse(e[i]):"function"==s&&"function"==typeof e[i]?t[i]=e[i]:t[i]=e[i]}catch(t){console.error("error in key ",i,e[i],t)}}return t},setCSSscale:function(t,e,i){t.style["transform-origin"]="0 0",1==e&&1==i?t.style.transform=null:t.style.transform="scale("+e+","+i+")"},fetch:{val:function(t,e,i){return t.hasOwnProperty(e)?"undefined"==typeof t[e]?i:t[e]:i},num:function(t,e,i){return t.hasOwnProperty(e)?"number"!=typeof t[e]?i:t[e]:i},bool:function(t,e,i){return t.hasOwnProperty(e)?"boolean"!=typeof t[e]?i:t[e]:i},func:function(t,e,i){return t.hasOwnProperty(e)?"function"!=typeof t[e]?i:t[e]:i}}},t})()}])});
//# sourceMappingURL=plotboilerplate.min.js.map